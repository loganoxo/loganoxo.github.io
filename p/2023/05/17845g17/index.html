<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="JVMåº•å±‚åŸç†"><meta name=keywords content="JVM"><title>13-åƒåœ¾å›æ”¶å™¨</title>
<link rel=canonical href=https://logan.wssw.fun/p/2023/05/17845g17/><link rel=stylesheet href=/scss/preload.min.59269306371083cf0d4c729835896a9d7d6a33aa8bf3743e44a675dc35fb76f3.css crossorigin=anonymous><script src=/ts/preload.min.5a9adf4d684a430995e4a2d6d4231b23de7250e2db58b5829c2162e940eccac7.js crossorigin=anonymous></script><style>.top-scroll-bar,.page-load-progress-bar{position:fixed;top:0;left:0;z-index:9999;display:none;width:0;height:4px;border-radius:5px;background-image:linear-gradient(to right,#5a0ca6 0%,rgba(208,114,155,.84) 50%,#29d 100%); [data-scheme="light"] & { background-image: linear-gradient(to right, #78ee6e 0%, #5069e3 50%, #29d 100%); }}#nprogress{pointer-events:none}#nprogress .my_bar{background-image:linear-gradient(to right,#5a0ca6 0%,rgba(208,114,155,.84) 50%,#29d 100%); [data-scheme="light"] & { background-image: linear-gradient(to right, #78ee6e 0%, #5069e3 50%, #29d 100%); } position: fixed;z-index:9999;top:0;left:0;border-radius:10px;width:100%;height:5px}#nprogress .my_peg{display:block;position:absolute;right:0;width:100px;height:100%;box-shadow:0 0 10px #29d,0 0 5px #29d;opacity:1;-webkit-transform:rotate(3deg)translate(0,-4px);-ms-transform:rotate(3deg)translate(0,-4px);transform:rotate(3deg)translate(0,-4px)}#nprogress .my_spinner{display:block;position:fixed;z-index:9998;top:15px;right:15px}#nprogress .my_spinner-icon{width:25px;height:25px;box-sizing:border-box;border:solid 3px transparent;border-top-color:#29d;border-left-color:#29d;border-radius:50%;-webkit-animation:nprogress-spinner 400ms linear infinite;animation:nprogress-spinner 400ms linear infinite}.nprogress-custom-parent{overflow:hidden;position:relative}.nprogress-custom-parent #nprogress .my_spinner,.nprogress-custom-parent #nprogress .my_bar{position:absolute}@-webkit-keyframes nprogress-spinner{0%{-webkit-transform:rotate(0)}100%{-webkit-transform:rotate(360deg)}}@keyframes nprogress-spinner{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}</style><script src=https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/nprogress/0.2.0/nprogress.min.js crossorigin=anonymous></script><link rel=stylesheet href=/scss/style.min.a5f47434887f6a51d362a3d7ef59c13b45af8311421bb3968dfa6bc6679d908e.css><meta property='og:title' content="13-åƒåœ¾å›æ”¶å™¨"><meta property='og:description' content="JVMåº•å±‚åŸç†"><meta property='og:url' content='https://logan.wssw.fun/p/2023/05/17845g17/'><meta property='og:site_name' content='Logançš„åšå®¢'><meta property='og:type' content='article'><meta property='article:section' content='Draft'><meta property='article:tag' content='JVM'><meta property='article:published_time' content='2023-05-03T03:17:32+08:00'><meta property='article:modified_time' content='2024-05-08T21:39:00+08:00'><meta property='og:image' content='https://logan.wssw.fun/img/share.jpg'><meta name=twitter:site content="@loganovo297796"><meta name=twitter:creator content="@loganovo297796"><meta name=twitter:title content="13-åƒåœ¾å›æ”¶å™¨"><meta name=twitter:description content="JVMåº•å±‚åŸç†"><meta name=twitter:card content="summary"><meta name=twitter:image content='https://logan.wssw.fun/img/share.jpg'><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><script async src="https://www.googletagmanager.com/gtag/js?id=G-R7GQB9XXQW"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-R7GQB9XXQW")}</script><meta name=google-site-verification content="3CAZCWVpDIWQxfZCqLMpov13bCzaH1QdnlHZTNnNjfM"><link rel=preload as=style onload='this.rel="stylesheet"' href=https://cdn.bootcdn.net/ajax/libs/lxgw-wenkai-webfont/1.7.0/style.min.css crossorigin=anonymous><script src=/js/sceneanimation.min.8c8c65611aaf0c8996e6d8a06f3e3bc82e6c8d2d2ab542e7cde8df7bceeeba9e.js crossorigin=anonymous async></script><link rel=preload as=style onload='this.rel="stylesheet"' href=https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/photoswipe/4.1.3/photoswipe.min.css crossorigin=anonymous><link rel=preload as=style onload='this.rel="stylesheet"' href=https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/photoswipe/4.1.3/default-skin/default-skin.min.css crossorigin=anonymous><script src=https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/photoswipe/4.1.3/photoswipe.min.js crossorigin=anonymous defer></script><script src=https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/photoswipe/4.1.3/photoswipe-ui-default.min.js crossorigin=anonymous defer></script><meta name=referrer content="no-referrer-when-downgrade"><style>@font-face{font-family:iconfont;src:url(/css/font/mine/iconfont.woff2?t=1715721803238)format('woff2')}.iconfont{font-family:iconfont!important;font-size:.8em;font-weight:600;font-style:normal;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-square-arrow-up-right-solid:before{content:"\e616"}.icon-square-up-right-solid:before{content:"\e614"}.icon-arrow-up-right-from-square-solid:before{content:"\e615"}.icon-link:before{content:"\e603"}.icon-a-OpenLink:before{content:"\e634"}.icon-poo-solid:before{content:"\e604"}.icon-face-smile-wink-regular:before{content:"\e605"}.icon-poop-solid:before{content:"\e606"}.icon-pagelines:before{content:"\e607"}.icon-airbnb:before{content:"\e608"}.icon-paperclip-solid:before{content:"\e60a"}.icon-crown-solid:before{content:"\e60b"}.icon-thumbtack-solid:before{content:"\e60c"}.icon-face-grin-beam-regular:before{content:"\e60d"}.icon-face-laugh-regular:before{content:"\e60e"}.icon-location-pin-solid:before{content:"\e60f"}.icon-hand-point-right-regular:before{content:"\e610"}.icon-bookmark-solid:before{content:"\e611"}.icon-face-grin-wide-regular:before{content:"\e612"}.icon-face-smile-beam-regular:before{content:"\e613"}.icon-xitongshezhi:before{content:"\e622"}.icon-fenzu:before{content:"\e609"}.icon-shoucang:before{content:"\e639"}.icon-wenjianjia:before{content:"\e67e"}.icon-bookmark-01:before{content:"\e735"}.icon-shoucangjia:before{content:"\ec5c"}.icon-a-biaoqianshuqian:before{content:"\e65f"}.icon-shoucang1:before{content:"\100da"}.icon-baocun:before{content:"\e769"}.icon-shoucang2:before{content:"\e62d"}.icon-shouye-01:before{content:"\e7c6"}.icon-fuzhiwenjian:before{content:"\e600"}.icon-fuzhi:before{content:"\ec7a"}.icon-thumbtack:before{content:"\ecd9"}.icon-thumbtack1:before{content:"\f107"}.icon-link-solid:before{content:"\e602"}</style><style>@charset "UTF-8";.pswp__bg{background:rgba(24,24,27,.98)}.pswp__ui--fit .pswp__top-bar{background:0 0}.pswp__ui--fit .pswp__caption{background:0 0}.pswp__top-bar{background:0 0}.pswp__caption{background:0 0}.pswp__caption__center{text-align:center;color:#e8e8e8}.article-content div.gallery{padding:0 10px}figure.gallery-image{border-radius:20px;overflow:hidden}.gallery>figure>a{display:inline-block;border-radius:20px;overflow:hidden;cursor:pointer;cursor:zoom-in}figure.gallery-image img{border-radius:20px;transition:all .5s ease}figure.gallery-image img:hover{transform:scale(1.1)}</style></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"dark")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e==="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div id=loading-box><div class=loading-left-bg></div><div class=loading-right-bg></div><div class=spinner-box><div class=configure-border-1><div class=configure-core></div></div><div class=configure-border-2><div class=configure-core></div></div><div class=loading-word>åŠ è½½ä¸­...</div></div></div><div class=top-scroll-bar></div><script>var my_template='<div class="my_bar" role="bar"><div class="my_peg"></div></div><div class="my_spinner" role="spinner"><div class="my_spinner-icon"></div></div>';NProgress.configure({template:my_template}),NProgress.start(),document.addEventListener("readystatechange",()=>{if(document.readyState==="interactive"&&NProgress.inc(.6),document.readyState==="complete"){NProgress.done(!0),NProgress.configure({template:my_template,minimum:0,trickle:!1,showSpinner:!1});var e=document.querySelector(".top-scroll-bar");window.addEventListener("scroll",function(){var t=document.documentElement.scrollTop||document.body.scrollTop,n=document.documentElement.scrollHeight-document.documentElement.clientHeight,s=t/n*100;e.style.width=s+"%",e.style.display="block"})}})</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><a id=dark-mode-toggle-mine type=button aria-label=åˆ‡æ¢ä¸»é¢˜ href=javascript:void(0)><svg class="icon icon-tabler icon-tabler-toggle-left" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" p-id="14930" width="128" height="128"><path d="M253.939302 502.92736a269.74208 269.74208.0 00122.90048 235.84768 257.024 257.024.0 00259.95264 9.07264c81.46944-44.27776 135.70048-130.49856 139.0592-226.7136 5.14048-147.3536-107.37664-270.1312-250.63424-275.1488-145.32608-5.05856-266.1376 109.568-271.27808 256.94208zM531.730022.3072c16.384.57344 32.256 15.48288 31.62112 33.8944l-3.72736 106.43456c-.57344 16.384-15.4624 32.256-33.8944 31.60064-16.384-.57344-32.23552-15.4624-31.60064-33.8944l3.72736-106.43456c2.74432-20.3776 15.4624-32.23552 33.87392-31.60064zm493.89568 527.52384c-.57344 16.384-13.35296 30.26944-33.8944 31.60064l-104.36608-3.64544c-16.384-.57344-32.19456-17.53088-31.62112-33.8944.57344-16.384 15.48288-32.256 33.8944-31.60064l104.38656 3.64544a32.3584 32.3584.0 0131.60064 33.8944zm-855.53152-29.9008c-.57344 16.384-13.35296 30.28992-33.8944 31.62112l-104.38656-3.64544c-16.384-.57344-32.17408-17.5104-31.60064-33.8944.57344-16.384 15.4624-32.256 33.8944-31.60064l104.38656 3.64544a32.3584 32.3584.0 0131.60064 33.8944zm325.91872 525.76256c-16.384-.57344-32.256-15.48288-31.62112-33.8944l3.72736-106.43456c.57344-16.384 15.4624-32.256 33.8944-31.60064 16.384.57344 32.23552 15.4624 31.60064 33.8944l-3.72736 106.43456c-2.74432 20.3776-17.5104 32.1536-33.87392 31.60064zm401.32608-871.26016c11.85792 12.6976 11.0592 35.2256-1.6384 47.06304l-78.37696 73.09312c-12.6976 11.85792-33.1776 11.14112-47.08352-1.6384-11.83744-12.6976-11.0592-35.2256 1.6384-47.08352l78.39744-73.09312c16.85504-13.74208 35.2256-11.0592 47.06304 1.6384zm-15.50336 737.1776c-12.6976 11.85792-31.1296 11.22304-47.06304-1.6384l-70.9632-80.34304c-11.85792-12.6976-11.0592-35.2256 1.6384-47.08352s35.2256-11.0592 47.08352 1.6384l73.07264 78.37696c9.728 14.68416 8.94976 37.21216-3.76832 49.0496zm-596.31616-645.8368c-12.6976 11.85792-31.1296 11.20256-47.06304-1.6384l-73.09312-78.37696c-11.85792-12.6976-11.0592-35.2256 1.6384-47.08352s35.2256-11.0592 47.08352 1.6384l73.09312 78.37696c11.776 14.7456 11.0592 35.2256-1.6384 47.08352zm-138.24 614.05184c-11.85792-12.71808-11.0592-35.2256 1.6384-47.08352l78.37696-73.09312c12.6976-11.83744 33.1776-11.12064 47.08352 1.6384 11.83744 12.71808 11.0592 35.2256-1.6384 47.104l-78.39744 73.07264c-16.7936 11.71456-35.2256 11.0592-47.06304-1.6384z" fill="#ffb948"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="128" height="128"><path d="M578.256332 591.814252v-82.970701m0 95.54202a12.655127 12.655127.0 01-12.571318-12.571319v-82.970701a12.571318 12.571318.0 1125.142636.0v82.970701a12.571318 12.571318.0 01-12.571318 12.571319z" fill="#f89b1b"/><path d="M598.873294 479.342858a36.959676 36.959676.0 01-27.573092-61.59946 52.380493 52.380493.0 1062.521357 36.540632 36.875867 36.875867.0 01-34.948265 25.058828zm204.0744-109.035234v-82.970701m0 95.542019a12.571318 12.571318.0 01-12.571318-12.571318v-82.970701a12.571318 12.571318.0 1125.142636.0v82.970701a12.571318 12.571318.0 01-12.571318 12.571318z" fill="#f89b1b"/><path d="M823.9837 257.83623a36.959676 36.959676.0 01-27.6569-61.515651 52.129067 52.129067.0 1064.616576 50.285273 53.050963 53.050963.0 00-2.011411-14.163685A36.875867 36.875867.0 01823.9837 257.83623z" fill="#f89b1b"/><path d="M803.282929 328.822274a59.588049 59.588049.0 0159.588049 59.588048V785.66398H743.694881V388.410322a59.588049 59.588049.0 0159.588048-59.588048zM581.776301 551.16699a143.145411 143.145411.0 01143.145411 143.145411V837.54162H438.463272V694.312401A143.145411 143.145411.0 01581.776301 551.16699z" fill="#612273"/><path d="M600.968514 198.667225l-49.111951-4.693292a8.380879 8.380879.0 01-7.039938-5.196145l-17.599845-42.658674a8.380879 8.380879.0 00-15.672244.0l-17.432228 42.658674a8.380879 8.380879.0 01-7.039938 5.196145l-49.11195 4.693292a8.380879 8.380879.0 00-4.777101 14.750347l36.959676 32.51781a8.380879 8.380879.0 012.681881 8.380878l-11.06276 45.67579a8.380879 8.380879.0 0012.487509 9.302776L515.232123 285.074086a8.380879 8.380879.0 018.380879.0l40.982497 24.136931a8.380879 8.380879.0 0012.571319-9.302776l-10.978952-45.675789a8.380879 8.380879.0 012.681882-8.380879L606.08085 213.417572a8.380879 8.380879.0 00-5.028528-14.750347z" fill="#fed150"/><path d="M470.897274 246.77347l1.927602-8.380879a8.380879 8.380879.0 00-2.681881-8.380879l-35.032074-30.506399a8.380879 8.380879.0 00-1.927602 13.912259l36.959676 32.51781a6.788512 6.788512.0 01.754279.838088zM603.98563 199.589122l-34.948265 30.674016a8.380879 8.380879.0 00-2.681881 8.380879l1.927602 8.380879a6.788512 6.788512.0 01.754279-.838088l37.043485-32.769236a8.380879 8.380879.0 00-2.09522-13.82845zm-28.578797 92.189667a8.380879 8.380879.0 01-10.643716 1.759985l-40.982498-24.053123a8.380879 8.380879.0 00-8.380879.0L474.249625 293.454965a8.380879 8.380879.0 01-10.643716-1.676176l-1.927602 8.380879a8.380879 8.380879.0 0012.487509 9.302775l41.066307-24.388357a8.380879 8.380879.0 018.380879.0l40.982497 24.136931a8.380879 8.380879.0 0012.571319-9.302776z" fill="#fed150" opacity=".5"/><path d="M434.608068 426.543321l-28.159753-2.681881a4.86091 4.86091.0 01-4.022822-3.017117l-10.057054-24.388357a4.86091 4.86091.0 00-8.967541.0l-9.973245 24.388357a4.693292 4.693292.0 01-4.022822 3.017117l-28.159753 2.681881a4.86091 4.86091.0 00-2.76569 8.380879l21.203623 18.605551a4.944719 4.944719.0 011.592367 4.777101L354.654484 484.455194a4.86091 4.86091.0 007.123747 5.363762l23.466461-13.82845a5.196145 5.196145.0 014.944718.0l23.466461 13.82845a4.86091 4.86091.0 007.123747-5.363762l-6.285659-26.064533a4.86091 4.86091.0 011.508558-4.777101l21.203624-18.605551a4.86091 4.86091.0 00-2.849499-8.380879z" fill="#fed150"/><path d="M360.102055 454.032604l1.173323-4.609484a4.944719 4.944719.0 00-1.592367-5.112336l-20.0303-17.683654a4.944719 4.944719.0 00-1.173323 8.380879l21.203623 18.605551zm76.182189-26.98643-20.0303 17.26461a4.86091 4.86091.0 00-1.508559 4.777101l1.173323 4.693292v-.502852l21.203624-18.605551a4.86091 4.86091.0 00-.838088-7.6266zM419.94153 479.845711a4.777101 4.777101.0 01-6.034233 1.005705l-23.46646-13.82845a5.196145 5.196145.0 00-4.944719.0l-23.466461 13.82845a4.777101 4.777101.0 01-6.034233-1.005705l-1.089514 4.609483a4.86091 4.86091.0 007.123747 5.363762l23.466461-13.82845a5.196145 5.196145.0 014.944719.0l23.46646 13.82845a4.86091 4.86091.0 007.123747-5.363762z" fill="#fed150" opacity=".5"/><path d="M635.413926 803.68287A414.685886 414.685886.0 01459.41547 18.729756 9.805628 9.805628.0 00453.967898.124205a513.831683 513.831683.0 10567.050264 607.027056 9.805628 9.805628.0 00-18.186507-6.704704A414.350651 414.350651.0 01635.413926 803.68287z" fill="#fed150" p-id="22313"/><path d="M50.931434 292.868303a460.110249 460.110249.0 00275.311871 359.455895 413.847798 413.847798.0 01133.339782-633.594442A9.805628 9.805628.0 00453.967898.124205 513.915492 513.915492.0 0050.931434 292.868303z" fill="#fed150" opacity=".4" p-id="22314"/><path d="M1006.016389 597.261823A513.664065 513.664065.0 013.914704 475.320036c-.670471 10.308481-1.257132 20.616962-1.257132 31.093061a513.831683 513.831683.0 001018.36059 100.570546 9.805628 9.805628.0 00-15.001773-9.72182zM231.539373 332.258434c0 7.458982.67047 14.917964 1.257132 22.293138A414.769695 414.769695.0 01459.583087 18.729756 9.805628 9.805628.0 00453.967898.124205a505.869848 505.869848.0 00-94.620122 20.868388A413.177328 413.177328.0 00231.539373 332.258434z" fill="#fed150" opacity=".5" p-id="22315"/><path d="M715.032275 421.514794m17.683654.0h141.217809q17.683654.0 17.683655 17.683654v-.083809q0 17.683654-17.683655 17.683655H732.715929q-17.683654.0-17.683654-17.683655v.083809q0-17.683654 17.683654-17.683654z" fill="#eb3d72" p-id="22316"/><path d="M205.139605 319.603307c4.441866-6.872321 22.041711-45.340555-11.817039-67.047031s-51.626214 8.380879-51.626214 8.380879a25.142637 25.142637.0 1042.742482 27.489282s2.179029 5.950424-6.537085 18.437934-25.142637 12.236083-43.077718.754279-47.01673-65.789899-.67047-138.787354c1.592367-2.514264 3.352352-4.693292 5.028527-7.039938a26.818812 26.818812.0 00-23.047417-2.430455 33.523515 33.523515.0 00-18.689359 17.683654c-31.260678 64.36515-22.628373 127.724594 21.203623 155.884347 48.944333 31.093061 82.048804-6.453277 86.49067-13.325597zM734.224488 931.491272c6.453277-2.681881 37.713955-21.45505 24.304548-53.386198s-40.647262-19.35983-40.647262-19.35983a21.874094 21.874094.0 1016.761757 40.312027s-1.340941 5.363762-13.577023 9.973246S697.264812 905.259122 689.889638 888.497364s-1.340941-69.561295 67.047031-98.894371c2.346646-1.005705 4.693292-1.676176 7.039938-2.514263a31.931148 31.931148.0 00-1.927602-3.352352 28.578797 28.578797.0 00-38.635851-7.542791c-51.87764 30.841634-74.422204 81.545951-57.325212 122.277023 19.778874 46.262451 61.59946 35.786353 68.136546 33.020662zM279.813236 802.844782c-5.950424-3.687587-39.390131-18.354125-57.660447 11.146569s7.794217 44.334849 7.794217 44.334849a21.874094 21.874094.0 1023.047417-36.875867s5.112336-2.011411 16.007479 5.279954 10.811334 21.622667 1.173323 37.211102-55.984271 41.317733-119.511333 2.430455c-2.179029-1.340941-4.106631-2.849499-6.118041-4.274249a22.376947 22.376947.0 00-1.676176 3.51997 28.662606 28.662606.0 0016.342714 36.037779c55.146183 24.388357 109.538087 13.409406 132.920739-24.136931 26.399768-42.9101-6.369468-70.902235-12.319892-74.673631zM431.00429 694.312401h302.298301m0 20.952197H431.00429a20.952197 20.952197.0 010-41.904394h302.298301a20.952197 20.952197.0 010 41.904394z" fill="#eb3d72" p-id="22317"/><path d="M255.760113 683.082023m-30.171164.0a30.171164 30.171164.0 1060.342328.0 30.171164 30.171164.0 10-60.342328.0z" fill="#fed150" opacity=".4" p-id="22318"/><path d="M356.246851 840.977781m-30.171164.0a30.171164 30.171164.0 1060.342328.0 30.171164 30.171164.0 10-60.342328.0z" fill="#fed150" opacity=".4" p-id="22319"/><path d="M54.870447 472.135302m-30.171164.0a30.171164 30.171164.0 1060.342328.0 30.171164 30.171164.0 10-60.342328.0z" fill="#fed150" opacity=".4" p-id="22320"/><path d="M561.410765 873.914635m-30.171164.0a30.171164 30.171164.0 1060.342328.0 30.171164 30.171164.0 10-60.342328.0z" fill="#fed150" opacity=".5" p-id="22321"/><path d="M445.167976 825.13792m-19.862683.0a19.862683 19.862683.0 1039.725365.0 19.862683 19.862683.0 10-39.725365.0z" fill="#fed150" opacity=".5" p-id="22322"/><path d="M149.406761 689.786726m-19.862683.0a19.862683 19.862683.0 1039.725365.0 19.862683 19.862683.0 10-39.725365.0z" fill="#fed150" opacity=".5" p-id="22323"/><path d="M132.225959 633.299603m-18.940786.0a18.940786 18.940786.0 1037.881572.0 18.940786 18.940786.0 10-37.881572.0z" fill="#fed150" opacity=".4" p-id="22324"/><path d="M475.339139 906.935297m-18.940786.0a18.940786 18.940786.0 1037.881573.0 18.940786 18.940786.0 10-37.881573.0z" fill="#fed150" opacity=".4" p-id="22325"/></svg>
<span>åˆ‡æ¢</span></a><div id=article-toolbar><a href=/ type=button class=back-home id=back-toggle aria-label=ä¸»é¡µ><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 6l-6 6 6 6"/></svg>
<span>HOME</span></a></div><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar-3K_hu560d426f92925c766fafa78be2429fd1_3226_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy decoding=async alt=Avatar>
</a><span class=emoji>ğŸ¥</span></figure><div class=site-meta><h1 class=site-name><a href=/>LoganğŸŒ€</a></h1><h2 class=site-description>Starry serenade âœï¸</h2></div></header><ol class=menu-social><li><a href=https://github.com/loganoxo target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://blog.csdn.net/u014229652 target=_blank title=my_csdn rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg></a></li><li><a href=https://twitter.com target=_blank title=Twitter rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>ä¸»é¡µ</span></a></li><li><a href=/articles/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-heart" width="44" height="44" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19.5 12.572 12 20l-7.5-7.428A5 5 0 1112 6.006a5 5 0 117.5 6.572"/></svg>
<span>æˆ‘çš„</span></a></li><li><a href=/page/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>å½’æ¡£</span></a></li><li><a href=/page/photos/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-camera" width="44" height="44" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 7h1a2 2 0 002-2 1 1 0 011-1h6a1 1 0 011 1 2 2 0 002 2h1a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9a2 2 0 012-2"/><path d="M9 13a3 3 0 106 0 3 3 0 00-6 0"/></svg>
<span>ç›¸å†Œ</span></a></li><li><a href=/page/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>æœç´¢</span></a></li><li><a href=/timeline/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-fish-christianity" width="44" height="44" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 7S16.354 17 9.692 17c-3.226.025-6.194-1.905-7.692-5 1.498-3.095 4.466-5.025 7.692-5C16.354 7 22 17 22 17"/></svg>
<span>å¹´è½´</span></a></li><li><a href=/page/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>å‹é“¾</span></a></li><li><a href=/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>å…³äº</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" p-id="14930" width="128" height="128"><path d="M253.939302 502.92736a269.74208 269.74208.0 00122.90048 235.84768 257.024 257.024.0 00259.95264 9.07264c81.46944-44.27776 135.70048-130.49856 139.0592-226.7136 5.14048-147.3536-107.37664-270.1312-250.63424-275.1488-145.32608-5.05856-266.1376 109.568-271.27808 256.94208zM531.730022.3072c16.384.57344 32.256 15.48288 31.62112 33.8944l-3.72736 106.43456c-.57344 16.384-15.4624 32.256-33.8944 31.60064-16.384-.57344-32.23552-15.4624-31.60064-33.8944l3.72736-106.43456c2.74432-20.3776 15.4624-32.23552 33.87392-31.60064zm493.89568 527.52384c-.57344 16.384-13.35296 30.26944-33.8944 31.60064l-104.36608-3.64544c-16.384-.57344-32.19456-17.53088-31.62112-33.8944.57344-16.384 15.48288-32.256 33.8944-31.60064l104.38656 3.64544a32.3584 32.3584.0 0131.60064 33.8944zm-855.53152-29.9008c-.57344 16.384-13.35296 30.28992-33.8944 31.62112l-104.38656-3.64544c-16.384-.57344-32.17408-17.5104-31.60064-33.8944.57344-16.384 15.4624-32.256 33.8944-31.60064l104.38656 3.64544a32.3584 32.3584.0 0131.60064 33.8944zm325.91872 525.76256c-16.384-.57344-32.256-15.48288-31.62112-33.8944l3.72736-106.43456c.57344-16.384 15.4624-32.256 33.8944-31.60064 16.384.57344 32.23552 15.4624 31.60064 33.8944l-3.72736 106.43456c-2.74432 20.3776-17.5104 32.1536-33.87392 31.60064zm401.32608-871.26016c11.85792 12.6976 11.0592 35.2256-1.6384 47.06304l-78.37696 73.09312c-12.6976 11.85792-33.1776 11.14112-47.08352-1.6384-11.83744-12.6976-11.0592-35.2256 1.6384-47.08352l78.39744-73.09312c16.85504-13.74208 35.2256-11.0592 47.06304 1.6384zm-15.50336 737.1776c-12.6976 11.85792-31.1296 11.22304-47.06304-1.6384l-70.9632-80.34304c-11.85792-12.6976-11.0592-35.2256 1.6384-47.08352s35.2256-11.0592 47.08352 1.6384l73.07264 78.37696c9.728 14.68416 8.94976 37.21216-3.76832 49.0496zm-596.31616-645.8368c-12.6976 11.85792-31.1296 11.20256-47.06304-1.6384l-73.09312-78.37696c-11.85792-12.6976-11.0592-35.2256 1.6384-47.08352s35.2256-11.0592 47.08352 1.6384l73.09312 78.37696c11.776 14.7456 11.0592 35.2256-1.6384 47.08352zm-138.24 614.05184c-11.85792-12.71808-11.0592-35.2256 1.6384-47.08352l78.37696-73.09312c12.6976-11.83744 33.1776-11.12064 47.08352 1.6384 11.83744 12.71808 11.0592 35.2256-1.6384 47.104l-78.39744 73.07264c-16.7936 11.71456-35.2256 11.0592-47.06304-1.6384z" fill="#ffb948"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="128" height="128"><path d="M578.256332 591.814252v-82.970701m0 95.54202a12.655127 12.655127.0 01-12.571318-12.571319v-82.970701a12.571318 12.571318.0 1125.142636.0v82.970701a12.571318 12.571318.0 01-12.571318 12.571319z" fill="#f89b1b"/><path d="M598.873294 479.342858a36.959676 36.959676.0 01-27.573092-61.59946 52.380493 52.380493.0 1062.521357 36.540632 36.875867 36.875867.0 01-34.948265 25.058828zm204.0744-109.035234v-82.970701m0 95.542019a12.571318 12.571318.0 01-12.571318-12.571318v-82.970701a12.571318 12.571318.0 1125.142636.0v82.970701a12.571318 12.571318.0 01-12.571318 12.571318z" fill="#f89b1b"/><path d="M823.9837 257.83623a36.959676 36.959676.0 01-27.6569-61.515651 52.129067 52.129067.0 1064.616576 50.285273 53.050963 53.050963.0 00-2.011411-14.163685A36.875867 36.875867.0 01823.9837 257.83623z" fill="#f89b1b"/><path d="M803.282929 328.822274a59.588049 59.588049.0 0159.588049 59.588048V785.66398H743.694881V388.410322a59.588049 59.588049.0 0159.588048-59.588048zM581.776301 551.16699a143.145411 143.145411.0 01143.145411 143.145411V837.54162H438.463272V694.312401A143.145411 143.145411.0 01581.776301 551.16699z" fill="#612273"/><path d="M600.968514 198.667225l-49.111951-4.693292a8.380879 8.380879.0 01-7.039938-5.196145l-17.599845-42.658674a8.380879 8.380879.0 00-15.672244.0l-17.432228 42.658674a8.380879 8.380879.0 01-7.039938 5.196145l-49.11195 4.693292a8.380879 8.380879.0 00-4.777101 14.750347l36.959676 32.51781a8.380879 8.380879.0 012.681881 8.380878l-11.06276 45.67579a8.380879 8.380879.0 0012.487509 9.302776L515.232123 285.074086a8.380879 8.380879.0 018.380879.0l40.982497 24.136931a8.380879 8.380879.0 0012.571319-9.302776l-10.978952-45.675789a8.380879 8.380879.0 012.681882-8.380879L606.08085 213.417572a8.380879 8.380879.0 00-5.028528-14.750347z" fill="#fed150"/><path d="M470.897274 246.77347l1.927602-8.380879a8.380879 8.380879.0 00-2.681881-8.380879l-35.032074-30.506399a8.380879 8.380879.0 00-1.927602 13.912259l36.959676 32.51781a6.788512 6.788512.0 01.754279.838088zM603.98563 199.589122l-34.948265 30.674016a8.380879 8.380879.0 00-2.681881 8.380879l1.927602 8.380879a6.788512 6.788512.0 01.754279-.838088l37.043485-32.769236a8.380879 8.380879.0 00-2.09522-13.82845zm-28.578797 92.189667a8.380879 8.380879.0 01-10.643716 1.759985l-40.982498-24.053123a8.380879 8.380879.0 00-8.380879.0L474.249625 293.454965a8.380879 8.380879.0 01-10.643716-1.676176l-1.927602 8.380879a8.380879 8.380879.0 0012.487509 9.302775l41.066307-24.388357a8.380879 8.380879.0 018.380879.0l40.982497 24.136931a8.380879 8.380879.0 0012.571319-9.302776z" fill="#fed150" opacity=".5"/><path d="M434.608068 426.543321l-28.159753-2.681881a4.86091 4.86091.0 01-4.022822-3.017117l-10.057054-24.388357a4.86091 4.86091.0 00-8.967541.0l-9.973245 24.388357a4.693292 4.693292.0 01-4.022822 3.017117l-28.159753 2.681881a4.86091 4.86091.0 00-2.76569 8.380879l21.203623 18.605551a4.944719 4.944719.0 011.592367 4.777101L354.654484 484.455194a4.86091 4.86091.0 007.123747 5.363762l23.466461-13.82845a5.196145 5.196145.0 014.944718.0l23.466461 13.82845a4.86091 4.86091.0 007.123747-5.363762l-6.285659-26.064533a4.86091 4.86091.0 011.508558-4.777101l21.203624-18.605551a4.86091 4.86091.0 00-2.849499-8.380879z" fill="#fed150"/><path d="M360.102055 454.032604l1.173323-4.609484a4.944719 4.944719.0 00-1.592367-5.112336l-20.0303-17.683654a4.944719 4.944719.0 00-1.173323 8.380879l21.203623 18.605551zm76.182189-26.98643-20.0303 17.26461a4.86091 4.86091.0 00-1.508559 4.777101l1.173323 4.693292v-.502852l21.203624-18.605551a4.86091 4.86091.0 00-.838088-7.6266zM419.94153 479.845711a4.777101 4.777101.0 01-6.034233 1.005705l-23.46646-13.82845a5.196145 5.196145.0 00-4.944719.0l-23.466461 13.82845a4.777101 4.777101.0 01-6.034233-1.005705l-1.089514 4.609483a4.86091 4.86091.0 007.123747 5.363762l23.466461-13.82845a5.196145 5.196145.0 014.944719.0l23.46646 13.82845a4.86091 4.86091.0 007.123747-5.363762z" fill="#fed150" opacity=".5"/><path d="M635.413926 803.68287A414.685886 414.685886.0 01459.41547 18.729756 9.805628 9.805628.0 00453.967898.124205a513.831683 513.831683.0 10567.050264 607.027056 9.805628 9.805628.0 00-18.186507-6.704704A414.350651 414.350651.0 01635.413926 803.68287z" fill="#fed150" p-id="22313"/><path d="M50.931434 292.868303a460.110249 460.110249.0 00275.311871 359.455895 413.847798 413.847798.0 01133.339782-633.594442A9.805628 9.805628.0 00453.967898.124205 513.915492 513.915492.0 0050.931434 292.868303z" fill="#fed150" opacity=".4" p-id="22314"/><path d="M1006.016389 597.261823A513.664065 513.664065.0 013.914704 475.320036c-.670471 10.308481-1.257132 20.616962-1.257132 31.093061a513.831683 513.831683.0 001018.36059 100.570546 9.805628 9.805628.0 00-15.001773-9.72182zM231.539373 332.258434c0 7.458982.67047 14.917964 1.257132 22.293138A414.769695 414.769695.0 01459.583087 18.729756 9.805628 9.805628.0 00453.967898.124205a505.869848 505.869848.0 00-94.620122 20.868388A413.177328 413.177328.0 00231.539373 332.258434z" fill="#fed150" opacity=".5" p-id="22315"/><path d="M715.032275 421.514794m17.683654.0h141.217809q17.683654.0 17.683655 17.683654v-.083809q0 17.683654-17.683655 17.683655H732.715929q-17.683654.0-17.683654-17.683655v.083809q0-17.683654 17.683654-17.683654z" fill="#eb3d72" p-id="22316"/><path d="M205.139605 319.603307c4.441866-6.872321 22.041711-45.340555-11.817039-67.047031s-51.626214 8.380879-51.626214 8.380879a25.142637 25.142637.0 1042.742482 27.489282s2.179029 5.950424-6.537085 18.437934-25.142637 12.236083-43.077718.754279-47.01673-65.789899-.67047-138.787354c1.592367-2.514264 3.352352-4.693292 5.028527-7.039938a26.818812 26.818812.0 00-23.047417-2.430455 33.523515 33.523515.0 00-18.689359 17.683654c-31.260678 64.36515-22.628373 127.724594 21.203623 155.884347 48.944333 31.093061 82.048804-6.453277 86.49067-13.325597zM734.224488 931.491272c6.453277-2.681881 37.713955-21.45505 24.304548-53.386198s-40.647262-19.35983-40.647262-19.35983a21.874094 21.874094.0 1016.761757 40.312027s-1.340941 5.363762-13.577023 9.973246S697.264812 905.259122 689.889638 888.497364s-1.340941-69.561295 67.047031-98.894371c2.346646-1.005705 4.693292-1.676176 7.039938-2.514263a31.931148 31.931148.0 00-1.927602-3.352352 28.578797 28.578797.0 00-38.635851-7.542791c-51.87764 30.841634-74.422204 81.545951-57.325212 122.277023 19.778874 46.262451 61.59946 35.786353 68.136546 33.020662zM279.813236 802.844782c-5.950424-3.687587-39.390131-18.354125-57.660447 11.146569s7.794217 44.334849 7.794217 44.334849a21.874094 21.874094.0 1023.047417-36.875867s5.112336-2.011411 16.007479 5.279954 10.811334 21.622667 1.173323 37.211102-55.984271 41.317733-119.511333 2.430455c-2.179029-1.340941-4.106631-2.849499-6.118041-4.274249a22.376947 22.376947.0 00-1.676176 3.51997 28.662606 28.662606.0 0016.342714 36.037779c55.146183 24.388357 109.538087 13.409406 132.920739-24.136931 26.399768-42.9101-6.369468-70.902235-12.319892-74.673631zM431.00429 694.312401h302.298301m0 20.952197H431.00429a20.952197 20.952197.0 010-41.904394h302.298301a20.952197 20.952197.0 010 41.904394z" fill="#eb3d72" p-id="22317"/><path d="M255.760113 683.082023m-30.171164.0a30.171164 30.171164.0 1060.342328.0 30.171164 30.171164.0 10-60.342328.0z" fill="#fed150" opacity=".4" p-id="22318"/><path d="M356.246851 840.977781m-30.171164.0a30.171164 30.171164.0 1060.342328.0 30.171164 30.171164.0 10-60.342328.0z" fill="#fed150" opacity=".4" p-id="22319"/><path d="M54.870447 472.135302m-30.171164.0a30.171164 30.171164.0 1060.342328.0 30.171164 30.171164.0 10-60.342328.0z" fill="#fed150" opacity=".4" p-id="22320"/><path d="M561.410765 873.914635m-30.171164.0a30.171164 30.171164.0 1060.342328.0 30.171164 30.171164.0 10-60.342328.0z" fill="#fed150" opacity=".5" p-id="22321"/><path d="M445.167976 825.13792m-19.862683.0a19.862683 19.862683.0 1039.725365.0 19.862683 19.862683.0 10-39.725365.0z" fill="#fed150" opacity=".5" p-id="22322"/><path d="M149.406761 689.786726m-19.862683.0a19.862683 19.862683.0 1039.725365.0 19.862683 19.862683.0 10-39.725365.0z" fill="#fed150" opacity=".5" p-id="22323"/><path d="M132.225959 633.299603m-18.940786.0a18.940786 18.940786.0 1037.881572.0 18.940786 18.940786.0 10-37.881572.0z" fill="#fed150" opacity=".4" p-id="22324"/><path d="M475.339139 906.935297m-18.940786.0a18.940786 18.940786.0 1037.881573.0 18.940786 18.940786.0 10-37.881573.0z" fill="#fed150" opacity=".4" p-id="22325"/></svg>
<span>ä¸»é¢˜</span></li></ol></li></ol></aside><main class="main full-width"><nav aria-label=breadcrumb class=breadcrumb><ol><li><a href=/>é¦–é¡µ</a></li><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevrons-right" width="44" height="44" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7l5 5-5 5"/><path d="M13 7l5 5-5 5"/></svg></div><li><a href=/p/>æœªæ•´ç†</a></li><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevrons-right" width="44" height="44" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7l5 5-5 5"/><path d="M13 7l5 5-5 5"/></svg></div><li class=active><a aria-current=page href=/p/2023/05/17845g17/>13-åƒåœ¾å›æ”¶å™¨</a></li></ol></nav><article class=main-article><header class="article-header not-page"><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352z"/></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"/><use href="#gentle-wave" x="48" y="3"/><use href="#gentle-wave" x="48" y="5"/><use href="#gentle-wave" x="48" y="7"/></g></svg></section><div class=article-details><header class=article-category><a href=/categories/jvm/ style=background-color:#c21292;color:#fff>JVM</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/2023/05/17845g17/>13-åƒåœ¾å›æ”¶å™¨</a></h2><h3 class=article-subtitle>JVMåº•å±‚åŸç†</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2023å¹´5æœˆ3æ—¥</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 50 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><h1 id=13-åƒåœ¾å›æ”¶å™¨><a href=#13-%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6%e5%99%a8 class=header-anchor></a>13. åƒåœ¾å›æ”¶å™¨</h1><h2 id=131-gc-åˆ†ç±»ä¸æ€§èƒ½æŒ‡æ ‡><a href=#131-gc-%e5%88%86%e7%b1%bb%e4%b8%8e%e6%80%a7%e8%83%bd%e6%8c%87%e6%a0%87 class=header-anchor></a>13.1. GC åˆ†ç±»ä¸æ€§èƒ½æŒ‡æ ‡</h2><h3 id=1311-åƒåœ¾å›æ”¶å™¨æ¦‚è¿°><a href=#1311-%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6%e5%99%a8%e6%a6%82%e8%bf%b0 class=header-anchor></a>13.1.1. åƒåœ¾å›æ”¶å™¨æ¦‚è¿°</h3><p>åƒåœ¾æ”¶é›†å™¨æ²¡æœ‰åœ¨è§„èŒƒä¸­è¿›è¡Œè¿‡å¤šçš„è§„å®šï¼Œå¯ä»¥ç”±ä¸åŒçš„å‚å•†ã€ä¸åŒç‰ˆæœ¬çš„ JVM æ¥å®ç°ã€‚</p><p>ç”±äº JDK çš„ç‰ˆæœ¬å¤„äºé«˜é€Ÿè¿­ä»£è¿‡ç¨‹ä¸­ï¼Œå› æ­¤ Java å‘å±•è‡³ä»Šå·²ç»è¡ç”Ÿäº†ä¼—å¤šçš„ GC ç‰ˆæœ¬ã€‚</p><p>ä»ä¸åŒè§’åº¦åˆ†æåƒåœ¾æ”¶é›†å™¨ï¼Œå¯ä»¥å°† GC åˆ†ä¸ºä¸åŒçš„ç±»å‹ã€‚</p><h3 id=1312-åƒåœ¾æ”¶é›†å™¨åˆ†ç±»><a href=#1312-%e5%9e%83%e5%9c%be%e6%94%b6%e9%9b%86%e5%99%a8%e5%88%86%e7%b1%bb class=header-anchor></a>13.1.2. åƒåœ¾æ”¶é›†å™¨åˆ†ç±»</h3><p>æŒ‰<mark>çº¿ç¨‹æ•°</mark>åˆ†ï¼Œå¯ä»¥åˆ†ä¸º<mark>ä¸²è¡Œåƒåœ¾å›æ”¶å™¨</mark>å’Œ<mark>å¹¶è¡Œåƒåœ¾å›æ”¶å™¨</mark>ã€‚</p><p><img src=https://logan.1357810.xyz/img/20220422/153020741-b2b8ae1f18.png width=900 height=600 loading=lazy decoding=async alt=image-20210512144253383 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p>ä¸²è¡Œå›æ”¶æŒ‡çš„æ˜¯åœ¨åŒä¸€æ—¶é—´æ®µå†…åªå…è®¸æœ‰ä¸€ä¸ª CPU ç”¨äºæ‰§è¡Œåƒåœ¾å›æ”¶æ“ä½œï¼Œæ­¤æ—¶å·¥ä½œçº¿ç¨‹è¢«æš‚åœï¼Œç›´è‡³åƒåœ¾æ”¶é›†å·¥ä½œç»“æŸã€‚</p><ul><li>åœ¨è¯¸å¦‚å• CPU å¤„ç†å™¨æˆ–è€…è¾ƒå°çš„åº”ç”¨å†…å­˜ç­‰ç¡¬ä»¶å¹³å°ä¸æ˜¯ç‰¹åˆ«ä¼˜è¶Šçš„åœºåˆï¼Œä¸²è¡Œå›æ”¶å™¨çš„æ€§èƒ½è¡¨ç°å¯ä»¥è¶…è¿‡å¹¶è¡Œå›æ”¶å™¨å’Œå¹¶å‘å›æ”¶å™¨ã€‚æ‰€ä»¥ï¼Œ<mark>ä¸²è¡Œå›æ”¶é»˜è®¤è¢«åº”ç”¨åœ¨å®¢æˆ·ç«¯çš„ Client æ¨¡å¼ä¸‹çš„ JVM ä¸­</mark></li><li>åœ¨å¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„ CPU ä¸Šï¼Œå¹¶è¡Œå›æ”¶å™¨äº§ç”Ÿçš„åœé¡¿æ—¶é—´è¦çŸ­äºä¸²è¡Œå›æ”¶å™¨ã€‚</li></ul><p>å’Œä¸²è¡Œå›æ”¶ç›¸åï¼Œå¹¶è¡Œæ”¶é›†å¯ä»¥è¿ç”¨å¤šä¸ª CPU åŒæ—¶æ‰§è¡Œåƒåœ¾å›æ”¶ï¼Œå› æ­¤æå‡äº†åº”ç”¨çš„ååé‡ï¼Œä¸è¿‡å¹¶è¡Œå›æ”¶ä»ç„¶ä¸ä¸²è¡Œå›æ”¶ä¸€æ ·ï¼Œé‡‡ç”¨ç‹¬å å¼ï¼Œä½¿ç”¨äº†â€œStop-the-Worldâ€æœºåˆ¶ã€‚</p><p>æŒ‰ç…§<mark>å·¥ä½œæ¨¡å¼</mark>åˆ†ï¼Œå¯ä»¥åˆ†ä¸º<mark>å¹¶å‘å¼åƒåœ¾å›æ”¶å™¨</mark>å’Œ<mark>ç‹¬å å¼åƒåœ¾å›æ”¶å™¨</mark>ã€‚</p><ul><li>å¹¶å‘å¼åƒåœ¾å›æ”¶å™¨ä¸åº”ç”¨ç¨‹åºçº¿ç¨‹äº¤æ›¿å·¥ä½œï¼Œä»¥å°½å¯èƒ½å‡å°‘åº”ç”¨ç¨‹åºçš„åœé¡¿æ—¶é—´ã€‚</li><li>ç‹¬å å¼åƒåœ¾å›æ”¶å™¨ï¼ˆStop the worldï¼‰ä¸€æ—¦è¿è¡Œï¼Œå°±åœæ­¢åº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ï¼Œç›´åˆ°åƒåœ¾å›æ”¶è¿‡ç¨‹å®Œå…¨ç»“æŸã€‚</li></ul><p><img src=https://logan.1357810.xyz/img/20220422/153020741-7da8ab5ade.png width=900 height=600 loading=lazy decoding=async alt=image-20200713083443486 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p>æŒ‰<mark>ç¢ç‰‡å¤„ç†æ–¹å¼</mark>åˆ†ï¼Œå¯åˆ†ä¸º<mark>å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨</mark>å’Œ<mark>éå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨</mark>ã€‚</p><ul><li>å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ä¼šåœ¨å›æ”¶å®Œæˆåï¼Œå¯¹å­˜æ´»å¯¹è±¡è¿›è¡Œå‹ç¼©æ•´ç†ï¼Œæ¶ˆé™¤å›æ”¶åçš„ç¢ç‰‡ã€‚</li><li>éå‹ç¼©å¼çš„åƒåœ¾å›æ”¶å™¨ä¸è¿›è¡Œè¿™æ­¥æ“ä½œã€‚</li></ul><p>æŒ‰<mark>å·¥ä½œçš„å†…å­˜åŒºé—´</mark>åˆ†ï¼Œåˆå¯åˆ†ä¸º<mark>å¹´è½»ä»£åƒåœ¾å›æ”¶å™¨</mark>å’Œ<mark>è€å¹´ä»£åƒåœ¾å›æ”¶å™¨</mark>ã€‚</p><h3 id=1313-è¯„ä¼°-gc-çš„æ€§èƒ½æŒ‡æ ‡><a href=#1313-%e8%af%84%e4%bc%b0-gc-%e7%9a%84%e6%80%a7%e8%83%bd%e6%8c%87%e6%a0%87 class=header-anchor></a>13.1.3. è¯„ä¼° GC çš„æ€§èƒ½æŒ‡æ ‡</h3><ul><li><mark>ååé‡</mark>ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ï¼ˆæ€»è¿è¡Œæ—¶é—´ = ç¨‹åºçš„è¿è¡Œæ—¶é—´ + å†…å­˜å›æ”¶çš„æ—¶é—´ï¼‰</li><li><mark>åƒåœ¾æ”¶é›†å¼€é”€</mark>ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€‚</li><li><mark>æš‚åœæ—¶é—´</mark>ï¼šæ‰§è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œç¨‹åºçš„å·¥ä½œçº¿ç¨‹è¢«æš‚åœçš„æ—¶é—´ã€‚</li><li><mark>æ”¶é›†é¢‘ç‡</mark>ï¼šç›¸å¯¹äºåº”ç”¨ç¨‹åºçš„æ‰§è¡Œï¼Œæ”¶é›†æ“ä½œå‘ç”Ÿçš„é¢‘ç‡ã€‚</li><li><mark>å†…å­˜å ç”¨</mark>ï¼šJava å †åŒºæ‰€å çš„å†…å­˜å¤§å°ã€‚</li><li><mark>å¿«é€Ÿ</mark>ï¼šä¸€ä¸ªå¯¹è±¡ä»è¯ç”Ÿåˆ°è¢«å›æ”¶æ‰€ç»å†çš„æ—¶é—´ã€‚</li></ul><p>ååé‡ã€æš‚åœæ—¶é—´ã€å†…å­˜å ç”¨ è¿™ä¸‰è€…å…±åŒæ„æˆä¸€ä¸ªâ€œä¸å¯èƒ½ä¸‰è§’â€ã€‚ä¸‰è€…æ€»ä½“çš„è¡¨ç°ä¼šéšç€æŠ€æœ¯è¿›æ­¥è€Œè¶Šæ¥è¶Šå¥½ã€‚ä¸€æ¬¾ä¼˜ç§€çš„æ”¶é›†å™¨é€šå¸¸æœ€å¤šåŒæ—¶æ»¡è¶³å…¶ä¸­çš„ä¸¤é¡¹ã€‚</p><p>è¿™ä¸‰é¡¹é‡Œï¼Œæš‚åœæ—¶é—´çš„é‡è¦æ€§æ—¥ç›Šå‡¸æ˜¾ã€‚å› ä¸ºéšç€ç¡¬ä»¶å‘å±•ï¼Œå†…å­˜å ç”¨å¤šäº›è¶Šæ¥è¶Šèƒ½å®¹å¿ï¼Œç¡¬ä»¶æ€§èƒ½çš„æå‡ä¹Ÿæœ‰åŠ©äºé™ä½æ”¶é›†å™¨è¿è¡Œæ—¶å¯¹åº”ç”¨ç¨‹åºçš„å½±å“ï¼Œå³æé«˜äº†ååé‡ã€‚è€Œå†…å­˜çš„æ‰©å¤§ï¼Œå¯¹å»¶è¿Ÿåè€Œå¸¦æ¥è´Ÿé¢æ•ˆæœã€‚</p><p>ç®€å•æ¥è¯´ï¼Œä¸»è¦æŠ“ä½ä¸¤ç‚¹ï¼šååé‡ã€æš‚åœæ—¶é—´</p><h4 id=ååé‡><a href=#%e5%90%9e%e5%90%90%e9%87%8f class=header-anchor></a>ååé‡</h4><p>ååé‡å°±æ˜¯ CPU ç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸ CPU æ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ï¼Œå³ååé‡ = è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ /ï¼ˆè¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´+åƒåœ¾æ”¶é›†æ—¶é—´ï¼‰ã€‚æ¯”å¦‚ï¼šè™šæ‹Ÿæœºæ€»å…±è¿è¡Œäº† 100 åˆ†é’Ÿï¼Œå…¶ä¸­åƒåœ¾æ”¶é›†èŠ±æ‰ 1 åˆ†é’Ÿï¼Œé‚£ååé‡å°±æ˜¯ 99%ã€‚</p><p>è¿™ç§æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºèƒ½å®¹å¿è¾ƒé«˜çš„æš‚åœæ—¶é—´ï¼Œå› æ­¤ï¼Œé«˜ååé‡çš„åº”ç”¨ç¨‹åºæœ‰æ›´é•¿çš„æ—¶é—´åŸºå‡†ï¼Œå¿«é€Ÿå“åº”æ˜¯ä¸å¿…è€ƒè™‘çš„</p><p>ååé‡ä¼˜å…ˆï¼Œæ„å‘³ç€åœ¨å•ä½æ—¶é—´å†…ï¼ŒSTW çš„æ—¶é—´æœ€çŸ­ï¼š0.2 + 0.2 = 0.4</p><p><img src=https://logan.1357810.xyz/img/20220422/153020741-2452b90524.png width=900 height=600 loading=lazy decoding=async alt=image-20200713084726176 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><h4 id=æš‚åœæ—¶é—´><a href=#%e6%9a%82%e5%81%9c%e6%97%b6%e9%97%b4 class=header-anchor></a>æš‚åœæ—¶é—´</h4><p>â€œæš‚åœæ—¶é—´â€æ˜¯æŒ‡ä¸€ä¸ªæ—¶é—´æ®µå†…åº”ç”¨ç¨‹åºçº¿ç¨‹æš‚åœï¼Œè®© GC çº¿ç¨‹æ‰§è¡Œçš„çŠ¶æ€ã€‚</p><p>ä¾‹å¦‚ï¼ŒGC æœŸé—´ 100 æ¯«ç§’çš„æš‚åœæ—¶é—´æ„å‘³ç€åœ¨è¿™ 100 æ¯«ç§’æœŸé—´å†…æ²¡æœ‰åº”ç”¨ç¨‹åºçº¿ç¨‹æ˜¯æ´»åŠ¨çš„ã€‚</p><p>æš‚åœæ—¶é—´ä¼˜å…ˆï¼Œæ„å‘³ç€å°½å¯èƒ½è®©å•æ¬¡ STW çš„æ—¶é—´æœ€çŸ­ï¼š0.1 + 0.1 + 0.1 + 0.1 + 0.1 = 0.5</p><p><img src=https://logan.1357810.xyz/img/20220422/153020741-3f1d43e786.png width=900 height=600 loading=lazy decoding=async alt=image-20200713085306400 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><h4 id=ååé‡-vs-æš‚åœæ—¶é—´><a href=#%e5%90%9e%e5%90%90%e9%87%8f-vs-%e6%9a%82%e5%81%9c%e6%97%b6%e9%97%b4 class=header-anchor></a>ååé‡ vs æš‚åœæ—¶é—´</h4><p>é«˜ååé‡è¾ƒå¥½å› ä¸ºè¿™ä¼šè®©åº”ç”¨ç¨‹åºçš„æœ€ç»ˆç”¨æˆ·æ„Ÿè§‰åªæœ‰åº”ç”¨ç¨‹åºçº¿ç¨‹åœ¨åšâ€œç”Ÿäº§æ€§â€å·¥ä½œã€‚ç›´è§‰ä¸Šï¼Œååé‡è¶Šé«˜ç¨‹åºè¿è¡Œè¶Šå¿«ã€‚</p><p>ä½æš‚åœæ—¶é—´ï¼ˆä½å»¶è¿Ÿï¼‰è¾ƒå¥½å› ä¸ºä»æœ€ç»ˆç”¨æˆ·çš„è§’åº¦æ¥çœ‹ä¸ç®¡æ˜¯ GC è¿˜æ˜¯å…¶ä»–åŸå› å¯¼è‡´ä¸€ä¸ªåº”ç”¨è¢«æŒ‚èµ·å§‹ç»ˆæ˜¯ä¸å¥½çš„ã€‚è¿™å–å†³äºåº”ç”¨ç¨‹åºçš„ç±»å‹ï¼Œ<mark>æœ‰æ—¶å€™ç”šè‡³çŸ­æš‚çš„ 200 æ¯«ç§’æš‚åœéƒ½å¯èƒ½æ‰“æ–­ç»ˆç«¯ç”¨æˆ·ä½“éªŒ</mark>ã€‚å› æ­¤ï¼Œå…·æœ‰ä½çš„è¾ƒå¤§æš‚åœæ—¶é—´æ˜¯éå¸¸é‡è¦çš„ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä¸€ä¸ª<mark>äº¤äº’å¼åº”ç”¨ç¨‹åº</mark>ã€‚</p><p>ä¸å¹¸çš„æ˜¯â€é«˜ååé‡â€å’Œâ€ä½æš‚åœæ—¶é—´â€æ˜¯ä¸€å¯¹ç›¸äº’ç«äº‰çš„ç›®æ ‡ï¼ˆçŸ›ç›¾ï¼‰ã€‚</p><ul><li>å› ä¸ºå¦‚æœé€‰æ‹©ä»¥ååé‡ä¼˜å…ˆï¼Œé‚£ä¹ˆ<mark>å¿…ç„¶éœ€è¦é™ä½å†…å­˜å›æ”¶çš„æ‰§è¡Œé¢‘ç‡</mark>ï¼Œä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´ GC éœ€è¦æ›´é•¿çš„æš‚åœæ—¶é—´æ¥æ‰§è¡Œå†…å­˜å›æ”¶ã€‚</li><li>ç›¸åçš„ï¼Œå¦‚æœé€‰æ‹©ä»¥ä½å»¶è¿Ÿä¼˜å…ˆä¸ºåŸåˆ™ï¼Œé‚£ä¹ˆä¸ºäº†é™ä½æ¯æ¬¡æ‰§è¡Œå†…å­˜å›æ”¶æ—¶çš„æš‚åœæ—¶é—´ï¼Œä¹Ÿ<mark>åªèƒ½é¢‘ç¹åœ°æ‰§è¡Œå†…å­˜å›æ”¶</mark>ï¼Œä½†è¿™åˆå¼•èµ·äº†å¹´è½»ä»£å†…å­˜çš„ç¼©å‡å’Œå¯¼è‡´ç¨‹åºååé‡çš„ä¸‹é™ã€‚</li></ul><p>åœ¨è®¾è®¡ï¼ˆæˆ–ä½¿ç”¨ï¼‰GC ç®—æ³•æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®å®šæˆ‘ä»¬çš„ç›®æ ‡ï¼šä¸€ä¸ª GC ç®—æ³•åªå¯èƒ½é’ˆå¯¹ä¸¤ä¸ªç›®æ ‡ä¹‹ä¸€ï¼ˆå³åªä¸“æ³¨äºè¾ƒå¤§ååé‡æˆ–æœ€å°æš‚åœæ—¶é—´ï¼‰ï¼Œæˆ–å°è¯•æ‰¾åˆ°ä¸€ä¸ªäºŒè€…çš„æŠ˜è¡·ã€‚</p><p>ç°åœ¨æ ‡å‡†ï¼š<mark>åœ¨æœ€å¤§ååé‡ä¼˜å…ˆçš„æƒ…å†µä¸‹ï¼Œé™ä½åœé¡¿æ—¶é—´</mark></p><h2 id=132-ä¸åŒçš„åƒåœ¾å›æ”¶å™¨æ¦‚è¿°><a href=#132-%e4%b8%8d%e5%90%8c%e7%9a%84%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6%e5%99%a8%e6%a6%82%e8%bf%b0 class=header-anchor></a>13.2. ä¸åŒçš„åƒåœ¾å›æ”¶å™¨æ¦‚è¿°</h2><p>åƒåœ¾æ”¶é›†æœºåˆ¶æ˜¯ Java çš„æ‹›ç‰Œèƒ½åŠ›ï¼Œæå¤§åœ°æé«˜äº†å¼€å‘æ•ˆç‡ã€‚è¿™å½“ç„¶ä¹Ÿæ˜¯é¢è¯•çš„çƒ­ç‚¹ã€‚</p><h3 id=1321-åƒåœ¾å›æ”¶å™¨å‘å±•å²><a href=#1321-%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6%e5%99%a8%e5%8f%91%e5%b1%95%e5%8f%b2 class=header-anchor></a>13.2.1. åƒåœ¾å›æ”¶å™¨å‘å±•å²</h3><p>æœ‰äº†è™šæ‹Ÿæœºï¼Œå°±ä¸€å®šéœ€è¦æ”¶é›†åƒåœ¾çš„æœºåˆ¶ï¼Œè¿™å°±æ˜¯ Garbage Collectionï¼Œå¯¹åº”çš„äº§å“æˆ‘ä»¬ç§°ä¸º Garbage Collectorã€‚</p><ul><li>1999 å¹´éš JDK1.3.1 ä¸€èµ·æ¥çš„æ˜¯ä¸²è¡Œæ–¹å¼çš„ serialGcï¼Œå®ƒæ˜¯ç¬¬ä¸€æ¬¾ GCã€‚ParNew åƒåœ¾æ”¶é›†å™¨æ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬</li><li>2002 å¹´ 2 æœˆ 26 æ—¥ï¼ŒParallel GC å’Œ Concurrent Mark Sweep GC è·Ÿéš JDK1.4.2 ä¸€èµ·å‘å¸ƒÂ·</li><li>Parallel GC åœ¨ JDK6 ä¹‹åæˆä¸º HotSpot é»˜è®¤ GCã€‚</li><li>2012 å¹´ï¼Œåœ¨ JDK1.7u4 ç‰ˆæœ¬ä¸­ï¼ŒG1 å¯ç”¨ã€‚</li><li>2017 å¹´ï¼ŒJDK9 ä¸­ G1 å˜æˆé»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä»¥æ›¿ä»£ CMSã€‚</li><li>2018 å¹´ 3 æœˆï¼ŒJDK10 ä¸­ G1 åƒåœ¾å›æ”¶å™¨çš„å¹¶è¡Œå®Œæ•´åƒåœ¾å›æ”¶ï¼Œå®ç°å¹¶è¡Œæ€§æ¥æ”¹å–„æœ€åæƒ…å†µä¸‹çš„å»¶è¿Ÿã€‚</li><li>2018 å¹´ 9 æœˆï¼ŒJDK11 å‘å¸ƒã€‚å¼•å…¥ Epsilon åƒåœ¾å›æ”¶å™¨ï¼Œåˆè¢«ç§°ä¸º &ldquo;No-Op(æ— æ“ä½œ)â€œ å›æ”¶å™¨ã€‚åŒæ—¶ï¼Œå¼•å…¥ ZGCï¼šå¯ä¼¸ç¼©çš„ä½å»¶è¿Ÿåƒåœ¾å›æ”¶å™¨ï¼ˆExperimentalï¼‰</li><li>2019 å¹´ 3 æœˆï¼ŒJDK12 å‘å¸ƒã€‚å¢å¼º G1ï¼Œè‡ªåŠ¨è¿”å›æœªç”¨å †å†…å­˜ç»™æ“ä½œç³»ç»Ÿã€‚åŒæ—¶ï¼Œå¼•å…¥ Shenandoah GCï¼šä½åœé¡¿æ—¶é—´çš„ GCï¼ˆExperimentalï¼‰ã€‚Â·</li><li>2019 å¹´ 9 æœˆï¼ŒJDK13 å‘å¸ƒã€‚å¢å¼º ZGCï¼Œè‡ªåŠ¨è¿”å›æœªç”¨å †å†…å­˜ç»™æ“ä½œç³»ç»Ÿã€‚</li><li>2020 å¹´ 3 æœˆï¼ŒJDK14 å‘å¸ƒã€‚åˆ é™¤ CMS åƒåœ¾å›æ”¶å™¨ã€‚æ‰©å±• ZGC åœ¨ macos å’Œ Windows ä¸Šçš„åº”ç”¨</li></ul><h3 id=1322-7-ç§ç»å…¸çš„åƒåœ¾æ”¶é›†å™¨><a href=#1322-7-%e7%a7%8d%e7%bb%8f%e5%85%b8%e7%9a%84%e5%9e%83%e5%9c%be%e6%94%b6%e9%9b%86%e5%99%a8 class=header-anchor></a>13.2.2. 7 ç§ç»å…¸çš„åƒåœ¾æ”¶é›†å™¨</h3><ul><li>ä¸²è¡Œå›æ”¶å™¨ï¼šSerialã€Serial Old</li><li>å¹¶è¡Œå›æ”¶å™¨ï¼šParNewã€Parallel Scavengeã€Parallel old</li><li>å¹¶å‘å›æ”¶å™¨ï¼šCMSã€G1</li></ul><p><img src=https://logan.1357810.xyz/img/20220422/153020741-713d8b7f95.png width=900 height=600 loading=lazy decoding=async alt=image-20200713093551365 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p>å®˜æ–¹æ‰‹å†Œï¼š<a class=link href=https://www.oracle.com/technetwork/java/javase/tech/memorymanagement-whitepaper-1-150020.pdf target=_blank rel=noopener>https://www.oracle.com/technetwork/java/javase/tech/memorymanagement-whitepaper-1-150020.pdf
<span style=white-space:nowrap class="iconfont icon-arrow-up-right-from-square-solid"></span></a></p><p><img src=https://logan.1357810.xyz/img/20220422/153020741-9eddf061c1.png width=900 height=600 loading=lazy decoding=async alt=image-20210512145950897 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><h3 id=1323-7-æ¬¾ç»å…¸æ”¶é›†å™¨ä¸åƒåœ¾åˆ†ä»£ä¹‹é—´çš„å…³ç³»><a href=#1323-7-%e6%ac%be%e7%bb%8f%e5%85%b8%e6%94%b6%e9%9b%86%e5%99%a8%e4%b8%8e%e5%9e%83%e5%9c%be%e5%88%86%e4%bb%a3%e4%b9%8b%e9%97%b4%e7%9a%84%e5%85%b3%e7%b3%bb class=header-anchor></a>13.2.3. 7 æ¬¾ç»å…¸æ”¶é›†å™¨ä¸åƒåœ¾åˆ†ä»£ä¹‹é—´çš„å…³ç³»</h3><p><img src=https://logan.1357810.xyz/img/20220422/153020741-21122e2f67.png width=900 height=600 loading=lazy decoding=async alt=image-20200713093757644 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><ul><li><p>æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼šSerialã€ParNewã€Parallel Scavengeï¼›</p></li><li><p>è€å¹´ä»£æ”¶é›†å™¨ï¼šSerial Oldã€Parallel Oldã€CMSï¼›</p></li><li><p>æ•´å †æ”¶é›†å™¨ï¼šG1ï¼›</p></li></ul><h3 id=1324-åƒåœ¾æ”¶é›†å™¨çš„ç»„åˆå…³ç³»><a href=#1324-%e5%9e%83%e5%9c%be%e6%94%b6%e9%9b%86%e5%99%a8%e7%9a%84%e7%bb%84%e5%90%88%e5%85%b3%e7%b3%bb class=header-anchor></a>13.2.4. åƒåœ¾æ”¶é›†å™¨çš„ç»„åˆå…³ç³»</h3><p><img src=https://logan.1357810.xyz/img/20220422/153020741-4fcb28e52d.png width=900 height=600 loading=lazy decoding=async alt=image-20200713094745366 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><ol><li>ä¸¤ä¸ªæ”¶é›†å™¨é—´æœ‰è¿çº¿ï¼Œè¡¨æ˜å®ƒä»¬å¯ä»¥æ­é…ä½¿ç”¨ï¼šSerial/Serial Oldã€Serial/CMSã€ParNew/Serial Oldã€ParNew/CMSã€Parallel Scavenge/Serial Oldã€Parallel Scavenge/Parallel Oldã€G1ï¼›</li><li>å…¶ä¸­ Serial Old ä½œä¸º CMS å‡ºç°&rdquo;<code>Concurrent Mode Failure</code>&ldquo;å¤±è´¥çš„åå¤‡é¢„æ¡ˆã€‚</li><li>ï¼ˆçº¢è‰²è™šçº¿ï¼‰ç”±äºç»´æŠ¤å’Œå…¼å®¹æ€§æµ‹è¯•çš„æˆæœ¬ï¼Œåœ¨ JDK 8 æ—¶å°† Serial+CMSã€ParNew+Serial Old è¿™ä¸¤ä¸ªç»„åˆå£°æ˜ä¸ºåºŸå¼ƒï¼ˆJEP173ï¼‰ï¼Œå¹¶åœ¨ JDK9 ä¸­å®Œå…¨å–æ¶ˆäº†è¿™äº›ç»„åˆçš„æ”¯æŒï¼ˆJEP214ï¼‰ï¼Œå³ï¼šç§»é™¤ã€‚</li><li>ï¼ˆç»¿è‰²è™šçº¿ï¼‰JDK14 ä¸­ï¼šå¼ƒç”¨ Parallel Scavenge å’Œ Serialold GC ç»„åˆï¼ˆJEP366ï¼‰</li><li>ï¼ˆç»¿è‰²è™šæ¡†ï¼‰JDK14 ä¸­ï¼šåˆ é™¤ CMS åƒåœ¾å›æ”¶å™¨ï¼ˆJEP363ï¼‰</li></ol><h3 id=1325-ä¸åŒçš„åƒåœ¾æ”¶é›†å™¨æ¦‚è¿°><a href=#1325-%e4%b8%8d%e5%90%8c%e7%9a%84%e5%9e%83%e5%9c%be%e6%94%b6%e9%9b%86%e5%99%a8%e6%a6%82%e8%bf%b0 class=header-anchor></a>13.2.5. ä¸åŒçš„åƒåœ¾æ”¶é›†å™¨æ¦‚è¿°</h3><p>ä¸ºä»€ä¹ˆè¦æœ‰å¾ˆå¤šæ”¶é›†å™¨ï¼Œä¸€ä¸ªä¸å¤Ÿå—ï¼Ÿå› ä¸º Java çš„ä½¿ç”¨åœºæ™¯å¾ˆå¤šï¼Œç§»åŠ¨ç«¯ï¼ŒæœåŠ¡å™¨ç­‰ã€‚æ‰€ä»¥å°±éœ€è¦é’ˆå¯¹ä¸åŒçš„åœºæ™¯ï¼Œæä¾›ä¸åŒçš„åƒåœ¾æ”¶é›†å™¨ï¼Œæé«˜åƒåœ¾æ”¶é›†çš„æ€§èƒ½ã€‚</p><p>è™½ç„¶æˆ‘ä»¬ä¼šå¯¹å„ä¸ªæ”¶é›†å™¨è¿›è¡Œæ¯”è¾ƒï¼Œä½†å¹¶éä¸ºäº†æŒ‘é€‰ä¸€ä¸ªæœ€å¥½çš„æ”¶é›†å™¨å‡ºæ¥ã€‚æ²¡æœ‰ä¸€ç§æ”¾ä¹‹å››æµ·çš†å‡†ã€ä»»ä½•åœºæ™¯ä¸‹éƒ½é€‚ç”¨çš„å®Œç¾æ”¶é›†å™¨å­˜åœ¨ï¼Œæ›´åŠ æ²¡æœ‰ä¸‡èƒ½çš„æ”¶é›†å™¨ã€‚æ‰€ä»¥<mark>æˆ‘ä»¬é€‰æ‹©çš„åªæ˜¯å¯¹å…·ä½“åº”ç”¨æœ€åˆé€‚çš„æ”¶é›†å™¨</mark>ã€‚</p><h3 id=1326-å¦‚ä½•æŸ¥çœ‹é»˜è®¤åƒåœ¾æ”¶é›†å™¨><a href=#1326-%e5%a6%82%e4%bd%95%e6%9f%a5%e7%9c%8b%e9%bb%98%e8%ae%a4%e5%9e%83%e5%9c%be%e6%94%b6%e9%9b%86%e5%99%a8 class=header-anchor></a>13.2.6. å¦‚ä½•æŸ¥çœ‹é»˜è®¤åƒåœ¾æ”¶é›†å™¨</h3><p><code>-XX:+PrintCommandLineFlags</code>ï¼šæŸ¥çœ‹å‘½ä»¤è¡Œç›¸å…³å‚æ•°ï¼ˆåŒ…å«ä½¿ç”¨çš„åƒåœ¾æ”¶é›†å™¨ï¼‰</p><p>ä½¿ç”¨å‘½ä»¤è¡ŒæŒ‡ä»¤ï¼š<code>jinfo -flag ç›¸å…³åƒåœ¾å›æ”¶å™¨å‚æ•° è¿›ç¨‹ID</code></p><h2 id=133-serial-å›æ”¶å™¨ä¸²è¡Œå›æ”¶><a href=#133-serial-%e5%9b%9e%e6%94%b6%e5%99%a8%e4%b8%b2%e8%a1%8c%e5%9b%9e%e6%94%b6 class=header-anchor></a>13.3. Serial å›æ”¶å™¨ï¼šä¸²è¡Œå›æ”¶</h2><p>Serial æ”¶é›†å™¨æ˜¯æœ€åŸºæœ¬ã€å†å²æœ€æ‚ ä¹…çš„åƒåœ¾æ”¶é›†å™¨äº†ã€‚JDK1.3 ä¹‹å‰å›æ”¶æ–°ç”Ÿä»£å”¯ä¸€çš„é€‰æ‹©ã€‚</p><p>Serial æ”¶é›†å™¨ä½œä¸º HotSpot ä¸­ client æ¨¡å¼ä¸‹çš„é»˜è®¤æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†å™¨ã€‚</p><p><mark>Serial æ”¶é›†å™¨é‡‡ç”¨å¤åˆ¶ç®—æ³•ã€ä¸²è¡Œå›æ”¶å’Œ"stop-the-World"æœºåˆ¶çš„æ–¹å¼æ‰§è¡Œå†…å­˜å›æ”¶ã€‚</mark></p><p>é™¤äº†å¹´è½»ä»£ä¹‹å¤–ï¼ŒSerial æ”¶é›†å™¨è¿˜æä¾›ç”¨äºæ‰§è¡Œè€å¹´ä»£åƒåœ¾æ”¶é›†çš„ Serial Old æ”¶é›†å™¨ã€‚<mark>Serial Old æ”¶é›†å™¨åŒæ ·ä¹Ÿé‡‡ç”¨äº†ä¸²è¡Œå›æ”¶å’Œ"Stop the World"æœºåˆ¶ï¼Œåªä¸è¿‡å†…å­˜å›æ”¶ç®—æ³•ä½¿ç”¨çš„æ˜¯æ ‡è®°-å‹ç¼©ç®—æ³•ã€‚</mark></p><ul><li>Serial old æ˜¯è¿è¡Œåœ¨ Client æ¨¡å¼ä¸‹é»˜è®¤çš„è€å¹´ä»£çš„åƒåœ¾å›æ”¶å™¨</li><li>Serial 0ld åœ¨ Server æ¨¡å¼ä¸‹ä¸»è¦æœ‰ä¸¤ä¸ªç”¨é€”ï¼šâ‘  ä¸æ–°ç”Ÿä»£çš„ Parallel scavenge é…åˆä½¿ç”¨ â‘¡ ä½œä¸ºè€å¹´ä»£ CMS æ”¶é›†å™¨çš„åå¤‡åƒåœ¾æ”¶é›†æ–¹æ¡ˆ</li></ul><p><img src=https://logan.1357810.xyz/img/20220422/153020741-b01bfd4b4b.png width=900 height=600 loading=lazy decoding=async alt=image-20200713100703799 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p>è¿™ä¸ªæ”¶é›†å™¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„æ”¶é›†å™¨ï¼Œä½†å®ƒçš„â€œå•çº¿ç¨‹â€çš„æ„ä¹‰å¹¶ä¸ä»…ä»…è¯´æ˜å®ƒåªä¼š<mark>ä½¿ç”¨ä¸€ä¸ª CPU æˆ–ä¸€æ¡æ”¶é›†çº¿ç¨‹å»å®Œæˆåƒåœ¾æ”¶é›†å·¥ä½œ</mark>ï¼Œæ›´é‡è¦çš„æ˜¯åœ¨å®ƒè¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œ<mark>å¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹</mark>ï¼Œç›´åˆ°å®ƒæ”¶é›†ç»“æŸï¼ˆStop The Worldï¼‰</p><p>ä¼˜åŠ¿ï¼š<mark>ç®€å•è€Œé«˜æ•ˆ</mark>ï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹æ¯”ï¼‰ï¼Œå¯¹äºé™å®šå•ä¸ª CPU çš„ç¯å¢ƒæ¥è¯´ï¼ŒSerial æ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œä¸“å¿ƒåšåƒåœ¾æ”¶é›†è‡ªç„¶å¯ä»¥è·å¾—æœ€é«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ã€‚è¿è¡Œåœ¨ Client æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><p>åœ¨ç”¨æˆ·çš„æ¡Œé¢åº”ç”¨åœºæ™¯ä¸­ï¼Œå¯ç”¨å†…å­˜ä¸€èˆ¬ä¸å¤§ï¼ˆå‡ å MB è‡³ä¸€ä¸¤ç™¾ MBï¼‰ï¼Œå¯ä»¥åœ¨è¾ƒçŸ­æ—¶é—´å†…å®Œæˆåƒåœ¾æ”¶é›†ï¼ˆå‡ å ms è‡³ä¸€ç™¾å¤š msï¼‰ï¼Œåªè¦ä¸é¢‘ç¹å‘ç”Ÿï¼Œä½¿ç”¨ä¸²è¡Œå›æ”¶å™¨æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p><p>åœ¨ HotSpot è™šæ‹Ÿæœºä¸­ï¼Œä½¿ç”¨<code>-XX:+UseSerialGC</code>å‚æ•°å¯ä»¥æŒ‡å®šå¹´è½»ä»£å’Œè€å¹´ä»£éƒ½ä½¿ç”¨ä¸²è¡Œæ”¶é›†å™¨ã€‚ç­‰ä»·äºæ–°ç”Ÿä»£ç”¨ Serial GCï¼Œä¸”è€å¹´ä»£ç”¨ Serial Old GC</p><p><strong>æ€»ç»“</strong></p><p>è¿™ç§åƒåœ¾æ”¶é›†å™¨å¤§å®¶äº†è§£ï¼Œç°åœ¨å·²ç»ä¸ç”¨ä¸²è¡Œçš„äº†ã€‚è€Œä¸”åœ¨é™å®šå•æ ¸ cpu æ‰å¯ä»¥ç”¨ã€‚ç°åœ¨éƒ½ä¸æ˜¯å•æ ¸çš„äº†ã€‚</p><p>å¯¹äºäº¤äº’è¾ƒå¼ºçš„åº”ç”¨è€Œè¨€ï¼Œè¿™ç§åƒåœ¾æ”¶é›†å™¨æ˜¯ä¸èƒ½æ¥å—çš„ã€‚ä¸€èˆ¬åœ¨ Java web åº”ç”¨ç¨‹åºä¸­æ˜¯ä¸ä¼šé‡‡ç”¨ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨çš„ã€‚</p><h2 id=134-parnew-å›æ”¶å™¨å¹¶è¡Œå›æ”¶><a href=#134-parnew-%e5%9b%9e%e6%94%b6%e5%99%a8%e5%b9%b6%e8%a1%8c%e5%9b%9e%e6%94%b6 class=header-anchor></a>13.4. ParNew å›æ”¶å™¨ï¼šå¹¶è¡Œå›æ”¶</h2><p>å¦‚æœè¯´ Serial GC æ˜¯å¹´è½»ä»£ä¸­çš„å•çº¿ç¨‹åƒåœ¾æ”¶é›†å™¨ï¼Œé‚£ä¹ˆ ParNew æ”¶é›†å™¨åˆ™æ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚Par æ˜¯ Parallel çš„ç¼©å†™ï¼ŒNewï¼šåªèƒ½å¤„ç†çš„æ˜¯æ–°ç”Ÿä»£</p><p>ParNew æ”¶é›†å™¨é™¤äº†é‡‡ç”¨<mark>å¹¶è¡Œå›æ”¶</mark>çš„æ–¹å¼æ‰§è¡Œå†…å­˜å›æ”¶å¤–ï¼Œä¸¤æ¬¾åƒåœ¾æ”¶é›†å™¨ä¹‹é—´å‡ ä¹æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚ParNew æ”¶é›†å™¨åœ¨å¹´è½»ä»£ä¸­åŒæ ·ä¹Ÿæ˜¯é‡‡ç”¨<mark>å¤åˆ¶ç®—æ³•ã€&ldquo;Stop-the-World"æœºåˆ¶</mark>ã€‚</p><p>ParNew æ˜¯å¾ˆå¤š JVM è¿è¡Œåœ¨ Server æ¨¡å¼ä¸‹æ–°ç”Ÿä»£çš„é»˜è®¤åƒåœ¾æ”¶é›†å™¨ã€‚</p><p><img src=https://logan.1357810.xyz/img/20220422/153020741-cd953aeb4e.png width=900 height=600 loading=lazy decoding=async alt=image-20200713102030127 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><ul><li>å¯¹äºæ–°ç”Ÿä»£ï¼Œå›æ”¶æ¬¡æ•°é¢‘ç¹ï¼Œä½¿ç”¨å¹¶è¡Œæ–¹å¼é«˜æ•ˆã€‚</li><li>å¯¹äºè€å¹´ä»£ï¼Œå›æ”¶æ¬¡æ•°å°‘ï¼Œä½¿ç”¨ä¸²è¡Œæ–¹å¼èŠ‚çœèµ„æºã€‚ï¼ˆCPU å¹¶è¡Œéœ€è¦åˆ‡æ¢çº¿ç¨‹ï¼Œä¸²è¡Œå¯ä»¥çœå»åˆ‡æ¢çº¿ç¨‹çš„èµ„æºï¼‰</li></ul><p>ç”±äº ParNew æ”¶é›†å™¨æ˜¯åŸºäºå¹¶è¡Œå›æ”¶ï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥æ–­å®š ParNew æ”¶é›†å™¨çš„å›æ”¶æ•ˆç‡åœ¨ä»»ä½•åœºæ™¯ä¸‹éƒ½ä¼šæ¯” serial æ”¶é›†å™¨æ›´é«˜æ•ˆï¼Ÿ</p><ul><li>ParNew æ”¶é›†å™¨è¿è¡Œåœ¨å¤š CPU çš„ç¯å¢ƒä¸‹ï¼Œç”±äºå¯ä»¥å……åˆ†åˆ©ç”¨å¤š CPUã€å¤šæ ¸å¿ƒç­‰ç‰©ç†ç¡¬ä»¶èµ„æºä¼˜åŠ¿ï¼Œå¯ä»¥æ›´å¿«é€Ÿåœ°å®Œæˆåƒåœ¾æ”¶é›†ï¼Œæå‡ç¨‹åºçš„ååé‡ã€‚</li><li>ä½†æ˜¯<mark>åœ¨å•ä¸ª CPU çš„ç¯å¢ƒä¸‹ï¼ŒParNew æ”¶é›†å™¨ä¸æ¯” Serial æ”¶é›†å™¨æ›´é«˜æ•ˆ</mark>ã€‚è™½ç„¶ Serial æ”¶é›†å™¨æ˜¯åŸºäºä¸²è¡Œå›æ”¶ï¼Œä½†æ˜¯ç”±äº CPU ä¸éœ€è¦é¢‘ç¹åœ°åšä»»åŠ¡åˆ‡æ¢ï¼Œå› æ­¤å¯ä»¥æœ‰æ•ˆé¿å…å¤šçº¿ç¨‹äº¤äº’è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸€äº›é¢å¤–å¼€é”€ã€‚</li></ul><p>å› ä¸ºé™¤ Serial å¤–ï¼Œç›®å‰åªæœ‰ ParNew GC èƒ½ä¸ CMS æ”¶é›†å™¨é…åˆå·¥ä½œ</p><p>åœ¨ç¨‹åºä¸­ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡é€‰é¡¹&rdquo;<code>-XX:+UseParNewGC</code>&ldquo;æ‰‹åŠ¨æŒ‡å®šä½¿ç”¨ ParNew æ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡ã€‚å®ƒè¡¨ç¤ºå¹´è½»ä»£ä½¿ç”¨å¹¶è¡Œæ”¶é›†å™¨ï¼Œä¸å½±å“è€å¹´ä»£ã€‚</p><p><code>-XX:ParallelGCThreads</code>é™åˆ¶çº¿ç¨‹æ•°é‡ï¼Œé»˜è®¤å¼€å¯å’Œ CPU æ ¸å¿ƒæ•°ç›¸åŒçš„çº¿ç¨‹æ•°ã€‚</p><h2 id=135-parallel-å›æ”¶å™¨ååé‡ä¼˜å…ˆ><a href=#135-parallel-%e5%9b%9e%e6%94%b6%e5%99%a8%e5%90%9e%e5%90%90%e9%87%8f%e4%bc%98%e5%85%88 class=header-anchor></a>13.5. Parallel å›æ”¶å™¨ï¼šååé‡ä¼˜å…ˆ</h2><p>HotSpot çš„å¹´è½»ä»£ä¸­é™¤äº†æ‹¥æœ‰ ParNew æ”¶é›†å™¨æ˜¯åŸºäºå¹¶è¡Œå›æ”¶çš„ä»¥å¤–ï¼ŒParallel Scavenge æ”¶é›†å™¨åŒæ ·ä¹Ÿé‡‡ç”¨äº†<mark>å¤åˆ¶ç®—æ³•ã€å¹¶è¡Œå›æ”¶å’Œ"Stop the World"æœºåˆ¶</mark>ã€‚</p><p>é‚£ä¹ˆ Parallel æ”¶é›†å™¨çš„å‡ºç°æ˜¯å¦å¤šæ­¤ä¸€ä¸¾ï¼Ÿ</p><ul><li>å’Œ ParNew æ”¶é›†å™¨ä¸åŒï¼ŒParallelScavenge æ”¶é›†å™¨çš„ç›®æ ‡åˆ™æ˜¯è¾¾åˆ°ä¸€ä¸ª<mark>å¯æ§åˆ¶çš„ååé‡</mark>ï¼ˆThroughputï¼‰ï¼Œå®ƒä¹Ÿè¢«ç§°ä¸ºååé‡ä¼˜å…ˆçš„åƒåœ¾æ”¶é›†å™¨ã€‚</li><li>è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ä¹Ÿæ˜¯ Parallel Scavenge ä¸ ParNew ä¸€ä¸ªé‡è¦åŒºåˆ«ã€‚</li></ul><p>é«˜ååé‡åˆ™å¯ä»¥é«˜æ•ˆç‡åœ°åˆ©ç”¨ CPU æ—¶é—´ï¼Œå°½å¿«å®Œæˆç¨‹åºçš„è¿ç®—ä»»åŠ¡ï¼Œä¸»è¦<mark>é€‚åˆåœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡</mark>ã€‚å› æ­¤ï¼Œå¸¸è§åœ¨æœåŠ¡å™¨ç¯å¢ƒä¸­ä½¿ç”¨ã€‚<mark>ä¾‹å¦‚ï¼Œé‚£äº›æ‰§è¡Œæ‰¹é‡å¤„ç†ã€è®¢å•å¤„ç†ã€å·¥èµ„æ”¯ä»˜ã€ç§‘å­¦è®¡ç®—çš„åº”ç”¨ç¨‹åº</mark>ã€‚</p><p>Parallel æ”¶é›†å™¨åœ¨ JDK1.6 æ—¶æä¾›äº†ç”¨äºæ‰§è¡Œè€å¹´ä»£åƒåœ¾æ”¶é›†çš„ Parallel Old æ”¶é›†å™¨ï¼Œç”¨æ¥ä»£æ›¿è€å¹´ä»£çš„ Serial Old æ”¶é›†å™¨ã€‚</p><p>Parallel Old æ”¶é›†å™¨é‡‡ç”¨äº†<mark>æ ‡è®°-å‹ç¼©ç®—æ³•</mark>ï¼Œä½†åŒæ ·ä¹Ÿæ˜¯åŸºäº<mark>å¹¶è¡Œå›æ”¶å’Œ"Stop-the-World"æœºåˆ¶</mark>ã€‚</p><p><img src=https://logan.1357810.xyz/img/20220422/153020741-6f0874edf6.png width=900 height=600 loading=lazy decoding=async alt=image-20200713110359441 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p>åœ¨ç¨‹åºååé‡ä¼˜å…ˆçš„åº”ç”¨åœºæ™¯ä¸­ï¼ŒParallel æ”¶é›†å™¨å’Œ Parallel Old æ”¶é›†å™¨çš„ç»„åˆï¼Œåœ¨ Server æ¨¡å¼ä¸‹çš„å†…å­˜å›æ”¶æ€§èƒ½å¾ˆä¸é”™ã€‚åœ¨ Java8 ä¸­ï¼Œé»˜è®¤æ˜¯æ­¤åƒåœ¾æ”¶é›†å™¨ã€‚</p><p><strong>å‚æ•°é…ç½®</strong></p><ul><li><p><code>-XX:+UseParallelGC</code> æ‰‹åŠ¨æŒ‡å®šå¹´è½»ä»£ä½¿ç”¨ Parallel å¹¶è¡Œæ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡ã€‚</p></li><li><p><code>-XX:+UseParallelOldGC</code> æ‰‹åŠ¨æŒ‡å®šè€å¹´ä»£éƒ½æ˜¯ä½¿ç”¨å¹¶è¡Œå›æ”¶æ”¶é›†å™¨ã€‚</p><ul><li>åˆ†åˆ«é€‚ç”¨äºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚é»˜è®¤ jdk8 æ˜¯å¼€å¯çš„ã€‚</li><li>ä¸Šé¢ä¸¤ä¸ªå‚æ•°ï¼Œé»˜è®¤å¼€å¯ä¸€ä¸ªï¼Œå¦ä¸€ä¸ªä¹Ÿä¼šè¢«å¼€å¯ã€‚ï¼ˆäº’ç›¸æ¿€æ´»ï¼‰</li></ul></li><li><p><code>-XX:ParallelGCThreads</code> è®¾ç½®å¹´è½»ä»£å¹¶è¡Œæ”¶é›†å™¨çš„çº¿ç¨‹æ•°ã€‚ä¸€èˆ¬åœ°ï¼Œæœ€å¥½ä¸ CPU æ•°é‡ç›¸ç­‰ï¼Œä»¥é¿å…è¿‡å¤šçš„çº¿ç¨‹æ•°å½±å“åƒåœ¾æ”¶é›†æ€§èƒ½ã€‚</p><p>$$ ParallelGCThreads = \begin{cases} CPU_Count & \text (CPU_Count &lt;= 8) \ 3 + (5 * CPUï¼¿Count / 8) & \text (CPU_Count > 8) \end{cases} $$</p></li><li><p><code>-XX:MaxGCPauseMillis</code> è®¾ç½®åƒåœ¾æ”¶é›†å™¨æœ€å¤§åœé¡¿æ—¶é—´ï¼ˆå³ STw çš„æ—¶é—´ï¼‰ã€‚å•ä½æ˜¯æ¯«ç§’ã€‚</p><ul><li>ä¸ºäº†å°½å¯èƒ½åœ°æŠŠåœé¡¿æ—¶é—´æ§åˆ¶åœ¨ MaxGCPauseMills ä»¥å†…ï¼Œæ”¶é›†å™¨åœ¨å·¥ä½œæ—¶ä¼šè°ƒæ•´ Java å †å¤§å°æˆ–è€…å…¶ä»–ä¸€äº›å‚æ•°ã€‚</li><li>å¯¹äºç”¨æˆ·æ¥è®²ï¼Œåœé¡¿æ—¶é—´è¶ŠçŸ­ä½“éªŒè¶Šå¥½ã€‚ä½†æ˜¯åœ¨æœåŠ¡å™¨ç«¯ï¼Œæˆ‘ä»¬æ³¨é‡é«˜å¹¶å‘ï¼Œæ•´ä½“çš„ååé‡ã€‚æ‰€ä»¥æœåŠ¡å™¨ç«¯é€‚åˆ Parallelï¼Œè¿›è¡Œæ§åˆ¶ã€‚</li><li><mark>è¯¥å‚æ•°ä½¿ç”¨éœ€è°¨æ…</mark>ã€‚</li></ul></li><li><p><code>-XX:GCTimeRatio</code> åƒåœ¾æ”¶é›†æ—¶é—´å æ€»æ—¶é—´çš„æ¯”ä¾‹ï¼ˆ=1/ï¼ˆN+1ï¼‰ï¼‰ã€‚ç”¨äºè¡¡é‡ååé‡çš„å¤§å°ã€‚</p><ul><li>å–å€¼èŒƒå›´ï¼ˆ0, 100ï¼‰ã€‚é»˜è®¤å€¼ 99ï¼Œä¹Ÿå°±æ˜¯åƒåœ¾å›æ”¶æ—¶é—´ä¸è¶…è¿‡ 1%ã€‚</li><li>ä¸å‰ä¸€ä¸ª<code>-XX:MaxGCPauseMillis </code>å‚æ•°æœ‰ä¸€å®šçŸ›ç›¾æ€§ã€‚æš‚åœæ—¶é—´è¶Šé•¿ï¼ŒRadio å‚æ•°å°±å®¹æ˜“è¶…è¿‡è®¾å®šçš„æ¯”ä¾‹ã€‚</li></ul></li><li><p><code>-XX:+UseAdaptivesizePolicy</code> è®¾ç½® Parallel Scavenge æ”¶é›†å™¨å…·æœ‰<mark>è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥</mark></p><ul><li>åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¹´è½»ä»£çš„å¤§å°ã€Eden å’Œ Survivor çš„æ¯”ä¾‹ã€æ™‹å‡è€å¹´ä»£çš„å¯¹è±¡å¹´é¾„ç­‰å‚æ•°ä¼šè¢«è‡ªåŠ¨è°ƒæ•´ï¼Œå·²è¾¾åˆ°åœ¨å †å¤§å°ã€ååé‡å’Œåœé¡¿æ—¶é—´ä¹‹é—´çš„å¹³è¡¡ç‚¹ã€‚</li><li>åœ¨æ‰‹åŠ¨è°ƒä¼˜æ¯”è¾ƒå›°éš¾çš„åœºåˆï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ç§è‡ªé€‚åº”çš„æ–¹å¼ï¼Œä»…æŒ‡å®šè™šæ‹Ÿæœºçš„æœ€å¤§å †ã€ç›®æ ‡çš„ååé‡ï¼ˆ<code>GCTimeRatio</code>ï¼‰å’Œåœé¡¿æ—¶é—´ï¼ˆ<code>MaxGCPauseMills</code>ï¼‰ï¼Œè®©è™šæ‹Ÿæœºè‡ªå·±å®Œæˆè°ƒä¼˜å·¥ä½œã€‚</li></ul></li></ul><h2 id=136-cms-å›æ”¶å™¨ä½å»¶è¿Ÿ><a href=#136-cms-%e5%9b%9e%e6%94%b6%e5%99%a8%e4%bd%8e%e5%bb%b6%e8%bf%9f class=header-anchor></a>13.6. CMS å›æ”¶å™¨ï¼šä½å»¶è¿Ÿ</h2><p>åœ¨ JDK1.5 æ—¶æœŸï¼ŒHotspot æ¨å‡ºäº†ä¸€æ¬¾åœ¨<mark>å¼ºäº¤äº’åº”ç”¨</mark>ä¸­å‡ ä¹å¯è®¤ä¸ºæœ‰åˆ’æ—¶ä»£æ„ä¹‰çš„åƒåœ¾æ”¶é›†å™¨ï¼šCMSï¼ˆConcurrent-Mark-Sweepï¼‰æ”¶é›†å™¨ï¼Œ<mark>è¿™æ¬¾æ”¶é›†å™¨æ˜¯ HotSpot è™šæ‹Ÿæœºä¸­ç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘æ”¶é›†å™¨ï¼Œå®ƒç¬¬ä¸€æ¬¡å®ç°äº†è®©åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å·¥ä½œ</mark>ã€‚</p><p>CMS æ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ˜¯å°½å¯èƒ½ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ã€‚åœé¡¿æ—¶é—´è¶ŠçŸ­ï¼ˆä½å»¶è¿Ÿï¼‰å°±è¶Šé€‚åˆä¸ç”¨æˆ·äº¤äº’çš„ç¨‹åºï¼Œè‰¯å¥½çš„å“åº”é€Ÿåº¦èƒ½æå‡ç”¨æˆ·ä½“éªŒã€‚</p><ul><li><mark>ç›®å‰å¾ˆå¤§ä¸€éƒ¨åˆ†çš„ Java åº”ç”¨é›†ä¸­åœ¨äº’è”ç½‘ç«™æˆ–è€… B/S ç³»ç»Ÿçš„æœåŠ¡ç«¯ä¸Šï¼Œè¿™ç±»åº”ç”¨å°¤å…¶é‡è§†æœåŠ¡çš„å“åº”é€Ÿåº¦ï¼Œå¸Œæœ›ç³»ç»Ÿåœé¡¿æ—¶é—´æœ€çŸ­</mark>ï¼Œä»¥ç»™ç”¨æˆ·å¸¦æ¥è¾ƒå¥½çš„ä½“éªŒã€‚CMS æ”¶é›†å™¨å°±éå¸¸ç¬¦åˆè¿™ç±»åº”ç”¨çš„éœ€æ±‚ã€‚</li></ul><p>CMS çš„åƒåœ¾æ”¶é›†ç®—æ³•é‡‡ç”¨<mark>æ ‡è®°-æ¸…é™¤ç®—æ³•</mark>ï¼Œå¹¶ä¸”ä¹Ÿä¼š"Stop-the-World&rdquo;</p><p>ä¸å¹¸çš„æ˜¯ï¼ŒCMS ä½œä¸ºè€å¹´ä»£çš„æ”¶é›†å™¨ï¼Œå´æ— æ³•ä¸ JDK1.4.0 ä¸­å·²ç»å­˜åœ¨çš„æ–°ç”Ÿä»£æ”¶é›†å™¨ Parallel Scavenge é…åˆå·¥ä½œï¼Œæ‰€ä»¥åœ¨ JDK1.5 ä¸­ä½¿ç”¨ CMS æ¥æ”¶é›†è€å¹´ä»£çš„æ—¶å€™ï¼Œæ–°ç”Ÿä»£åªèƒ½é€‰æ‹© ParNew æˆ–è€… Serial æ”¶é›†å™¨ä¸­çš„ä¸€ä¸ªã€‚</p><p>åœ¨ G1 å‡ºç°ä¹‹å‰ï¼ŒCMS ä½¿ç”¨è¿˜æ˜¯éå¸¸å¹¿æ³›çš„ã€‚ä¸€ç›´åˆ°ä»Šå¤©ï¼Œä»ç„¶æœ‰å¾ˆå¤šç³»ç»Ÿä½¿ç”¨ CMS GCã€‚</p><p><img src=https://logan.1357810.xyz/img/20220422/153020741-66f93a72ad.png width=900 height=600 loading=lazy decoding=async alt=image-20200713205154007 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p>CMS æ•´ä¸ªè¿‡ç¨‹æ¯”ä¹‹å‰çš„æ”¶é›†å™¨è¦å¤æ‚ï¼Œæ•´ä¸ªè¿‡ç¨‹åˆ†ä¸º 4 ä¸ªä¸»è¦é˜¶æ®µï¼Œå³åˆå§‹æ ‡è®°é˜¶æ®µã€å¹¶å‘æ ‡è®°é˜¶æ®µã€é‡æ–°æ ‡è®°é˜¶æ®µå’Œå¹¶å‘æ¸…é™¤é˜¶æ®µ</p><ul><li><strong>åˆå§‹æ ‡è®°</strong>ï¼ˆInitial-Markï¼‰é˜¶æ®µï¼šåœ¨è¿™ä¸ªé˜¶æ®µä¸­ï¼Œç¨‹åºä¸­æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹éƒ½å°†ä¼šå› ä¸ºâ€œStop-the-Worldâ€æœºåˆ¶è€Œå‡ºç°çŸ­æš‚çš„æš‚åœï¼Œè¿™ä¸ªé˜¶æ®µçš„ä¸»è¦ä»»åŠ¡<mark>ä»…ä»…åªæ˜¯æ ‡è®°å‡º GCRoots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡</mark>ã€‚ä¸€æ—¦æ ‡è®°å®Œæˆä¹‹åå°±ä¼šæ¢å¤ä¹‹å‰è¢«æš‚åœçš„æ‰€æœ‰åº”ç”¨çº¿ç¨‹ã€‚ç”±äºç›´æ¥å…³è”å¯¹è±¡æ¯”è¾ƒå°ï¼Œæ‰€ä»¥è¿™é‡Œçš„<mark>é€Ÿåº¦éå¸¸å¿«</mark>ã€‚</li><li><strong>å¹¶å‘æ ‡è®°</strong>ï¼ˆConcurrent-Markï¼‰é˜¶æ®µï¼šä» GC Roots çš„<mark>ç›´æ¥å…³è”å¯¹è±¡å¼€å§‹éå†æ•´ä¸ªå¯¹è±¡å›¾çš„è¿‡ç¨‹</mark>ï¼Œè¿™ä¸ªè¿‡ç¨‹è€—æ—¶è¾ƒé•¿ä½†æ˜¯<mark>ä¸éœ€è¦åœé¡¿ç”¨æˆ·çº¿ç¨‹</mark>ï¼Œå¯ä»¥ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸€èµ·å¹¶å‘è¿è¡Œã€‚ä½†æ˜¯å¯èƒ½ä¼šå¯¼è‡´å·²ç»æ ‡è®°è¿‡çš„å¯¹è±¡çŠ¶æ€å‘ç”Ÿæ”¹å˜ã€‚</li><li><strong>é‡æ–°æ ‡è®°</strong>ï¼ˆRemarkï¼‰é˜¶æ®µï¼šç”±äºåœ¨å¹¶å‘æ ‡è®°é˜¶æ®µä¸­ï¼Œç¨‹åºçš„å·¥ä½œçº¿ç¨‹ä¼šå’Œåƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶è¿è¡Œæˆ–è€…äº¤å‰è¿è¡Œï¼Œå› æ­¤ä¸ºäº†<mark>ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´ï¼Œå› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•</mark>ï¼Œè¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´é€šå¸¸ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µç¨é•¿ä¸€äº›ï¼Œä½†ä¹Ÿè¿œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µçš„æ—¶é—´çŸ­ã€‚</li><li><strong>å¹¶å‘æ¸…é™¤</strong>ï¼ˆConcurrent-Sweepï¼‰é˜¶æ®µï¼šGCçº¿ç¨‹å¼€å§‹å¯¹æœªæ ‡è®°çš„åŒºåŸŸåšæ¸…æ‰«ï¼Œé‡Šæ”¾å†…å­˜ç©ºé—´ï¼Œè¿™ä¸ªé˜¶æ®µå¦‚æœæœ‰æ–°å¢å¯¹è±¡ä¼šè¢«æ ‡è®°ä¸ºé»‘è‰²ï¼Œä¸åšä»»ä½•å¤„ç†ã€‚ç”±äºä¸éœ€è¦ç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œæ‰€ä»¥è¿™ä¸ªé˜¶æ®µä¹Ÿæ˜¯å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å¹¶å‘çš„</li><li>å¹¶å‘é‡ç½®ï¼šé‡ç½®æœ¬æ¬¡GCè¿‡ç¨‹ä¸­çš„æ ‡è®°æ•°æ®</li></ul><p>å°½ç®¡ CMS æ”¶é›†å™¨é‡‡ç”¨çš„æ˜¯å¹¶å‘å›æ”¶ï¼ˆéç‹¬å å¼ï¼‰ï¼Œä½†æ˜¯<mark>åœ¨å…¶åˆå§‹åŒ–æ ‡è®°å’Œå†æ¬¡æ ‡è®°è¿™ä¸¤ä¸ªé˜¶æ®µä¸­ä»ç„¶éœ€è¦æ‰§è¡Œâ€œStop-the-Worldâ€æœºåˆ¶</mark>æš‚åœç¨‹åºä¸­çš„å·¥ä½œçº¿ç¨‹ï¼Œä¸è¿‡æš‚åœæ—¶é—´å¹¶ä¸ä¼šå¤ªé•¿ï¼Œå› æ­¤å¯ä»¥è¯´æ˜ç›®å‰æ‰€æœ‰çš„åƒåœ¾æ”¶é›†å™¨éƒ½åšä¸åˆ°å®Œå…¨ä¸éœ€è¦â€œstop-the-Worldâ€ï¼Œåªæ˜¯å°½å¯èƒ½åœ°ç¼©çŸ­æš‚åœæ—¶é—´ã€‚</p><p><mark>ç”±äºæœ€è€—è´¹æ—¶é—´çš„å¹¶å‘æ ‡è®°ä¸å¹¶å‘æ¸…é™¤é˜¶æ®µéƒ½ä¸éœ€è¦æš‚åœå·¥ä½œï¼Œæ‰€ä»¥æ•´ä½“çš„å›æ”¶æ˜¯ä½åœé¡¿çš„ã€‚</mark></p><p>å¦å¤–ï¼Œç”±äºåœ¨åƒåœ¾æ”¶é›†é˜¶æ®µç”¨æˆ·çº¿ç¨‹æ²¡æœ‰ä¸­æ–­ï¼Œ<mark>æ‰€ä»¥åœ¨ CMS å›æ”¶è¿‡ç¨‹ä¸­ï¼Œè¿˜åº”è¯¥ç¡®ä¿åº”ç”¨ç¨‹åºç”¨æˆ·çº¿ç¨‹æœ‰è¶³å¤Ÿçš„å†…å­˜å¯ç”¨</mark>ã€‚å› æ­¤ï¼ŒCMS æ”¶é›†å™¨ä¸èƒ½åƒå…¶ä»–æ”¶é›†å™¨é‚£æ ·ç­‰åˆ°è€å¹´ä»£å‡ ä¹å®Œå…¨è¢«å¡«æ»¡äº†å†è¿›è¡Œæ”¶é›†ï¼Œè€Œæ˜¯<mark>å½“å †å†…å­˜ä½¿ç”¨ç‡è¾¾åˆ°æŸä¸€é˜ˆå€¼æ—¶ï¼Œä¾¿å¼€å§‹è¿›è¡Œå›æ”¶</mark>ï¼Œä»¥ç¡®ä¿åº”ç”¨ç¨‹åºåœ¨ CMS å·¥ä½œè¿‡ç¨‹ä¸­ä¾ç„¶æœ‰è¶³å¤Ÿçš„ç©ºé—´æ”¯æŒåº”ç”¨ç¨‹åºè¿è¡Œã€‚è¦æ˜¯ CMS è¿è¡ŒæœŸé—´é¢„ç•™çš„å†…å­˜æ— æ³•æ»¡è¶³ç¨‹åºéœ€è¦ï¼Œå°±ä¼šå‡ºç°ä¸€æ¬¡â€œ<code>Concurrent Mode Failure</code>â€ å¤±è´¥ï¼Œè¿™æ—¶è™šæ‹Ÿæœºå°†å¯åŠ¨åå¤‡é¢„æ¡ˆï¼šä¸´æ—¶å¯ç”¨ Serial Old æ”¶é›†å™¨æ¥é‡æ–°è¿›è¡Œè€å¹´ä»£çš„åƒåœ¾æ”¶é›†ï¼Œè¿™æ ·åœé¡¿æ—¶é—´å°±å¾ˆé•¿äº†ã€‚</p><p>CMS æ”¶é›†å™¨çš„åƒåœ¾æ”¶é›†ç®—æ³•é‡‡ç”¨çš„æ˜¯æ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œè¿™æ„å‘³ç€æ¯æ¬¡æ‰§è¡Œå®Œå†…å­˜å›æ”¶åï¼Œç”±äºè¢«æ‰§è¡Œå†…å­˜å›æ”¶çš„æ— ç”¨å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ææœ‰å¯èƒ½æ˜¯ä¸è¿ç»­çš„ä¸€äº›å†…å­˜å—ï¼Œä¸å¯é¿å…åœ°å°†ä¼š<mark>äº§ç”Ÿä¸€äº›å†…å­˜ç¢ç‰‡</mark>ã€‚é‚£ä¹ˆ CMS åœ¨ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜ç©ºé—´æ—¶ï¼Œå°†æ— æ³•ä½¿ç”¨æŒ‡é’ˆç¢°æ’ï¼ˆBump the Pointerï¼‰æŠ€æœ¯ï¼Œè€Œåªèƒ½å¤Ÿé€‰æ‹©ç©ºé—²åˆ—è¡¨ï¼ˆFree Listï¼‰æ‰§è¡Œå†…å­˜åˆ†é…ã€‚</p><p><img src=https://logan.1357810.xyz/img/20220422/153020741-aaa8760dfc.png width=900 height=600 loading=lazy decoding=async alt=image-20200713212230352 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p><strong>æœ‰äººä¼šè§‰å¾—æ—¢ç„¶ Mark Sweep ä¼šé€ æˆå†…å­˜ç¢ç‰‡ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸æŠŠç®—æ³•æ¢æˆ Mark Compactï¼Ÿ</strong></p><p>ç­”æ¡ˆå…¶å®å¾ˆç®€å•ï¼Œå› ä¸ºå½“å¹¶å‘æ¸…é™¤çš„æ—¶å€™ï¼Œç”¨ Compact æ•´ç†å†…å­˜çš„è¯ï¼ŒåŸæ¥çš„ç”¨æˆ·çº¿ç¨‹ä½¿ç”¨çš„å†…å­˜è¿˜æ€ä¹ˆç”¨å‘¢ï¼Ÿè¦ä¿è¯ç”¨æˆ·çº¿ç¨‹èƒ½ç»§ç»­æ‰§è¡Œï¼Œå‰æçš„å®ƒè¿è¡Œçš„èµ„æºä¸å—å½±å“å˜›ã€‚Mark Compact æ›´é€‚åˆâ€œStop the Worldâ€ è¿™ç§åœºæ™¯ä¸‹ä½¿ç”¨</p><ul><li>é€šè¿‡å‚æ•° -XX:+UseCMSCompactAtFullCollection ï¼Œå¯ä»¥è®©jvmåœ¨æ‰§è¡Œæ ‡è®°æ¸…é™¤åå†åšå†…å­˜æ•´ç†</li></ul><h3 id=1361-cms-çš„ä¼˜ç‚¹><a href=#1361-cms-%e7%9a%84%e4%bc%98%e7%82%b9 class=header-anchor></a>13.6.1. CMS çš„ä¼˜ç‚¹</h3><ul><li>å¹¶å‘æ”¶é›†</li><li>ä½å»¶è¿Ÿ</li></ul><h3 id=1362-cms-çš„å¼Šç«¯><a href=#1362-cms-%e7%9a%84%e5%bc%8a%e7%ab%af class=header-anchor></a>13.6.2. CMS çš„å¼Šç«¯</h3><ul><li><mark>ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡</mark>ï¼Œå¯¼è‡´å¹¶å‘æ¸…é™¤åï¼Œç”¨æˆ·çº¿ç¨‹å¯ç”¨çš„ç©ºé—´ä¸è¶³ã€‚åœ¨æ— æ³•åˆ†é…å¤§å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œä¸å¾—ä¸æå‰è§¦å‘ FullGCã€‚</li><li><mark>CMS æ”¶é›†å™¨å¯¹ CPU èµ„æºéå¸¸æ•æ„Ÿ</mark>ã€‚åœ¨å¹¶å‘é˜¶æ®µï¼Œå®ƒè™½ç„¶ä¸ä¼šå¯¼è‡´ç”¨æˆ·åœé¡¿ï¼Œä½†æ˜¯ä¼šå› ä¸ºå ç”¨äº†ä¸€éƒ¨åˆ†çº¿ç¨‹è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå˜æ…¢ï¼Œæ€»ååé‡ä¼šé™ä½ã€‚</li><li><mark>CMS æ”¶é›†å™¨æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾</mark>ã€‚å¯èƒ½å‡ºç°â€œ<code>Concurrent Mode Failure</code>&ldquo;å¤±è´¥è€Œå¯¼è‡´å¦ä¸€æ¬¡ Full GC çš„äº§ç”Ÿã€‚åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µç”±äºç¨‹åºçš„å·¥ä½œçº¿ç¨‹å’Œåƒåœ¾æ”¶é›†çº¿ç¨‹æ˜¯åŒæ—¶è¿è¡Œæˆ–è€…äº¤å‰è¿è¡Œçš„ï¼Œé‚£ä¹ˆ<mark>åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µå¦‚æœäº§ç”Ÿæ–°çš„åƒåœ¾å¯¹è±¡ï¼ŒCMS å°†æ— æ³•å¯¹è¿™äº›åƒåœ¾å¯¹è±¡è¿›è¡Œæ ‡è®°ï¼Œæœ€ç»ˆä¼šå¯¼è‡´è¿™äº›æ–°äº§ç”Ÿçš„åƒåœ¾å¯¹è±¡æ²¡æœ‰è¢«åŠæ—¶å›æ”¶</mark>ï¼Œä»è€Œåªèƒ½åœ¨ä¸‹ä¸€æ¬¡æ‰§è¡Œ GC æ—¶é‡Šæ”¾è¿™äº›ä¹‹å‰æœªè¢«å›æ”¶çš„å†…å­˜ç©ºé—´ã€‚</li><li>CMSé‡æ–°æ ‡è®°é˜¶æ®µåªèƒ½å¤„ç†æ¼æ ‡é—®é¢˜ï¼Œä¸èƒ½å¤„ç†æµ®åŠ¨åƒåœ¾</li></ul><h3 id=136--ä¸‰è‰²æ ‡è®°><a href=#136--%e4%b8%89%e8%89%b2%e6%a0%87%e8%ae%b0 class=header-anchor></a>13.6 ä¸‰è‰²æ ‡è®°</h3><p>ä¸‰è‰²æ ‡è®°æ³•å°†å¯¹è±¡çš„é¢œè‰²åˆ†ä¸ºäº†é»‘ã€ç°ã€ç™½ï¼Œä¸‰ç§é¢œè‰²ã€‚</p><ul><li><p><strong>ç™½è‰²</strong>ï¼šè¯¥å¯¹è±¡æ²¡æœ‰è¢«æ ‡è®°è¿‡ï¼ˆå¯¹è±¡åƒåœ¾ï¼‰ã€‚å¯è¾¾æ€§åˆ†æç®—æ³•åˆšå¼€å§‹é˜¶æ®µï¼Œæ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ç™½è‰²çš„</p></li><li><p><strong>ç°è‰²</strong>ï¼šè¯¥å¯¹è±¡å·²ç»è¢«æ ‡è®°è¿‡äº†ï¼Œä½†è¯¥å¯¹è±¡ä¸‹çš„ç›´æ¥å±æ€§æ²¡æœ‰å…¨è¢«æ ‡è®°å®Œã€‚ï¼ˆGCéœ€è¦ä»æ­¤å¯¹è±¡ä¸­å»å¯»æ‰¾åƒåœ¾ï¼‰</p></li><li><p><strong>é»‘è‰²</strong>ï¼šè¯¥å¯¹è±¡å·²ç»è¢«æ ‡è®°è¿‡äº†ï¼Œä¸”è¯¥å¯¹è±¡ä¸‹çš„ç›´æ¥å±æ€§ä¹Ÿå…¨éƒ¨éƒ½è¢«æ ‡è®°è¿‡äº†ã€‚ï¼ˆç¨‹åºæ‰€éœ€è¦çš„å¯¹è±¡ï¼‰</p></li></ul><ol><li>é¦–å…ˆåˆ›å»ºä¸‰ä¸ªé›†åˆï¼šç™½ã€ç°ã€é»‘ã€‚</li><li>å°†æ‰€æœ‰å¯¹è±¡æ”¾å…¥ç™½è‰²é›†åˆä¸­ã€‚</li><li>ç„¶åä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†æ‰€æœ‰ç›´æ¥å¯¹è±¡ï¼ˆæ³¨æ„è¿™é‡Œå¹¶ä¸<strong>é€’å½’éå†</strong>ï¼‰ï¼ŒæŠŠéå†åˆ°çš„å¯¹è±¡ä»ç™½è‰²é›†åˆæ”¾å…¥ç°è‰²é›†åˆã€‚CMSçš„åˆå§‹æ ‡è®°</li><li>ä¹‹åéå†ç°è‰²é›†åˆï¼Œå°†ç°è‰²å¯¹è±¡å¼•ç”¨çš„ç›´æ¥å¯¹è±¡ä»ç™½è‰²é›†åˆæ”¾å…¥ç°è‰²é›†åˆï¼Œä¹‹åå°†æ­¤ç°è‰²å¯¹è±¡æ”¾å…¥é»‘è‰²é›†åˆã€‚CMSçš„å¹¶å‘æ ‡è®°</li><li>é‡å¤ 4 ç›´åˆ°ç°è‰²ä¸­æ— ä»»ä½•å¯¹è±¡</li><li>é€šè¿‡write-barrieræ£€æµ‹å¯¹è±¡æœ‰å˜åŒ–ï¼Œé‡å¤ä»¥ä¸Šæ“ä½œ</li><li>æ”¶é›†æ‰€æœ‰ç™½è‰²å¯¹è±¡ï¼ˆåƒåœ¾ï¼‰</li></ol><p><img src=https://logan.1357810.xyz/img/20220426/1650906474-962103593bc73f.image width=900 height=600 loading=lazy decoding=async alt=img class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><ul><li><p>CMSä¸­ä¼šäº§ç”Ÿæµ®åŠ¨åƒåœ¾ï¼Œåœ¨å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œå¦‚æœç”±äºæ–¹æ³•ç»“æŸå¯¼è‡´éƒ¨åˆ†å±€éƒ¨å˜é‡(GC Roots)è¢«é”€æ¯ï¼Œè¿™ä¸ªgcrootå¼•ç”¨çš„å¯¹è±¡ä¹‹å‰åˆè¢«æ‰«æè¿‡(è¢«æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡)ï¼Œé‚£ä¹ˆæœ¬è½®GCä¸ä¼šå›æ”¶è¿™éƒ¨åˆ†å†…å­˜ï¼Œè¿™éƒ¨åˆ†æœ¬åº”è¯¥å›æ”¶ä½†æ˜¯æ²¡æœ‰å›æ”¶åˆ°çš„å†…å­˜ï¼Œè¢«ç§°ä¸ºæµ®åŠ¨åƒåœ¾ã€‚æµ®åŠ¨åƒåœ¾å¹¶ä¸ä¼šå½±å“åƒåœ¾å›æ”¶çš„æ­£ç¡®æ€§ï¼Œåªæ˜¯ç­‰åˆ°ä¸‹ä¸€è½®åƒåœ¾å›æ”¶ä¸­æ‰ä¼šè¢«æ¸…é™¤ï¼›</p><ul><li><mark>å¦å¤–ï¼Œé’ˆå¯¹å¹¶å‘æ ‡è®°(å¹¶å‘æ¸…ç†)å¼€å§‹åäº§ç”Ÿçš„æ–°å¯¹è±¡ï¼Œé€šå¸¸çš„åšæ³•æ˜¯ç›´æ¥å…¨éƒ¨å½“æˆé»‘è‰²ï¼Œæœ¬è½®ä¸ä¼šè¿›è¡Œæ¸…é™¤ã€‚è¿™éƒ¨åˆ†å¯¹è±¡æœŸé—´å¯èƒ½ä¹Ÿä¼šå˜æˆåƒåœ¾ï¼Œè¿™ä¹Ÿç®—æ˜¯æµ®åŠ¨åƒåœ¾çš„ä¸€éƒ¨åˆ†ã€‚</mark></li></ul></li><li><p>CMSä¸­å¹¶å‘æ ‡è®°ä¼šäº§ç”Ÿæ¼æ ‡é—®é¢˜ï¼Œä¼šå¯¼è‡´å¼•ç”¨çš„å¯¹è±¡è¢«å½“æˆåƒåœ¾è¯¯åˆ é™¤ï¼Œè¿™æ˜¯ä¸¥é‡bugï¼Œå¿…é¡»è§£å†³ï¼›æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p><p>1ã€<mark>å¢é‡æ›´æ–°(incremental update)</mark>ï¼šå½“é»‘è‰²å¯¹è±¡æ’å…¥æ–°çš„æŒ‡å‘ç™½è‰²å¯¹è±¡çš„å¼•ç”¨å…³ç³»æ—¶ï¼Œå°±å°†è¿™ä¸ªæ–°æ’å…¥çš„å¼•ç”¨è®°å½•ä¸‹æ¥ï¼Œç­‰åˆ°å¹¶å‘æ‰«æç»“æŸä¹‹åï¼Œå†å°†è¿™äº›è®°å½•è¿‡çš„å¼•ç”¨å…³ç³»ä¸­çš„é»‘è‰²å¯¹è±¡ä¸ºæ ¹ï¼Œé‡æ–°æ‰«æä¸€æ¬¡ï¼Œå¯ä»¥ç®€åŒ–ç†è§£ä¸ºï¼Œé»‘è‰²å¯¹è±¡ä¸€æ—¦æ–°æ’å…¥äº†æŒ‡å‘ç™½è‰²å¯¹è±¡çš„å¼•ç”¨ä¹‹åï¼Œå®ƒå°±å˜å›ç°è‰²å¯¹è±¡äº†ã€‚</p><p>â€‹ å› ä¸ºå¢é‡æ›´æ–°ä¸è®°å½•åˆ é™¤çš„å¼•ç”¨å…³ç³»ï¼Œå½“æŸä¸ªå¼•ç”¨å…³ç³»è¢«æ ‡è®°åï¼Œç”¨æˆ·çº¿ç¨‹å°†è¯¥å¼•ç”¨å…³ç³»æ–­å¼€ï¼Œè¿™ä¸ªæ–­å¼€æ“ä½œä¸ä¼šè¢«è®°å½•ï¼Œæ‰€ä»¥æ–­å¼€çš„å¯¹è±¡å°±ä¸ä¼šè¢«æ¸…é™¤ï¼Œäº§ç”Ÿäº†æµ®åŠ¨åƒåœ¾ã€‚</p><p>2ã€<mark>åŸå§‹å¿«ç…§(Snapshot At The Beginning,STAB)</mark>ï¼šå½“ç°è‰²å¯¹è±¡è¦åˆ é™¤æŒ‡å‘ç™½è‰²å¯¹è±¡çš„å¼•ç”¨å…³ç³»æ—¶ï¼Œå°±å°†è¿™ä¸ªè¦åˆ é™¤çš„å¼•ç”¨è®°å½•ä¸‹æ¥ï¼Œç›¸å½“äºä¿å­˜å½“æ—¶å¼•ç”¨é“¾çš„å¿«ç…§ã€‚åœ¨å¹¶å‘æ‰«æç»“æŸä¹‹åï¼Œå†ä»è¿™äº›è®°å½•è¿‡çš„å¼•ç”¨å…³ç³»ä¸­çš„å¯¹è±¡å½“æ ¹ç»“ç‚¹æ‰«æï¼Œè¿™æ ·å°±èƒ½æŠŠæ‰«æåˆ°çš„å¯¹è±¡æ ‡è®°ä¸ºé»‘è‰²ï¼Œç›®çš„å°±æ˜¯è®©è¿™ç§å¯¹è±¡åœ¨æœ¬è½®gcæ¸…ç†ä¸­èƒ½å­˜æ´»ä¸‹æ¥ï¼Œå¾…ä¸‹ä¸€æ¬¡gcçš„æ—¶å€™é‡æ–°æ‰«æï¼Œè¿™ä¸ªå¯¹è±¡ä¹Ÿæœ‰å¯èƒ½æ˜¯æµ®åŠ¨åƒåœ¾ã€‚è¿™ä¹Ÿå¯ä»¥ç®€åŒ–ç†è§£ä¸ºï¼Œæ— è®ºå¼•ç”¨å…³ç³»åˆ é™¤ä¸å¦ï¼Œéƒ½ä¼šæŒ‰ç…§åˆšåˆšå¼€å§‹æ‰«æé‚£ä¸€åˆ»çš„å¯¹è±¡å›¾å¿«ç…§æ¥è¿›è¡Œæœç´¢ã€‚</p><p>â€‹ å¯¹è±¡å¯èƒ½ä¼šåœ¨ G1 æ”¶é›†æœŸé—´æ­»äº¡å¹¶ä¸”ä¸ä¼šè¢«æ”¶é›†ã€‚G1 ä½¿ç”¨ä¸€ç§ç§°ä¸ºå¼€å§‹å¿«ç…§ (SATB) çš„æŠ€æœ¯æ¥ä¿è¯åƒåœ¾æ”¶é›†å™¨æ‰¾åˆ°æ‰€æœ‰æ´»åŠ¨å¯¹è±¡ã€‚SATB æŒ‡å‡ºï¼Œå‡ºäºæ”¶é›†çš„ç›®çš„ï¼Œåœ¨å¹¶å‘æ ‡è®°ï¼ˆæ•´ä¸ªå †ä¸Šçš„æ ‡è®°ï¼‰å¼€å§‹æ—¶å¤„äºæ´»åŠ¨çŠ¶æ€çš„ä»»ä½•å¯¹è±¡éƒ½è¢«è®¤ä¸ºæ˜¯æ´»åŠ¨çš„ã€‚SATB å…è®¸ä»¥ç±»ä¼¼äº CMS å¢é‡æ›´æ–°çš„æ–¹å¼æµ®åŠ¨åƒåœ¾ã€‚</p><blockquote><p>Floating Garbage
Objects can die during a G1 collection and not be collected. G1 uses a technique called snapshot-at-the-beginning (SATB) to guarantee that all live objects are found by the garbage collector. SATB states that any object that is live at the start of the concurrent marking (a marking over the entire heap) is considered live for the purpose of the collection. SATB allows floating garbage in a way analogous to that of a CMS incremental update.</p></blockquote></li></ul><ul><li>ä»¥ä¸Šæ— è®ºæ˜¯å¯¹å¯¹è±¡å¼•ç”¨å…³ç³»è®°å½•çš„æ’å…¥è¿˜æ˜¯åˆ é™¤ï¼Œè™šæ‹Ÿæœºçš„è®°å½•æ“ä½œéƒ½æ˜¯é€šè¿‡å†™å±éšœå®ç°çš„</li></ul><ul><li><mark>CMSé‡æ–°æ ‡è®°é˜¶æ®µä½¿ç”¨å†™å±éšœ + å¢é‡æ›´æ–°çš„æªæ–½ï¼Œä¸èƒ½å¤„ç†æµ®åŠ¨åƒåœ¾</mark></li><li><mark>G1æœ€ç»ˆæ ‡è®°é˜¶æ®µä½¿ç”¨å†™å±éšœ +åŸå§‹å¿«ç…§+RememberedSetçš„æªæ–½ï¼Œèƒ½å¤„ç†æµ®åŠ¨åƒåœ¾ï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½ä¼šå­˜åœ¨</mark>ï¼›å¤„ç†æµ®åŠ¨åƒåœ¾ï¼Œé…åˆ<code>Rset</code>ï¼Œå»æ‰«æå“ªäº›Regionå¼•ç”¨åˆ°å½“å‰çš„ç™½è‰²å¯¹è±¡ï¼Œè‹¥æ²¡æœ‰å¼•ç”¨åˆ°å½“å‰å¯¹è±¡ï¼Œåˆ™å›æ”¶</li></ul><p>å¸¸è§çš„æ¼æ ‡ï¼š</p><p><img src=https://logan.1357810.xyz/img/20220426/1650905547-3bb5ecaa9bf201.png width=900 height=600 loading=lazy decoding=async alt=image-20220426005227093 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><ul><li>SATBæ•ˆç‡é«˜äºå¢é‡æ›´æ–°çš„åŸå› ï¼Ÿ</li></ul><p>å› ä¸ºSATBåœ¨é‡æ–°æ ‡è®°ç¯èŠ‚åªéœ€è¦å»é‡æ–°æ‰«æé‚£äº›è¢«æ¨åˆ°å †æ ˆä¸­çš„å¼•ç”¨ï¼Œå¹¶é…åˆ<code>Rset</code>
æ¥åˆ¤æ–­å½“å‰å¯¹è±¡æ˜¯å¦è¢«å¼•ç”¨æ¥è¿›è¡Œå›æ”¶ï¼›</p><p>å¹¶ä¸”åœ¨æœ€å<code>G1</code>
å¹¶ä¸ä¼šé€‰æ‹©å›æ”¶æ‰€æœ‰åƒåœ¾å¯¹è±¡ï¼Œè€Œæ˜¯æ ¹æ®<code>Region</code>
çš„åƒåœ¾å¤šå°‘æ¥åˆ¤æ–­ä¸é¢„ä¼°å›æ”¶ä»·å€¼ï¼ˆæŒ‡å›æ”¶çš„åƒåœ¾ä¸å›æ”¶çš„<code>STW</code>
æ—¶é—´çš„ä¸€ä¸ªé¢„ä¼°å€¼ï¼‰ï¼Œå°†ä¸€ä¸ªæˆ–è€…å¤šä¸ª<code>Region</code>
æ”¾åˆ°<code>CSet</code>
ä¸­ï¼Œæœ€åå°†è¿™äº›<code>Region</code>
ä¸­çš„å­˜æ´»å¯¹è±¡å‹ç¼©å¹¶å¤åˆ¶åˆ°æ–°çš„<code>Region</code>
ä¸­ï¼Œæ¸…ç©ºåŸæ¥çš„<code>Region</code></p><h2 id=61-å†™å±éšœ><a href=#61-%e5%86%99%e5%b1%8f%e9%9a%9c class=header-anchor></a>6.1 å†™å±éšœ</h2><blockquote><p>è¿™æ˜¯JVMä»£ç çº§åˆ«çš„å±éšœï¼Œç›¸å½“äºaopï¼Œå’Œç¦æ­¢æŒ‡ä»¤é‡æ’çš„å†…å­˜å±éšœæ²¡å…³ç³»</p></blockquote><p>æ— è®ºæ˜¯å¢é‡æ›´æ–°è¿˜æ˜¯åŸå§‹å¿«ç…§ï¼Œéƒ½æ˜¯é€šè¿‡å†™å±éšœæ¥å®ç°çš„ã€‚</p><p>å¢é‡æ›´æ–°å’ŒåŸå§‹å¿«ç…§éƒ½æ˜¯å¯¹å¼•ç”¨çš„æ“ä½œï¼Œä¸€ä¸ªæ˜¯æ–°å¢å¼•ç”¨ï¼Œä¸€ä¸ªæ˜¯åˆ é™¤å¼•ç”¨ï¼Œä¸ç®¡æ˜¯æ–°å¢è¿˜æ˜¯åˆ é™¤ï¼Œæœ€ç»ˆéƒ½è¦æŠŠä»–ä»¬æ”¶é›†åˆ°é›†åˆé‡Œå»ã€‚é‚£ä¹ˆå¦‚ä½•æ”¶é›†å‘¢ï¼Ÿå…¶å®å°±æ˜¯åœ¨èµ‹å€¼æ“ä½œä¹‹å‰æˆ–è€…èµ‹å€¼æ“ä½œä¹‹åï¼ŒæŠŠå¼•ç”¨ä¸¢åˆ°é›†åˆä¸­å»ã€‚ åœ¨èµ‹å€¼æ“ä½œçš„å‰é¢æˆ–è€…åé¢åšä¸€äº›äº‹æƒ…ï¼Œè¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬æŠŠå®ƒå«åšä»£ç çš„æ“ä½œå±éšœã€‚</p><p>ä¸‹é¢æ¥çœ‹çœ‹èµ‹å€¼å±éšœçš„ä¼ªä»£ç ï¼Œä»¥ç»™æŸä¸ªå¯¹è±¡çš„æˆå‘˜å˜é‡èµ‹å€¼ä¸ºä¾‹ï¼Œåº•å±‚ä»£ç å¤§æ¦‚æ˜¯è¿™æ ·çš„:ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4>4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5>5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6>6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @param field æŸå¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œå¦‚ a.b.d
</span></span></span><span class=line><span class=cl><span class=cm> * @param new_value æ–°å€¼ï¼Œå¦‚ null
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl> <span class=nx>voidoop_field_store</span><span class=p>(</span><span class=nx>oop</span><span class=o>*</span><span class=nx>field</span><span class=p>,</span><span class=nx>oopnew_value</span><span class=p>){</span>
</span></span><span class=line><span class=cl> 	 <span class=o>*</span><span class=nx>field</span> <span class=o>=</span> <span class=nx>new_value</span><span class=p>;</span> <span class=c1>// èµ‹å€¼æ“ä½œ
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>æ‰€è°“çš„å†™å±éšœï¼Œå…¶å®å°±æ˜¯æŒ‡åœ¨èµ‹å€¼æ“ä½œå‰åï¼ŒåŠ å…¥ä¸€äº›å¤„ç†(å¯ä»¥å‚è€ƒAOPçš„æ¦‚å¿µ):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>voidoop_field_store</span><span class=p>(</span><span class=nx>oop</span><span class=o>*</span><span class=nx>field</span><span class=p>,</span><span class=nx>oopnew_value</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nx>pre_write_barrier</span><span class=p>(</span><span class=nx>field</span><span class=p>);</span> <span class=c1>// å†™å±éšœâ€å†™å‰æ“ä½œ
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>*</span><span class=nx>field</span> <span class=o>=</span> <span class=nx>new_value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>post_write_barrier</span><span class=p>(</span><span class=nx>field</span><span class=p>,</span> <span class=nx>value</span><span class=p>);</span> <span class=c1>// å†™å±éšœâ€å†™åæ“ä½œ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>å†™å±éšœå®ç°åŸå§‹å¿«ç…§</strong></li></ul><p>åŸå§‹å¿«ç…§æ˜¯è®°å½•å¯¹å¼•ç”¨çš„åˆ é™¤ã€‚æ¯”å¦‚åœ¨æ‰§è¡Œa.b.d=nullçš„æ—¶å€™ï¼Œåˆ©ç”¨å†™å±éšœï¼Œå°†åŸæ¥Bæˆå‘˜å˜é‡çš„å¼•ç”¨ å¯¹è±¡Dè®°å½•ä¸‹æ¥:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1>1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2>2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3>3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4>4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// å†™å±éšœä»£ç 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>void</span> <span class=nx>pre_write_barrier</span><span class=p>(</span><span class=nx>oop</span><span class=o>*</span><span class=nx>field</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nx>oop</span> <span class=nx>old_value</span> <span class=o>=</span> <span class=o>*</span><span class=nx>field</span><span class=p>;</span> <span class=c1>// è·å–æ—§å€¼
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>remark_set</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>old_value</span><span class=p>);</span> <span class=c1>// è®°å½•åŸæ¥çš„å¼•ç”¨å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>å†™å±éšœå®ç°å¢é‡æ›´æ–°</strong></li></ul><p>å½“å¯¹è±¡Açš„æˆå‘˜å˜é‡çš„å¼•ç”¨å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ¯”å¦‚æ–°å¢å¼•ç”¨(a.d = d)ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å†™å±éšœï¼Œå°†Aæ–°çš„æˆå‘˜å˜é‡å¼•ç”¨å¯¹è±¡D è®°å½•ä¸‹æ¥:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1>1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2>2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=k>void</span> <span class=nx>post_write_barrier</span><span class=p>(</span><span class=nx>oop</span><span class=o>*</span><span class=nx>field</span><span class=p>,</span><span class=nx>oopnew_value</span><span class=p>){</span> 
</span></span><span class=line><span class=cl>  <span class=nx>remark_set</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>new_value</span><span class=p>);</span> <span class=c1>// è®°å½•æ–°å¼•ç”¨çš„å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™ä¸¤å—éƒ½æ˜¯å±éšœä»£ç ï¼Œä¸€ä¸ªæ˜¯åœ¨å†™å‰æ‰§è¡Œï¼Œä¸€ä¸ªæ˜¯åœ¨å†™åæ‰§è¡Œã€‚ åˆ é™¤æ“ä½œè¦åœ¨å†™å‰æ‰§è¡Œï¼Œ èµ‹å€¼æ“ä½œè¦åœ¨å†™åæ‰§è¡Œã€‚</p><p>ä¸‹é¢æ¥çœ‹çœ‹hotspotæºç æ˜¯å¦‚ä½•å®ç°å†™å±éšœçš„ï¼Œæ‰¾åˆ°oop.inline.hppæ–‡ä»¶</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1>1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2>2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3>3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4>4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5>5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6>6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7>7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8>8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * c++åº•å±‚è°ƒç”¨çš„èµ‹å€¼æ–¹æ³• 
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nx>template</span> <span class=o>&lt;</span><span class=kr>class</span> <span class=nx>T</span><span class=o>&gt;</span> <span class=nx>inline</span> <span class=k>void</span> <span class=nx>oop_store</span><span class=p>(</span><span class=kr>volatile</span> <span class=nx>T</span><span class=o>*</span> <span class=nx>p</span><span class=p>,</span> <span class=nx>oop</span> <span class=nx>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>update_barrier_set_pre</span><span class=p>((</span><span class=nx>T</span><span class=o>*</span><span class=p>)</span><span class=nx>p</span><span class=p>,</span> <span class=nx>v</span><span class=p>);</span>   <span class=c1>// cast away volatile
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Used by release_obj_field_put, so use release_store_ptr.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>oopDesc</span><span class=o>::</span><span class=nx>release_encode_store_heap_oop</span><span class=p>(</span><span class=nx>p</span><span class=p>,</span> <span class=nx>v</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>update_barrier_set</span><span class=p>((</span><span class=k>void</span><span class=o>*</span><span class=p>)</span><span class=nx>p</span><span class=p>,</span> <span class=nx>v</span><span class=p>);</span>    <span class=c1>// cast away type
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™å°±æ˜¯ä¸€ä¸ªèµ‹å€¼æ“ä½œã€‚update_barrier_set_pre((T*)p, v);æ˜¯ä¸€ä¸ªå†™å‰å±éšœï¼Œupdate_barrier_set((void*)p, v);æ˜¯ä¸€ä¸ªå†™åå±éšœã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨èµ‹å€¼ä¹‹å‰å’Œä¹‹åå¢åŠ äº†ä¸€æ®µæ“ä½œä»£ç ã€‚å…¶å®å¯ä»¥çœ‹å‡ºæ¥è¿™æ®µä»£ç å’Œæˆ‘ä»¬çš„ä¼ªä»£ç å·®ä¸å¤šã€‚åå­—è™½ä¸åŒï¼Œä½†æ˜¯å«ä¹‰æ˜¯ä¸€æ ·çš„ã€‚</p><p>å†çœ‹çœ‹SATBåœ¨hotspotæºç ä¸­æ˜¯å¦‚ä½•å®ç°å†™å±éšœçš„ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=k>void</span> <span class=nx>G1SATBCardTableModRefBS</span><span class=o>::</span><span class=nx>enqueue</span><span class=p>(</span><span class=nx>oop</span> <span class=nx>pre_val</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Nulls should have been already filtered.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>assert</span><span class=p>(</span><span class=nx>pre_val</span><span class=o>-&gt;</span><span class=nx>is_oop</span><span class=p>(</span><span class=kc>true</span><span class=p>),</span> <span class=s2>&#34;Error&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>JavaThread</span><span class=o>::</span><span class=nx>satb_mark_queue_set</span><span class=p>().</span><span class=nx>is_active</span><span class=p>())</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>Thread</span><span class=o>*</span> <span class=nx>thr</span> <span class=o>=</span> <span class=nx>Thread</span><span class=o>::</span><span class=nx>current</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>thr</span><span class=o>-&gt;</span><span class=nx>is_Java_thread</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>JavaThread</span><span class=o>*</span> <span class=nx>jt</span> <span class=o>=</span> <span class=p>(</span><span class=nx>JavaThread</span><span class=o>*</span><span class=p>)</span><span class=nx>thr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>jt</span><span class=o>-&gt;</span><span class=nx>satb_mark_queue</span><span class=p>().</span><span class=nx>enqueue</span><span class=p>(</span><span class=nx>pre_val</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>MutexLockerEx</span> <span class=nx>x</span><span class=p>(</span><span class=nx>Shared_SATB_Q_lock</span><span class=p>,</span> <span class=nx>Mutex</span><span class=o>::</span><span class=nx>_no_safepoint_check_flag</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>JavaThread</span><span class=o>::</span><span class=nx>satb_mark_queue_set</span><span class=p>().</span><span class=nx>shared_satb_queue</span><span class=p>()</span><span class=o>-&gt;</span><span class=nx>enqueue</span><span class=p>(</span><span class=nx>pre_val</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>æˆ‘ä»¬çœ‹åˆ°è¿™å¥è¯satb_mark_queue_set().shared_satb_queue()->enqueue(pre_val); å°†æ—§å€¼æ”¾åˆ°é˜Ÿåˆ—é‡Œã€‚è¿™æ—¶ä¸ºä»€ä¹ˆä¼šæ”¾åˆ°é˜Ÿåˆ—é‡Œé¢å‘¢ï¼Ÿä¸ºäº†æé«˜æ•ˆç‡ã€‚å› ä¸ºæ˜¯å†™æ“ä½œï¼Œåœ¨å†™æ“ä½œä¹‹å‰å’Œä¹‹åå¢åŠ é€»è¾‘ï¼Œæ˜¯ä¼šå½±å“åŸæ¥ä»£ç çš„æ•ˆç‡çš„ï¼Œä¸ºäº†é¿å…å¯¹æºä»£ç çš„å½±å“ï¼Œæ”¾å…¥åˆ°é˜Ÿåˆ—ä¸­è¿›è¡Œå¤„ç†ã€‚</p><h2 id=62-è¯»å±éšœ><a href=#62-%e8%af%bb%e5%b1%8f%e9%9a%9c class=header-anchor></a>6.2 è¯»å±éšœ</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2>2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3>3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>oopoop_field_load</span><span class=p>(</span><span class=nx>oop</span><span class=o>*</span><span class=nx>field</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	 <span class=nx>pre_load_barrier</span><span class=p>(</span><span class=nx>field</span><span class=p>);</span> <span class=c1>// è¯»å±éšœâ€è¯»å–å‰æ“ä½œ
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=k>return</span> <span class=o>*</span><span class=nx>field</span><span class=p>;</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>è¯»å±éšœæ˜¯ç›´æ¥é’ˆå¯¹ç¬¬ä¸€æ­¥:D d = a.b.dï¼Œå½“è¯»å–æˆå‘˜å˜é‡æ—¶ï¼Œä¸€å¾‹è®°å½•ä¸‹æ¥:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1>1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2>2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3>3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>voidpre_load_barrier</span><span class=p>(</span><span class=nx>oop</span><span class=o>*</span><span class=nx>field</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	 <span class=nx>oop</span> <span class=nx>old_value</span> <span class=o>=</span> <span class=o>*</span><span class=nx>field</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	 <span class=nx>remark_set</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>old_value</span><span class=p>);</span> <span class=c1>// è®°å½•è¯»å–åˆ°çš„å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ç°ä»£è¿½è¸ªå¼(å¯è¾¾æ€§åˆ†æ)çš„åƒåœ¾å›æ”¶å™¨å‡ ä¹éƒ½å€Ÿé‰´äº†ä¸‰è‰²æ ‡è®°çš„ç®—æ³•æ€æƒ³ï¼Œå°½ç®¡å®ç°çš„æ–¹å¼ä¸å°½ç›¸åŒ:æ¯”å¦‚ç™½è‰²/é»‘è‰² é›†åˆä¸€èˆ¬éƒ½ä¸ä¼šå‡ºç°(ä½†æ˜¯æœ‰å…¶ä»–ä½“ç°é¢œè‰²çš„åœ°æ–¹)ã€ç°è‰²é›†åˆå¯ä»¥é€šè¿‡æ ˆ/é˜Ÿåˆ—/ç¼“å­˜æ—¥å¿—ç­‰æ–¹å¼è¿›è¡Œå®ç°ã€éå†æ–¹å¼å¯ ä»¥æ˜¯å¹¿åº¦/æ·±åº¦éå†ç­‰ç­‰ã€‚</p><h2 id=63-å„ç§åƒåœ¾æ”¶é›†å™¨å¯¹æ¼æ ‡çš„å¤„ç†æ–¹æ¡ˆ><a href=#63-%e5%90%84%e7%a7%8d%e5%9e%83%e5%9c%be%e6%94%b6%e9%9b%86%e5%99%a8%e5%af%b9%e6%bc%8f%e6%a0%87%e7%9a%84%e5%a4%84%e7%90%86%e6%96%b9%e6%a1%88 class=header-anchor></a>6.3 å„ç§åƒåœ¾æ”¶é›†å™¨å¯¹æ¼æ ‡çš„å¤„ç†æ–¹æ¡ˆ</h2><p>å¯¹äºè¯»å†™å±éšœï¼Œä»¥Java HotSpot VMä¸ºä¾‹ï¼Œå…¶å¹¶å‘æ ‡è®°æ—¶å¯¹æ¼æ ‡çš„å¤„ç†æ–¹æ¡ˆå¦‚ä¸‹:</p><ul><li>CMSï¼šé‡‡ç”¨çš„æ˜¯å†™å±éšœ + å¢é‡æ›´æ–°</li><li>G1ï¼š é‡‡ç”¨çš„æ˜¯å†™å±éšœ + åŸæ±å¿«ç…§ï¼ˆSATBï¼‰</li><li>ZGCï¼šé‡‡ç”¨çš„æ˜¯è¯»å±éšœ</li></ul><p>å·¥ç¨‹å®ç°ä¸­ï¼Œè¯»å†™å±éšœè¿˜æœ‰å…¶ä»–åŠŸèƒ½ï¼Œæ¯”å¦‚å†™å±éšœå¯ä»¥ç”¨äºè®°å½•è·¨ä»£/åŒºå¼•ç”¨çš„å˜åŒ–ï¼Œè¯»å±éšœå¯ä»¥ç”¨äºæ”¯æŒç§»åŠ¨å¯¹è±¡çš„å¹¶ å‘æ‰§è¡Œç­‰ã€‚åŠŸèƒ½ä¹‹å¤–ï¼Œè¿˜æœ‰æ€§èƒ½çš„è€ƒè™‘ï¼Œæ‰€ä»¥å¯¹äºé€‰æ‹©å“ªç§ï¼Œæ¯æ¬¾åƒåœ¾å›æ”¶å™¨éƒ½æœ‰è‡ªå·±çš„æƒ³æ³•ã€‚</p><h2 id=64-è®°å¿†é›†å’Œå¡è¡¨><a href=#64-%e8%ae%b0%e5%bf%86%e9%9b%86%e5%92%8c%e5%8d%a1%e8%a1%a8 class=header-anchor></a>6.4 è®°å¿†é›†å’Œå¡è¡¨</h2><h3 id=1è®°å¿†é›†remember-set><a href=#1%e8%ae%b0%e5%bf%86%e9%9b%86remember-set class=header-anchor></a>1.è®°å¿†é›†ï¼ˆRemember Setï¼‰</h3><p>åœ¨æ–°ç”Ÿä»£è§¦å‘Minor GCè¿›è¡ŒGC Rootå¯è¾¾æ€§æ‰«æçš„æ—¶å€™ï¼Œå¯èƒ½ä¼šç¢°åˆ°è·¨ä»£å¼•ç”¨ã€‚æ¯”å¦‚ï¼šæ–°ç”Ÿä»£çš„ä¸€ä¸ªå¯¹è±¡è¢«è€å¹´ä»£å¼•ç”¨äº†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œåœ¨åƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸åº”è¯¥æŠŠè¿™å—ç©ºé—´å›æ”¶æ‰ã€‚é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿè¦å»æ‰«æä¸€éè€å¹´ä»£ä¹ˆï¼Ÿè¿™æ˜¾ç„¶ä¸è¡Œï¼Œæ•ˆç‡å¤ªä½äº†ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒGCåœ¨æ‰«æçš„æ—¶å€™ï¼Œä¼šæŠŠè€å¹´ä»£å¼•ç”¨çš„å¯¹è±¡æ”¾åœ¨ä¸€ä¸ªå«åšè®°å¿†é›†çš„é›†åˆä¸­ã€‚</p><p>è¿™æ ·åœ¨åƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œé™¤äº†ä¼šæ‰«æGC Rootä¸‹çš„å¯¹è±¡ï¼Œè¿˜ä¼šæ‰«æä¸€éè®°å¿†é›†ä¸­çš„å¼•ç”¨ã€‚è®°å¿†é›†æ˜¯å­˜å‚¨åœ¨æ–°ç”Ÿä»£çš„ç©ºé—´ï¼Œä¿å­˜ç€è€å¹´ä»£å¯¹æ–°ç”Ÿä»£å†…å­˜çš„å¼•ç”¨å…³ç³»ã€‚è®°å¿†é›†å°±æ˜¯ä¸ºäº†è§£å†³å¯¹è±¡çš„è·¨ä»£å¼•ç”¨é—®é¢˜ã€‚</p><p>åƒåœ¾æ”¶é›†è¿‡ç¨‹ä¸­ï¼Œ æ”¶é›†å™¨åªéœ€è¦é€šè¿‡è®°å¿†é›†æ¥åˆ¤æ–­æŸä¸€å—éæ”¶é›†åŒºåŸŸæ˜¯å¦å­˜åœ¨æŒ‡å‘æ”¶é›†åŒºåŸŸçš„æŒ‡é’ˆå³å¯ï¼Œæ— éœ€äº†è§£è·¨ä»£å¼•ç”¨æŒ‡é’ˆçš„å…¨éƒ¨ç»†èŠ‚ã€‚</p><h3 id=2å¡è¡¨card-table><a href=#2%e5%8d%a1%e8%a1%a8card-table class=header-anchor></a>2.å¡è¡¨ï¼ˆCard Tableï¼‰</h3><p>hotspotä½¿ç”¨çš„æ˜¯å¡è¡¨ï¼ˆcardtableï¼‰æ¥å®ç°è®°å¿†é›†ã€‚å¡è¡¨å…¶å®å°±æ˜¯è®°å¿†é›†çš„ä¸€ä¸ªå®ç°ï¼Œå¡è¡¨å’Œè®°å¿†é›†çš„å…³ç³»å°±åƒHashMapå’ŒMapçš„å…³ç³»ã€‚è®°å¿†é›†ç›¸å½“äºä¸€ä¸ªæ¦‚å¿µï¼Œè€Œjdkä¸­æ˜¯é€šè¿‡å¡è¡¨æ¥å®ç°çš„ã€‚åˆ°åº•æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p><p><img src=https://logan.1357810.xyz/img/20220426/1650910288-d07867b199f96b.png width=900 height=600 loading=lazy decoding=async alt=img class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p>å¡è¡¨æ˜¯ä½¿ç”¨å­—èŠ‚æ•°ç»„å®ç°çš„ï¼Œå¡è¡¨çš„æ¯ä¸€ä¸ªå…ƒç´ å¯¹åº”ç€å…¶æ ‡å¿—çš„å†…å­˜åŒºåŸŸé‡Œä¸€å—å¾…å®šå¤§å°çš„å†…å­˜å—ã€‚è¿™äº›å¾…å®šçš„å†…å­˜å—å°±æ˜¯â€œå¡é¡µâ€ã€‚å †ç©ºé—´åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œå¡è¡¨ä¼šæŠŠè€å¹´ä»£åˆ’åˆ†ä¸ºä¸€å—ä¸€å—å°çš„æ ¼å­ï¼Œè¿™äº›å°æ ¼å­å°±æ˜¯â€œå¡é¡µâ€ã€‚å¡é¡µåˆ’åˆ†æ˜¯æŒ‰ç…§512å­—èŠ‚å¤§å°è¿›è¡Œåˆ’åˆ†çš„ã€‚å¦‚æœæœ‰ä¸€ä¸ªå¡é¡µå¼•ç”¨äº†æ–°ç”Ÿä»£çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå°±å°†è¿™ä¸ªå¡é¡µå°±ä¼šè¢«æ ‡è®°ä¸ºâ€œdirtyâ€ã€‚å¡è¡¨æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢è®°å½•äº†æ‰€æœ‰å¡é¡µçš„çŠ¶æ€ï¼Œç”¨010101æ¥æ ‡è®°å¡é¡µæ˜¯å¦å¼•ç”¨äº†æ–°ç”Ÿä»£å¯¹è±¡ã€‚å¦‚æœæ˜¯å°±æ ‡è®°ä¸º1ï¼Œä¸æ˜¯å°±ä¿æŒåŸæ¥çš„0. æ•°ç»„é‡Œé™¤äº†å­˜æ”¾å¡é¡µçš„çŠ¶æ€ï¼Œè¿˜æœ‰å¡é¡µçš„åœ°å€ã€‚åœ¨åƒåœ¾æ”¶é›†å™¨è¿›è¡Œæ‰«æçš„æ—¶å€™ï¼Œé™¤äº†æ‰«æGC Rootä¹‹å¤–ï¼Œè¿˜ä¼šæ‰«æå¡è¡¨é‡Œé‚£äº›çŠ¶æ€ä¸º1çš„å¡é¡µé‡Œçš„å¯¹è±¡ã€‚ å¡é¡µæ˜¯åœ¨è€å¹´ä»£ï¼Œç»´æŠ¤å¡é¡µçš„å¡è¡¨æ˜¯åœ¨å¹´è½»ä»£ã€‚</p><h3 id=1363-è®¾ç½®çš„å‚æ•°><a href=#1363-%e8%ae%be%e7%bd%ae%e7%9a%84%e5%8f%82%e6%95%b0 class=header-anchor></a>13.6.3. è®¾ç½®çš„å‚æ•°</h3><ul><li><p><code>-XX:+UseConcMarkSweepGC </code>æ‰‹åŠ¨æŒ‡å®šä½¿ç”¨ CMS æ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡ã€‚</p><p>å¼€å¯è¯¥å‚æ•°åä¼šè‡ªåŠ¨å°†<code>-xx:+UseParNewGC</code>æ‰“å¼€ã€‚å³ï¼šParNewï¼ˆYoung åŒºç”¨ï¼‰+CMSï¼ˆOld åŒºç”¨ï¼‰+ Serial Old çš„ç»„åˆã€‚</p></li><li><p><code>-XX:CMSInitiatingOccupancyFraction</code> è®¾ç½®å †å†…å­˜ä½¿ç”¨ç‡çš„é˜ˆå€¼ï¼Œä¸€æ—¦è¾¾åˆ°è¯¥é˜ˆå€¼ï¼Œä¾¿å¼€å§‹è¿›è¡Œå›æ”¶ã€‚</p><ul><li>JDK5 åŠä»¥å‰ç‰ˆæœ¬çš„é»˜è®¤å€¼ä¸º 68ï¼Œå³å½“è€å¹´ä»£çš„ç©ºé—´ä½¿ç”¨ç‡è¾¾åˆ° 68%æ—¶ï¼Œä¼šæ‰§è¡Œä¸€æ¬¡ CMS å›æ”¶ã€‚<mark>JDK6 åŠä»¥ä¸Šç‰ˆæœ¬é»˜è®¤å€¼ä¸º 92%</mark></li><li>å¦‚æœå†…å­˜å¢é•¿ç¼“æ…¢ï¼Œåˆ™å¯ä»¥è®¾ç½®ä¸€ä¸ªç¨å¤§çš„å€¼ï¼Œå¤§çš„é˜€å€¼å¯ä»¥æœ‰æ•ˆé™ä½ CMS çš„è§¦å‘é¢‘ç‡ï¼Œå‡å°‘è€å¹´ä»£å›æ”¶çš„æ¬¡æ•°å¯ä»¥è¾ƒä¸ºæ˜æ˜¾åœ°æ”¹å–„åº”ç”¨ç¨‹åºæ€§èƒ½ã€‚åä¹‹ï¼Œå¦‚æœåº”ç”¨ç¨‹åºå†…å­˜ä½¿ç”¨ç‡å¢é•¿å¾ˆå¿«ï¼Œåˆ™åº”è¯¥é™ä½è¿™ä¸ªé˜ˆå€¼ï¼Œä»¥é¿å…é¢‘ç¹è§¦å‘è€å¹´ä»£ä¸²è¡Œæ”¶é›†å™¨ã€‚å› æ­¤é€šè¿‡è¯¥é€‰é¡¹ä¾¿å¯ä»¥æœ‰æ•ˆé™ä½ Ful1Gc çš„æ‰§è¡Œæ¬¡æ•°ã€‚</li><li><code>-XX:+UseCMSInitiatingOccupanyOnly</code> åªä½¿ç”¨è®¾å®šçš„é˜ˆå€¼(CMSInitiatingOccupanyFraction),å¦‚æœä¸æŒ‡å®šï¼Œjvmä»…åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨è®¾å®šå€¼ï¼Œåç»­ä¼šè‡ªåŠ¨è°ƒæ•´é˜ˆå€¼</li></ul></li><li><p><code>-XX:+UseCMSCompactAtFullCollection</code> ç”¨äºæŒ‡å®šåœ¨æ‰§è¡Œå®Œ Full GC åå¯¹å†…å­˜ç©ºé—´è¿›è¡Œå‹ç¼©æ•´ç†ï¼Œä»¥æ­¤é¿å…å†…å­˜ç¢ç‰‡çš„äº§ç”Ÿã€‚ä¸è¿‡ç”±äºå†…å­˜å‹ç¼©æ•´ç†è¿‡ç¨‹æ— æ³•å¹¶å‘æ‰§è¡Œï¼Œæ‰€å¸¦æ¥çš„é—®é¢˜å°±æ˜¯åœé¡¿æ—¶é—´å˜å¾—æ›´é•¿äº†ã€‚é»˜è®¤å¼€å¯</p></li><li><p><code>-XX:CMSFullGCsBeforeCompaction</code> è®¾ç½®åœ¨æ‰§è¡Œå¤šå°‘æ¬¡ Full GC åå¯¹å†…å­˜ç©ºé—´è¿›è¡Œå‹ç¼©æ•´ç†ï¼Œé»˜è®¤ä¸º0ã€‚</p></li><li><p><code>-XX:CMSScavengeBeforeRemark</code>,åœ¨CMS GCå‰å¯åŠ¨ä¸€æ¬¡minorGCï¼Œç›®çš„å‡å°‘è€å¹´ä»£å¯¹æ–°ç”Ÿä»£çš„å¼•ç”¨ï¼Œé™ä½CMS GCçš„æ ‡è®°æ—¶æ®µçš„å¼€é”€ï¼Œä¸€èˆ¬CMSçš„GCè€—æ—¶80%éƒ½åœ¨æ ‡è®°é˜¶æ®µï¼Œé»˜è®¤å…³é—­</p></li><li><p><code>-XX:+CMSParallelInitialMarkEnabled</code>,è¡¨ç¤ºåœ¨åˆå§‹æ ‡è®°é˜¶æ®µå¤šçº¿ç¨‹æ‰§è¡Œï¼Œç¼©çŸ­STWï¼Œé»˜è®¤å¼€å¯</p></li><li><p><code>-XX:+CMSParallelRemarkEnabled</code>,CMSParallelRemarkEnabledè¡¨ç¤ºåœ¨é‡æ–°æ ‡è®°é˜¶æ®µå¤šçº¿ç¨‹æ‰§è¡Œï¼Œç¼©çŸ­STWï¼Œé»˜è®¤å¼€å¯</p></li><li><p><code>-XX:ParallelcMSThreads</code> è®¾ç½® CMS çš„çº¿ç¨‹æ•°é‡ã€‚</p><ul><li>CMS é»˜è®¤å¯åŠ¨çš„çº¿ç¨‹æ•°æ˜¯ï¼ˆParallelGCThreads+3ï¼‰/4ï¼ŒParallelGCThreads æ˜¯å¹´è½»ä»£å¹¶è¡Œæ”¶é›†å™¨çš„çº¿ç¨‹æ•°ã€‚å½“ CPU èµ„æºæ¯”è¾ƒç´§å¼ æ—¶ï¼Œå—åˆ° CMS æ”¶é›†å™¨çº¿ç¨‹çš„å½±å“ï¼Œåº”ç”¨ç¨‹åºçš„æ€§èƒ½åœ¨åƒåœ¾å›æ”¶é˜¶æ®µå¯èƒ½ä¼šéå¸¸ç³Ÿç³•ã€‚</li></ul></li></ul><h3 id=å°ç»“><a href=#%e5%b0%8f%e7%bb%93 class=header-anchor></a>å°ç»“</h3><p>HotSpot æœ‰è¿™ä¹ˆå¤šçš„åƒåœ¾å›æ”¶å™¨ï¼Œé‚£ä¹ˆå¦‚æœæœ‰äººé—®ï¼ŒSerial GCã€Parallel GCã€Concurrent Mark Sweep GC è¿™ä¸‰ä¸ª Gc æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ</p><p>è¯·è®°ä½ä»¥ä¸‹å£ä»¤ï¼š</p><ul><li>å¦‚æœä½ æƒ³è¦æœ€å°åŒ–åœ°ä½¿ç”¨å†…å­˜å’Œå¹¶è¡Œå¼€é”€ï¼Œè¯·é€‰ Serial GCï¼›</li><li>å¦‚æœä½ æƒ³è¦æœ€å¤§åŒ–åº”ç”¨ç¨‹åºçš„ååé‡ï¼Œè¯·é€‰ Parallel GCï¼›</li><li>å¦‚æœä½ æƒ³è¦æœ€å°åŒ– GC çš„ä¸­æ–­æˆ–åœé¡¿æ—¶é—´ï¼Œè¯·é€‰ CMS GCã€‚</li></ul><h3 id=1364-jdk-åç»­ç‰ˆæœ¬ä¸­-cms-çš„å˜åŒ–><a href=#1364-jdk-%e5%90%8e%e7%bb%ad%e7%89%88%e6%9c%ac%e4%b8%ad-cms-%e7%9a%84%e5%8f%98%e5%8c%96 class=header-anchor></a>13.6.4. JDK åç»­ç‰ˆæœ¬ä¸­ CMS çš„å˜åŒ–</h3><p>JDK9 æ–°ç‰¹æ€§ï¼šCMS è¢«æ ‡è®°ä¸º Deprecate äº†ï¼ˆJEP291ï¼‰</p><ul><li>å¦‚æœå¯¹ JDK9 åŠä»¥ä¸Šç‰ˆæœ¬çš„ HotSpot è™šæ‹Ÿæœºä½¿ç”¨å‚æ•°<code>-XX: +UseConcMarkSweepGC</code>æ¥å¼€å¯ CMS æ”¶é›†å™¨çš„è¯ï¼Œç”¨æˆ·ä¼šæ”¶åˆ°ä¸€ä¸ªè­¦å‘Šä¿¡æ¯ï¼Œæç¤º CMS æœªæ¥å°†ä¼šè¢«åºŸå¼ƒã€‚</li></ul><p>JDK14 æ–°ç‰¹æ€§ï¼šåˆ é™¤ CMS åƒåœ¾å›æ”¶å™¨ï¼ˆJEP363ï¼‰</p><ul><li>ç§»é™¤äº† CMS åƒåœ¾æ”¶é›†å™¨ï¼Œå¦‚æœåœ¨ JDK14 ä¸­ä½¿ç”¨ <code>-XX:+UseConcMarkSweepGC</code>çš„è¯ï¼ŒJVM ä¸ä¼šæŠ¥é”™ï¼Œåªæ˜¯ç»™å‡ºä¸€ä¸ª warning ä¿¡æ¯ï¼Œä½†æ˜¯ä¸ä¼š exitã€‚JVM ä¼šè‡ªåŠ¨å›é€€ä»¥é»˜è®¤ GC æ–¹å¼å¯åŠ¨ JVM</li></ul><h2 id=137-g1-å›æ”¶å™¨åŒºåŸŸåŒ–åˆ†ä»£å¼><a href=#137-g1-%e5%9b%9e%e6%94%b6%e5%99%a8%e5%8c%ba%e5%9f%9f%e5%8c%96%e5%88%86%e4%bb%a3%e5%bc%8f class=header-anchor></a>13.7. G1 å›æ”¶å™¨ï¼šåŒºåŸŸåŒ–åˆ†ä»£å¼</h2><p><strong>æ—¢ç„¶æˆ‘ä»¬å·²ç»æœ‰äº†å‰é¢å‡ ä¸ªå¼ºå¤§çš„ GCï¼Œä¸ºä»€ä¹ˆè¿˜è¦å‘å¸ƒ Garbage Firstï¼ˆG1ï¼‰ï¼Ÿ</strong></p><p>åŸå› å°±åœ¨äºåº”ç”¨ç¨‹åºæ‰€åº”å¯¹çš„<mark>ä¸šåŠ¡è¶Šæ¥è¶Šåºå¤§ã€å¤æ‚ï¼Œç”¨æˆ·è¶Šæ¥è¶Šå¤š</mark>ï¼Œæ²¡æœ‰ GC å°±ä¸èƒ½ä¿è¯åº”ç”¨ç¨‹åºæ­£å¸¸è¿›è¡Œï¼Œè€Œç»å¸¸é€ æˆ STW çš„ GC åˆè·Ÿä¸ä¸Šå®é™…çš„éœ€æ±‚ï¼Œæ‰€ä»¥æ‰ä¼šä¸æ–­åœ°å°è¯•å¯¹ GC è¿›è¡Œä¼˜åŒ–ã€‚G1ï¼ˆGarbage-Firstï¼‰åƒåœ¾å›æ”¶å™¨æ˜¯åœ¨ Java7 update4 ä¹‹åå¼•å…¥çš„ä¸€ä¸ªæ–°çš„åƒåœ¾å›æ”¶å™¨ï¼Œæ˜¯å½“ä»Šæ”¶é›†å™¨æŠ€æœ¯å‘å±•çš„æœ€å‰æ²¿æˆæœä¹‹ä¸€ã€‚</p><p>ä¸æ­¤åŒæ—¶ï¼Œä¸ºäº†é€‚åº”ç°åœ¨<mark>ä¸æ–­æ‰©å¤§çš„å†…å­˜å’Œä¸æ–­å¢åŠ çš„å¤„ç†å™¨æ•°é‡</mark>ï¼Œè¿›ä¸€æ­¥é™ä½æš‚åœæ—¶é—´ï¼ˆpause timeï¼‰ï¼ŒåŒæ—¶å…¼é¡¾è‰¯å¥½çš„ååé‡ã€‚</p><p><mark>å®˜æ–¹ç»™ G1 è®¾å®šçš„ç›®æ ‡æ˜¯åœ¨å»¶è¿Ÿå¯æ§çš„æƒ…å†µä¸‹è·å¾—å°½å¯èƒ½é«˜çš„ååé‡ï¼Œæ‰€ä»¥æ‰æ‹…å½“èµ·â€œå…¨åŠŸèƒ½æ”¶é›†å™¨â€çš„é‡ä»»ä¸æœŸæœ›ã€‚</mark></p><p><strong>ä¸ºä»€ä¹ˆåå­—å« Garbage First(G1)å‘¢ï¼Ÿ</strong></p><p>å› ä¸º G1 æ˜¯ä¸€ä¸ªå¹¶è¡Œå›æ”¶å™¨ï¼Œå®ƒæŠŠå †å†…å­˜åˆ†å‰²ä¸ºå¾ˆå¤šä¸ç›¸å…³çš„åŒºåŸŸï¼ˆRegionï¼‰ï¼ˆç‰©ç†ä¸Šä¸è¿ç»­çš„ï¼‰ã€‚ä½¿ç”¨ä¸åŒçš„ Region æ¥è¡¨ç¤º Edenã€å¹¸å­˜è€… 0 åŒºï¼Œå¹¸å­˜è€… 1 åŒºï¼Œè€å¹´ä»£ç­‰ã€‚</p><p>G1 GC æœ‰è®¡åˆ’åœ°é¿å…åœ¨æ•´ä¸ª Java å †ä¸­è¿›è¡Œå…¨åŒºåŸŸçš„åƒåœ¾æ”¶é›†ã€‚G1 è·Ÿè¸ªå„ä¸ª Region é‡Œé¢çš„åƒåœ¾å †ç§¯çš„ä»·å€¼å¤§å°ï¼ˆå›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°ä»¥åŠå›æ”¶æ‰€éœ€æ—¶é—´çš„ç»éªŒå€¼ï¼‰ï¼Œåœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œ<mark>æ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„ Region</mark>ã€‚</p><p>ç”±äºè¿™ç§æ–¹å¼çš„ä¾§é‡ç‚¹åœ¨äºå›æ”¶åƒåœ¾æœ€å¤§é‡çš„åŒºé—´ï¼ˆRegionï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»™ G1 ä¸€ä¸ªåå­—ï¼šåƒåœ¾ä¼˜å…ˆï¼ˆGarbage Firstï¼‰ã€‚</p><p>G1ï¼ˆGarbage-Firstï¼‰æ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„åƒåœ¾æ”¶é›†å™¨ï¼Œ<mark>ä¸»è¦é’ˆå¯¹é…å¤‡å¤šæ ¸ CPU åŠå¤§å®¹é‡å†…å­˜çš„æœºå™¨</mark>ï¼Œä»¥æé«˜æ¦‚ç‡æ»¡è¶³ GC åœé¡¿æ—¶é—´çš„åŒæ—¶ï¼Œè¿˜å…¼å…·é«˜ååé‡çš„æ€§èƒ½ç‰¹å¾ã€‚</p><p>åœ¨ JDK1.7 ç‰ˆæœ¬æ­£å¼å¯ç”¨ï¼Œç§»é™¤äº† Experimenta1 çš„æ ‡è¯†ï¼Œæ˜¯<mark>JDK9 ä»¥åçš„é»˜è®¤åƒåœ¾å›æ”¶å™¨</mark>ï¼Œå–ä»£äº† CMS å›æ”¶å™¨ä»¥åŠ Parallel+Parallel Old ç»„åˆã€‚è¢« Oracle å®˜æ–¹ç§°ä¸ºâ€œ<mark>å…¨åŠŸèƒ½çš„åƒåœ¾æ”¶é›†å™¨</mark>â€ã€‚</p><p>ä¸æ­¤åŒæ—¶ï¼ŒCMS å·²ç»åœ¨ JDK9 ä¸­è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼ˆdeprecatedï¼‰ã€‚åœ¨ jdk8 ä¸­è¿˜ä¸æ˜¯é»˜è®¤çš„åƒåœ¾å›æ”¶å™¨ï¼Œéœ€è¦ä½¿ç”¨<code>-XX:+UseG1GC</code>æ¥å¯ç”¨ã€‚</p><h3 id=1371-g1-å›æ”¶å™¨çš„ç‰¹ç‚¹ä¼˜åŠ¿><a href=#1371-g1-%e5%9b%9e%e6%94%b6%e5%99%a8%e7%9a%84%e7%89%b9%e7%82%b9%e4%bc%98%e5%8a%bf class=header-anchor></a>13.7.1. G1 å›æ”¶å™¨çš„ç‰¹ç‚¹ï¼ˆä¼˜åŠ¿ï¼‰</h3><p>ä¸å…¶ä»– GC æ”¶é›†å™¨ç›¸æ¯”ï¼ŒG1 ä½¿ç”¨äº†å…¨æ–°çš„åˆ†åŒºç®—æ³•ï¼Œå…¶ç‰¹ç‚¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><h4 id=å¹¶è¡Œä¸å¹¶å‘><a href=#%e5%b9%b6%e8%a1%8c%e4%b8%8e%e5%b9%b6%e5%8f%91 class=header-anchor></a>å¹¶è¡Œä¸å¹¶å‘</h4><ul><li>å¹¶è¡Œæ€§ï¼šG1 åœ¨å›æ”¶æœŸé—´ï¼Œå¯ä»¥æœ‰å¤šä¸ª GC çº¿ç¨‹åŒæ—¶å·¥ä½œï¼Œæœ‰æ•ˆåˆ©ç”¨å¤šæ ¸è®¡ç®—èƒ½åŠ›ã€‚æ­¤æ—¶ç”¨æˆ·çº¿ç¨‹ STW</li><li>å¹¶å‘æ€§ï¼šG1 æ‹¥æœ‰ä¸åº”ç”¨ç¨‹åºäº¤æ›¿æ‰§è¡Œçš„èƒ½åŠ›ï¼Œéƒ¨åˆ†å·¥ä½œå¯ä»¥å’Œåº”ç”¨ç¨‹åºåŒæ—¶æ‰§è¡Œï¼Œå› æ­¤ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä¸ä¼šåœ¨æ•´ä¸ªå›æ”¶é˜¶æ®µå‘ç”Ÿå®Œå…¨é˜»å¡åº”ç”¨ç¨‹åºçš„æƒ…å†µ</li></ul><h4 id=åˆ†ä»£æ”¶é›†><a href=#%e5%88%86%e4%bb%a3%e6%94%b6%e9%9b%86 class=header-anchor></a>åˆ†ä»£æ”¶é›†</h4><ul><li>ä»åˆ†ä»£ä¸Šçœ‹ï¼Œ<mark>G1 ä¾ç„¶å±äºåˆ†ä»£å‹åƒåœ¾å›æ”¶å™¨</mark>ï¼Œå®ƒä¼šåŒºåˆ†å¹´è½»ä»£å’Œè€å¹´ä»£ï¼Œå¹´è½»ä»£ä¾ç„¶æœ‰ Eden åŒºå’Œ Survivor åŒºã€‚ä½†ä»å †çš„ç»“æ„ä¸Šçœ‹ï¼Œå®ƒä¸è¦æ±‚æ•´ä¸ª Eden åŒºã€å¹´è½»ä»£æˆ–è€…è€å¹´ä»£éƒ½æ˜¯è¿ç»­çš„ï¼Œä¹Ÿä¸å†åšæŒå›ºå®šå¤§å°å’Œå›ºå®šæ•°é‡ã€‚</li><li>å°†<mark>å †ç©ºé—´åˆ†ä¸ºè‹¥å¹²ä¸ªåŒºåŸŸï¼ˆRegionï¼‰ï¼Œè¿™äº›åŒºåŸŸä¸­åŒ…å«äº†é€»è¾‘ä¸Šçš„å¹´è½»ä»£å’Œè€å¹´ä»£</mark>ã€‚</li><li>å’Œä¹‹å‰çš„å„ç±»å›æ”¶å™¨ä¸åŒï¼Œå®ƒåŒæ—¶<mark>å…¼é¡¾å¹´è½»ä»£å’Œè€å¹´ä»£</mark>ã€‚å¯¹æ¯”å…¶ä»–å›æ”¶å™¨ï¼Œæˆ–è€…å·¥ä½œåœ¨å¹´è½»ä»£ï¼Œæˆ–è€…å·¥ä½œåœ¨è€å¹´ä»£ï¼›</li></ul><p><img src=https://logan.1357810.xyz/img/20220422/153020741-087e0241b6.png width=900 height=600 loading=lazy decoding=async alt=image-20200713215105293 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p><img src=https://logan.1357810.xyz/img/20220422/153020741-2cea0769b8.png width=900 height=600 loading=lazy decoding=async alt=image-20200713215133839 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><h4 id=ç©ºé—´æ•´åˆ><a href=#%e7%a9%ba%e9%97%b4%e6%95%b4%e5%90%88 class=header-anchor></a>ç©ºé—´æ•´åˆ</h4><ul><li>CMSï¼šâ€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ã€å†…å­˜ç¢ç‰‡ã€è‹¥å¹²æ¬¡ Gc åè¿›è¡Œä¸€æ¬¡ç¢ç‰‡æ•´ç†</li><li>G1 å°†å†…å­˜åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªçš„ regionã€‚å†…å­˜çš„å›æ”¶æ˜¯ä»¥ region ä½œä¸ºåŸºæœ¬å•ä½çš„ã€‚<mark>Region ä¹‹é—´æ˜¯å¤åˆ¶ç®—æ³•</mark>ï¼Œä½†æ•´ä½“ä¸Šå®é™…å¯çœ‹ä½œæ˜¯<mark>æ ‡è®°-å‹ç¼©ï¼ˆMark-Compactï¼‰ç®—æ³•</mark>ï¼Œä¸¤ç§ç®—æ³•éƒ½å¯ä»¥é¿å…å†…å­˜ç¢ç‰‡ã€‚è¿™ç§ç‰¹æ€§æœ‰åˆ©äºç¨‹åºé•¿æ—¶é—´è¿è¡Œï¼Œåˆ†é…å¤§å¯¹è±¡æ—¶ä¸ä¼šå› ä¸ºæ— æ³•æ‰¾åˆ°è¿ç»­å†…å­˜ç©ºé—´è€Œæå‰è§¦å‘ä¸‹ä¸€æ¬¡ GCã€‚å°¤å…¶æ˜¯å½“ Java å †éå¸¸å¤§çš„æ—¶å€™ï¼ŒG1 çš„ä¼˜åŠ¿æ›´åŠ æ˜æ˜¾ã€‚</li></ul><h4 id=å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹å³è½¯å®æ—¶-soft-real-time><a href=#%e5%8f%af%e9%a2%84%e6%b5%8b%e7%9a%84%e5%81%9c%e9%a1%bf%e6%97%b6%e9%97%b4%e6%a8%a1%e5%9e%8b%e5%8d%b3%e8%bd%af%e5%ae%9e%e6%97%b6-soft-real-time class=header-anchor></a>å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼ˆå³ï¼šè½¯å®æ—¶ soft real-timeï¼‰</h4><p>è¿™æ˜¯ G1 ç›¸å¯¹äº CMS çš„å¦ä¸€å¤§ä¼˜åŠ¿ï¼ŒG1 é™¤äº†è¿½æ±‚ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸º M æ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨åƒåœ¾æ”¶é›†ä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡ N æ¯«ç§’ã€‚</p><ul><li>ç”±äºåˆ†åŒºçš„åŸå› ï¼ŒG1 å¯ä»¥åªé€‰å–éƒ¨åˆ†åŒºåŸŸè¿›è¡Œå†…å­˜å›æ”¶ï¼Œè¿™æ ·ç¼©å°äº†å›æ”¶çš„èŒƒå›´ï¼Œå› æ­¤å¯¹äºå…¨å±€åœé¡¿æƒ…å†µçš„å‘ç”Ÿä¹Ÿèƒ½å¾—åˆ°è¾ƒå¥½çš„æ§åˆ¶ã€‚</li><li>G1 è·Ÿè¸ªå„ä¸ª Region é‡Œé¢çš„åƒåœ¾å †ç§¯çš„ä»·å€¼å¤§å°ï¼ˆå›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°ä»¥åŠå›æ”¶æ‰€éœ€æ—¶é—´çš„ç»éªŒå€¼ï¼‰ï¼Œåœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œ<mark>æ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„ Region</mark>ã€‚ä¿è¯äº† G1 æ”¶é›†å™¨åœ¨æœ‰é™çš„æ—¶é—´å†…å¯ä»¥è·å–å°½å¯èƒ½é«˜çš„æ”¶é›†æ•ˆç‡ã€‚</li><li>ç›¸æ¯”äº CMSGCï¼ŒG1 æœªå¿…èƒ½åšåˆ° CMS åœ¨æœ€å¥½æƒ…å†µä¸‹çš„å»¶æ—¶åœé¡¿ï¼Œä½†æ˜¯æœ€å·®æƒ…å†µè¦å¥½å¾ˆå¤šã€‚</li></ul><h3 id=1372-g1-åƒåœ¾æ”¶é›†å™¨çš„ç¼ºç‚¹><a href=#1372-g1-%e5%9e%83%e5%9c%be%e6%94%b6%e9%9b%86%e5%99%a8%e7%9a%84%e7%bc%ba%e7%82%b9 class=header-anchor></a>13.7.2. G1 åƒåœ¾æ”¶é›†å™¨çš„ç¼ºç‚¹</h3><p>ç›¸è¾ƒäº CMSï¼ŒG1 è¿˜ä¸å…·å¤‡å…¨æ–¹ä½ã€å‹å€’æ€§ä¼˜åŠ¿ã€‚æ¯”å¦‚åœ¨ç”¨æˆ·ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒG1 æ— è®ºæ˜¯ä¸ºäº†åƒåœ¾æ”¶é›†äº§ç”Ÿçš„å†…å­˜å ç”¨ï¼ˆFootprintï¼‰è¿˜æ˜¯ç¨‹åºè¿è¡Œæ—¶çš„é¢å¤–æ‰§è¡Œè´Ÿè½½ï¼ˆOverloadï¼‰éƒ½è¦æ¯” CMS è¦é«˜ã€‚</p><p>ä»ç»éªŒä¸Šæ¥è¯´ï¼Œåœ¨å°å†…å­˜åº”ç”¨ä¸Š CMS çš„è¡¨ç°å¤§æ¦‚ç‡ä¼šä¼˜äº G1ï¼Œè€Œ G1 åœ¨å¤§å†…å­˜åº”ç”¨ä¸Šåˆ™å‘æŒ¥å…¶ä¼˜åŠ¿ã€‚å¹³è¡¡ç‚¹åœ¨ 6-8GB ä¹‹é—´ã€‚</p><h3 id=1373-g1-å›æ”¶å™¨çš„å‚æ•°è®¾ç½®><a href=#1373-g1-%e5%9b%9e%e6%94%b6%e5%99%a8%e7%9a%84%e5%8f%82%e6%95%b0%e8%ae%be%e7%bd%ae class=header-anchor></a>13.7.3. G1 å›æ”¶å™¨çš„å‚æ•°è®¾ç½®</h3><ul><li><code>-XX:+UseG1GC</code>ï¼šæ‰‹åŠ¨æŒ‡å®šä½¿ç”¨ G1 åƒåœ¾æ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡</li><li><code>-XX:G1HeapRegionSize</code> è®¾ç½®æ¯ä¸ª Region çš„å¤§å°ã€‚å€¼æ˜¯ 2 çš„å¹‚ï¼ŒèŒƒå›´æ˜¯ 1MB åˆ° 32MB ä¹‹é—´ï¼Œç›®æ ‡æ˜¯æ ¹æ®æœ€å°çš„ Java å †å¤§å°åˆ’åˆ†å‡ºçº¦ 2048 ä¸ªåŒºåŸŸã€‚é»˜è®¤æ˜¯å †å†…å­˜çš„ 1/2000ã€‚</li><li><code>-XX:MaxGCPauseMillis</code> è®¾ç½®æœŸæœ›è¾¾åˆ°çš„æœ€å¤§ GC åœé¡¿æ—¶é—´æŒ‡æ ‡ï¼ˆJVM ä¼šå°½åŠ›å®ç°ï¼Œä½†ä¸ä¿è¯è¾¾åˆ°ï¼‰ã€‚é»˜è®¤å€¼æ˜¯ 200msï¼ˆäººçš„å¹³å‡ååº”é€Ÿåº¦ï¼‰</li><li><code>-XX:+ParallelGCThread</code> è®¾ç½® STW å·¥ä½œçº¿ç¨‹æ•°çš„å€¼ã€‚æœ€å¤šè®¾ç½®ä¸º 8ï¼ˆä¸Šé¢è¯´è¿‡ Parallel å›æ”¶å™¨çš„çº¿ç¨‹è®¡ç®—å…¬å¼ï¼Œå½“ CPU_Count > 8 æ—¶ï¼ŒParallelGCThreads ä¹Ÿä¼šå¤§äº 8ï¼‰</li><li><code>-XX:ConcGCThreads</code> è®¾ç½®å¹¶å‘æ ‡è®°çš„çº¿ç¨‹æ•°ã€‚å°† n è®¾ç½®ä¸ºå¹¶è¡Œåƒåœ¾å›æ”¶çº¿ç¨‹æ•°ï¼ˆParallelGCThreadsï¼‰çš„ 1/4 å·¦å³ã€‚</li><li><code>-XX:InitiatingHeapOccupancyPercent</code> è®¾ç½®è§¦å‘å¹¶å‘ GC å‘¨æœŸçš„ Java å †å ç”¨ç‡é˜ˆå€¼ã€‚è¶…è¿‡æ­¤å€¼ï¼Œå°±è§¦å‘ GCã€‚é»˜è®¤å€¼æ˜¯ 45ã€‚</li></ul><h3 id=1374-g1-æ”¶é›†å™¨çš„å¸¸è§æ“ä½œæ­¥éª¤><a href=#1374-g1-%e6%94%b6%e9%9b%86%e5%99%a8%e7%9a%84%e5%b8%b8%e8%a7%81%e6%93%8d%e4%bd%9c%e6%ad%a5%e9%aa%a4 class=header-anchor></a>13.7.4. G1 æ”¶é›†å™¨çš„å¸¸è§æ“ä½œæ­¥éª¤</h3><p>G1 çš„è®¾è®¡åŸåˆ™å°±æ˜¯ç®€åŒ– JVM æ€§èƒ½è°ƒä¼˜ï¼Œå¼€å‘äººå‘˜åªéœ€è¦ç®€å•çš„ä¸‰æ­¥å³å¯å®Œæˆè°ƒä¼˜ï¼š</p><ul><li>ç¬¬ä¸€æ­¥ï¼šå¼€å¯ G1 åƒåœ¾æ”¶é›†å™¨</li><li>ç¬¬äºŒæ­¥ï¼šè®¾ç½®å †çš„æœ€å¤§å†…å­˜</li><li>ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®æœ€å¤§çš„åœé¡¿æ—¶é—´</li></ul><p>G1 ä¸­æä¾›äº†ä¸‰ç§åƒåœ¾å›æ”¶æ¨¡å¼ï¼šYoung GCã€Mixed GC å’Œ Full GCï¼Œåœ¨ä¸åŒçš„æ¡ä»¶ä¸‹è¢«è§¦å‘ã€‚</p><h3 id=1375-g1-æ”¶é›†å™¨çš„é€‚ç”¨åœºæ™¯><a href=#1375-g1-%e6%94%b6%e9%9b%86%e5%99%a8%e7%9a%84%e9%80%82%e7%94%a8%e5%9c%ba%e6%99%af class=header-anchor></a>13.7.5. G1 æ”¶é›†å™¨çš„é€‚ç”¨åœºæ™¯</h3><p>é¢å‘æœåŠ¡ç«¯åº”ç”¨ï¼Œé’ˆå¯¹å…·æœ‰å¤§å†…å­˜ã€å¤šå¤„ç†å™¨çš„æœºå™¨ã€‚ï¼ˆåœ¨æ™®é€šå¤§å°çš„å †é‡Œè¡¨ç°å¹¶ä¸æƒŠå–œï¼‰</p><p>æœ€ä¸»è¦çš„åº”ç”¨æ˜¯éœ€è¦ä½ GC å»¶è¿Ÿï¼Œå¹¶å…·æœ‰å¤§å †çš„åº”ç”¨ç¨‹åºæä¾›è§£å†³æ–¹æ¡ˆï¼›å¦‚ï¼šåœ¨å †å¤§å°çº¦ 6GB æˆ–æ›´å¤§æ—¶ï¼Œå¯é¢„æµ‹çš„æš‚åœæ—¶é—´å¯ä»¥ä½äº 0.5 ç§’ï¼›ï¼ˆG1 é€šè¿‡æ¯æ¬¡åªæ¸…ç†ä¸€éƒ¨åˆ†è€Œä¸æ˜¯å…¨éƒ¨çš„ Region çš„å¢é‡å¼æ¸…ç†æ¥ä¿è¯æ¯æ¬¡ GC åœé¡¿æ—¶é—´ä¸ä¼šè¿‡é•¿ï¼‰ã€‚</p><p>ç”¨æ¥æ›¿æ¢æ‰ JDK1.5 ä¸­çš„ CMS æ”¶é›†å™¨ï¼›åœ¨ä¸‹é¢çš„æƒ…å†µæ—¶ï¼Œä½¿ç”¨ G1 å¯èƒ½æ¯” CMS å¥½ï¼š</p><ul><li>è¶…è¿‡ 50%çš„ Java å †è¢«æ´»åŠ¨æ•°æ®å ç”¨ï¼›</li><li>å¯¹è±¡åˆ†é…é¢‘ç‡æˆ–å¹´ä»£æå‡é¢‘ç‡å˜åŒ–å¾ˆå¤§ï¼›</li><li>GC åœé¡¿æ—¶é—´è¿‡é•¿ï¼ˆé•¿äº 0.5 è‡³ 1 ç§’ï¼‰</li></ul><p>HotSpot åƒåœ¾æ”¶é›†å™¨é‡Œï¼Œé™¤äº† G1 ä»¥å¤–ï¼Œå…¶ä»–çš„åƒåœ¾æ”¶é›†å™¨ä½¿ç”¨å†…ç½®çš„ JVM çº¿ç¨‹æ‰§è¡Œ GC çš„å¤šçº¿ç¨‹æ“ä½œï¼Œè€Œ G1 GC å¯ä»¥é‡‡ç”¨åº”ç”¨çº¿ç¨‹æ‰¿æ‹…åå°è¿è¡Œçš„ GC å·¥ä½œï¼Œå³å½“ JVM çš„ GC çº¿ç¨‹å¤„ç†é€Ÿåº¦æ…¢æ—¶ï¼Œç³»ç»Ÿä¼šè°ƒç”¨åº”ç”¨ç¨‹åºçº¿ç¨‹å¸®åŠ©åŠ é€Ÿåƒåœ¾å›æ”¶è¿‡ç¨‹ã€‚</p><h3 id=1376-åˆ†åŒº-regionåŒ–æ•´ä¸ºé›¶><a href=#1376-%e5%88%86%e5%8c%ba-region%e5%8c%96%e6%95%b4%e4%b8%ba%e9%9b%b6 class=header-anchor></a>13.7.6. åˆ†åŒº Regionï¼šåŒ–æ•´ä¸ºé›¶</h3><p>ä½¿ç”¨ G1 æ”¶é›†å™¨æ—¶ï¼Œå®ƒå°†æ•´ä¸ª Java å †åˆ’åˆ†æˆçº¦ 2048 ä¸ªå¤§å°ç›¸åŒçš„ç‹¬ç«‹ Region å—ï¼Œæ¯ä¸ª Region å—å¤§å°æ ¹æ®å †ç©ºé—´çš„å®é™…å¤§å°è€Œå®šï¼Œæ•´ä½“è¢«æ§åˆ¶åœ¨ 1MB åˆ° 32MB ä¹‹é—´ï¼Œä¸”ä¸º 2 çš„ N æ¬¡å¹‚ï¼Œå³ 1MBï¼Œ2MBï¼Œ4MBï¼Œ8MBï¼Œ16MBï¼Œ32MBã€‚å¯ä»¥é€šè¿‡<code>-XX:G1HeapRegionSize</code>è®¾å®šã€‚<mark>æ‰€æœ‰çš„ Region å¤§å°ç›¸åŒï¼Œä¸”åœ¨ JVM ç”Ÿå‘½å‘¨æœŸå†…ä¸ä¼šè¢«æ”¹å˜ã€‚</mark></p><p>è™½ç„¶è¿˜ä¿ç•™æœ‰æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¦‚å¿µï¼Œä½†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸å†æ˜¯ç‰©ç†éš”ç¦»çš„äº†ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸€éƒ¨åˆ† Regionï¼ˆä¸éœ€è¦è¿ç»­ï¼‰çš„é›†åˆã€‚é€šè¿‡ Region çš„åŠ¨æ€åˆ†é…æ–¹å¼å®ç°é€»è¾‘ä¸Šçš„è¿ç»­ã€‚</p><p><img src=https://logan.1357810.xyz/img/20220422/153020741-54081704f5.png width=900 height=600 loading=lazy decoding=async alt=image-20200713223244886 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p>ä¸€ä¸ª region æœ‰å¯èƒ½å±äº Edenï¼ŒSurvivor æˆ–è€… Old/Tenured å†…å­˜åŒºåŸŸã€‚ä½†æ˜¯ä¸€ä¸ª region åªå¯èƒ½å±äºä¸€ä¸ªè§’è‰²ã€‚å›¾ä¸­çš„ E è¡¨ç¤ºè¯¥ region å±äº Eden å†…å­˜åŒºåŸŸï¼ŒS è¡¨ç¤ºå±äº survivor å†…å­˜åŒºåŸŸï¼ŒO è¡¨ç¤ºå±äº Old å†…å­˜åŒºåŸŸã€‚å›¾ä¸­ç©ºç™½çš„è¡¨ç¤ºæœªä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚</p><p>G1 åƒåœ¾æ”¶é›†å™¨è¿˜å¢åŠ äº†ä¸€ç§æ–°çš„å†…å­˜åŒºåŸŸï¼Œå«åš Humongous å†…å­˜åŒºåŸŸï¼Œå¦‚å›¾ä¸­çš„ H å—ã€‚ä¸»è¦ç”¨äºå­˜å‚¨å¤§å¯¹è±¡ï¼Œå¦‚æœè¶…è¿‡ 1.5 ä¸ª regionï¼Œå°±æ”¾åˆ° Hã€‚</p><p>è®¾ç½® H çš„åŸå› ï¼šå¯¹äºå †ä¸­çš„å¯¹è±¡ï¼Œé»˜è®¤ç›´æ¥ä¼šè¢«åˆ†é…åˆ°è€å¹´ä»£ï¼Œä½†æ˜¯å¦‚æœå®ƒæ˜¯ä¸€ä¸ªçŸ­æœŸå­˜åœ¨çš„å¤§å¯¹è±¡å°±ä¼šå¯¹åƒåœ¾æ”¶é›†å™¨é€ æˆè´Ÿé¢å½±å“ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒG1 åˆ’åˆ†äº†ä¸€ä¸ª Humongous åŒºï¼Œå®ƒç”¨æ¥ä¸“é—¨å­˜æ”¾å¤§å¯¹è±¡ã€‚<mark>å¦‚æœä¸€ä¸ª H åŒºè£…ä¸ä¸‹ä¸€ä¸ªå¤§å¯¹è±¡ï¼Œé‚£ä¹ˆ G1 ä¼šå¯»æ‰¾è¿ç»­çš„ H åŒºæ¥å­˜å‚¨ã€‚</mark>ä¸ºäº†èƒ½æ‰¾åˆ°è¿ç»­çš„ H åŒºï¼Œæœ‰æ—¶å€™ä¸å¾—ä¸å¯åŠ¨ Full GCã€‚G1 çš„å¤§å¤šæ•°è¡Œä¸ºéƒ½æŠŠ H åŒºä½œä¸ºè€å¹´ä»£çš„ä¸€éƒ¨åˆ†æ¥çœ‹å¾…ã€‚</p><p>æ¯ä¸ª Region éƒ½æ˜¯é€šè¿‡æŒ‡é’ˆç¢°æ’æ¥åˆ†é…ç©ºé—´</p><p><img src=https://logan.1357810.xyz/img/20220422/153020741-4e6708b64c.png width=900 height=600 loading=lazy decoding=async alt=image-20200713223509993 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><h3 id=1377-g1-åƒåœ¾å›æ”¶å™¨çš„å›æ”¶è¿‡ç¨‹><a href=#1377-g1-%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6%e5%99%a8%e7%9a%84%e5%9b%9e%e6%94%b6%e8%bf%87%e7%a8%8b class=header-anchor></a>13.7.7. G1 åƒåœ¾å›æ”¶å™¨çš„å›æ”¶è¿‡ç¨‹</h3><p><img src=https://logan.1357810.xyz/img/20220426/1650955647-3d45254267f3f1.png width=900 height=600 loading=lazy decoding=async alt=image-20220426144726900 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p><img src=https://logan.1357810.xyz/img/20220426/1650955730-6a22704e049a00.png width=900 height=600 loading=lazy decoding=async alt=image-20220426144849963 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p>G1GC çš„åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸»è¦åŒ…æ‹¬å¦‚ä¸‹ä¸‰ä¸ªç¯èŠ‚ï¼š</p><ul><li><p>å¹´è½»ä»£ GCï¼ˆYoung GCï¼‰</p></li><li><p>è€å¹´ä»£å¹¶å‘æ ‡è®°è¿‡ç¨‹ï¼ˆConcurrent Markingï¼‰</p></li><li><p>æ··åˆå›æ”¶ï¼ˆMixed GCï¼‰</p><p>ï¼ˆå¦‚æœéœ€è¦ï¼Œå•çº¿ç¨‹ã€ç‹¬å å¼ã€é«˜å¼ºåº¦çš„ Full GC è¿˜æ˜¯ç»§ç»­å­˜åœ¨çš„ã€‚å®ƒé’ˆå¯¹ GC çš„è¯„ä¼°å¤±è´¥æä¾›äº†ä¸€ç§å¤±è´¥ä¿æŠ¤æœºåˆ¶ï¼Œå³å¼ºåŠ›å›æ”¶ã€‚ï¼‰</p></li></ul><p><img src=https://logan.1357810.xyz/img/20220422/153020741-7c259547af.png width=900 height=600 loading=lazy decoding=async alt=image-20200713224113996 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p>é¡ºæ—¶é’ˆï¼ŒYoung gc -> Young gc + Concurrent mark->Mixed GC é¡ºåºï¼Œè¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p><p>åº”ç”¨ç¨‹åºåˆ†é…å†…å­˜ï¼Œ<mark>å½“å¹´è½»ä»£çš„ Eden åŒºç”¨å°½æ—¶å¼€å§‹å¹´è½»ä»£å›æ”¶è¿‡ç¨‹</mark>ï¼›G1 çš„å¹´è½»ä»£æ”¶é›†é˜¶æ®µæ˜¯ä¸€ä¸ª<mark>å¹¶è¡Œçš„ç‹¬å å¼</mark>æ”¶é›†å™¨ã€‚åœ¨å¹´è½»ä»£å›æ”¶æœŸï¼ŒG1GC æš‚åœæ‰€æœ‰åº”ç”¨ç¨‹åºçº¿ç¨‹ï¼Œå¯åŠ¨å¤šçº¿ç¨‹æ‰§è¡Œå¹´è½»ä»£å›æ”¶ã€‚ç„¶å<mark>ä»å¹´è½»ä»£åŒºé—´ç§»åŠ¨å­˜æ´»å¯¹è±¡åˆ° Survivor åŒºé—´æˆ–è€…è€å¹´åŒºé—´ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸¤ä¸ªåŒºé—´éƒ½ä¼šæ¶‰åŠ</mark>ã€‚</p><p>å½“å †å†…å­˜ä½¿ç”¨è¾¾åˆ°ä¸€å®šå€¼ï¼ˆé»˜è®¤ 45%ï¼‰æ—¶ï¼Œå¼€å§‹è€å¹´ä»£å¹¶å‘æ ‡è®°è¿‡ç¨‹ã€‚</p><p>æ ‡è®°å®Œæˆé©¬ä¸Šå¼€å§‹æ··åˆå›æ”¶è¿‡ç¨‹ã€‚å¯¹äºä¸€ä¸ªæ··åˆå›æ”¶æœŸï¼ŒG1 GC ä»è€å¹´åŒºé—´ç§»åŠ¨å­˜æ´»å¯¹è±¡åˆ°ç©ºé—²åŒºé—´ï¼Œè¿™äº›ç©ºé—²åŒºé—´ä¹Ÿå°±æˆä¸ºäº†è€å¹´ä»£çš„ä¸€éƒ¨åˆ†ã€‚å’Œå¹´è½»ä»£ä¸åŒï¼Œè€å¹´ä»£çš„ G1 å›æ”¶å™¨å’Œå…¶ä»– GC ä¸åŒï¼Œ<mark>G1 çš„è€å¹´ä»£å›æ”¶å™¨ä¸éœ€è¦æ•´ä¸ªè€å¹´ä»£è¢«å›æ”¶ï¼Œä¸€æ¬¡åªéœ€è¦æ‰«æ/å›æ”¶ä¸€å°éƒ¨åˆ†è€å¹´ä»£çš„ Region å°±å¯ä»¥äº†</mark>ã€‚åŒæ—¶ï¼Œè¿™ä¸ªè€å¹´ä»£ Region æ˜¯å’Œå¹´è½»ä»£ä¸€èµ·è¢«å›æ”¶çš„ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šä¸€ä¸ª Web æœåŠ¡å™¨ï¼ŒJava è¿›ç¨‹æœ€å¤§å †å†…å­˜ä¸º 4Gï¼Œæ¯åˆ†é’Ÿå“åº” 1500 ä¸ªè¯·æ±‚ï¼Œæ¯ 45 ç§’é’Ÿä¼šæ–°åˆ†é…å¤§çº¦ 2G çš„å†…å­˜ã€‚G1 ä¼šæ¯ 45 ç§’é’Ÿè¿›è¡Œä¸€æ¬¡å¹´è½»ä»£å›æ”¶ï¼Œæ¯ 31 ä¸ªå°æ—¶æ•´ä¸ªå †çš„ä½¿ç”¨ç‡ä¼šè¾¾åˆ° 45%ï¼Œä¼šå¼€å§‹è€å¹´ä»£å¹¶å‘æ ‡è®°è¿‡ç¨‹ï¼Œæ ‡è®°å®Œæˆåå¼€å§‹å››åˆ°äº”æ¬¡çš„æ··åˆå›æ”¶ã€‚</p><h3 id=1378-remembered-set><a href=#1378-remembered-set class=header-anchor></a>13.7.8. Remembered Set</h3><ul><li><p>ä¸€ä¸ªå¯¹è±¡è¢«ä¸åŒåŒºåŸŸå¼•ç”¨çš„é—®é¢˜</p></li><li><p>ä¸€ä¸ª Region ä¸å¯èƒ½æ˜¯å­¤ç«‹çš„ï¼Œä¸€ä¸ª Region ä¸­çš„å¯¹è±¡å¯èƒ½è¢«å…¶ä»–ä»»æ„ Region ä¸­å¯¹è±¡å¼•ç”¨ï¼Œåˆ¤æ–­å¯¹è±¡å­˜æ´»æ—¶ï¼Œæ˜¯å¦éœ€è¦æ‰«ææ•´ä¸ª Java å †æ‰èƒ½ä¿è¯å‡†ç¡®ï¼Ÿ</p></li><li><p>åœ¨å…¶ä»–çš„åˆ†ä»£æ”¶é›†å™¨ï¼Œä¹Ÿå­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼ˆè€Œ G1 æ›´çªå‡ºï¼‰å›æ”¶æ–°ç”Ÿä»£ä¹Ÿä¸å¾—ä¸åŒæ—¶æ‰«æè€å¹´ä»£ï¼Ÿ</p></li><li><p>è¿™æ ·çš„è¯ä¼šé™ä½ MinorGC çš„æ•ˆç‡ï¼›</p></li></ul><p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p><p>æ— è®º G1 è¿˜æ˜¯å…¶ä»–åˆ†ä»£æ”¶é›†å™¨ï¼ŒJVM éƒ½æ˜¯ä½¿ç”¨ Remembered Set æ¥é¿å…å…¨å±€æ‰«æï¼š</p><p><mark>æ¯ä¸ª Region éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ Remembered Setï¼›</mark></p><p>æ¯æ¬¡ Reference ç±»å‹æ•°æ®å†™æ“ä½œæ—¶ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ª Write Barrier æš‚æ—¶ä¸­æ–­æ“ä½œï¼›</p><p>ç„¶åæ£€æŸ¥å°†è¦å†™å…¥çš„å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡æ˜¯å¦å’Œè¯¥ Reference ç±»å‹æ•°æ®åœ¨ä¸åŒçš„ Regionï¼ˆå…¶ä»–æ”¶é›†å™¨ï¼šæ£€æŸ¥è€å¹´ä»£å¯¹è±¡æ˜¯å¦å¼•ç”¨äº†æ–°ç”Ÿä»£å¯¹è±¡ï¼‰ï¼›</p><p>å¦‚æœä¸åŒï¼Œé€šè¿‡ CardTable æŠŠç›¸å…³å¼•ç”¨ä¿¡æ¯è®°å½•åˆ°å¼•ç”¨æŒ‡å‘å¯¹è±¡çš„æ‰€åœ¨ Region å¯¹åº”çš„ Remembered Set ä¸­ï¼›</p><p>å½“è¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œåœ¨ GC æ ¹èŠ‚ç‚¹çš„æšä¸¾èŒƒå›´åŠ å…¥ Remembered Setï¼›å°±å¯ä»¥ä¿è¯ä¸è¿›è¡Œå…¨å±€æ‰«æï¼Œä¹Ÿä¸ä¼šæœ‰é—æ¼ã€‚</p><p><img src=https://logan.1357810.xyz/img/20220422/153020741-3af2bc87cd.png width=900 height=600 loading=lazy decoding=async alt=image-20200713224716715 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><h3 id=1379-g1-å›æ”¶è¿‡ç¨‹ä¸€å¹´è½»ä»£-gc><a href=#1379-g1-%e5%9b%9e%e6%94%b6%e8%bf%87%e7%a8%8b%e4%b8%80%e5%b9%b4%e8%bd%bb%e4%bb%a3-gc class=header-anchor></a>13.7.9. G1 å›æ”¶è¿‡ç¨‹ä¸€ï¼šå¹´è½»ä»£ GC</h3><p>JVM å¯åŠ¨æ—¶ï¼ŒG1 å…ˆå‡†å¤‡å¥½ Eden åŒºï¼Œç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¸æ–­åˆ›å»ºå¯¹è±¡åˆ° Eden åŒºï¼Œå½“ Eden ç©ºé—´è€—å°½æ—¶ï¼ŒG1 ä¼šå¯åŠ¨ä¸€æ¬¡å¹´è½»ä»£åƒåœ¾å›æ”¶è¿‡ç¨‹ã€‚</p><p>å¹´è½»ä»£åƒåœ¾å›æ”¶åªä¼šå›æ”¶ Eden åŒºå’Œ Survivor åŒºã€‚</p><p>é¦–å…ˆ G1 åœæ­¢åº”ç”¨ç¨‹åºçš„æ‰§è¡Œï¼ˆStop-The-Worldï¼‰ï¼ŒG1 åˆ›å»ºå›æ”¶é›†ï¼ˆCollection Setï¼‰ï¼Œå›æ”¶é›†æ˜¯æŒ‡éœ€è¦è¢«å›æ”¶çš„å†…å­˜åˆ†æ®µçš„é›†åˆï¼Œå¹´è½»ä»£å›æ”¶è¿‡ç¨‹çš„å›æ”¶é›†åŒ…å«å¹´è½»ä»£ Eden åŒºå’Œ Survivor åŒºæ‰€æœ‰çš„å†…å­˜åˆ†æ®µã€‚</p><p><img src=https://logan.1357810.xyz/img/20220422/153020741-1ec99a133b.png width=900 height=600 loading=lazy decoding=async alt=image-20200713225100632 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p>ç„¶åå¼€å§‹å¦‚ä¸‹å›æ”¶è¿‡ç¨‹ï¼š</p><ol><li><mark>ç¬¬ä¸€é˜¶æ®µï¼Œæ‰«ææ ¹</mark>ã€‚æ ¹æ˜¯æŒ‡ static å˜é‡æŒ‡å‘çš„å¯¹è±¡ï¼Œæ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•è°ƒç”¨é“¾æ¡ä¸Šçš„å±€éƒ¨å˜é‡ç­‰ã€‚æ ¹å¼•ç”¨è¿åŒ RSet è®°å½•çš„å¤–éƒ¨å¼•ç”¨ä½œä¸ºæ‰«æå­˜æ´»å¯¹è±¡çš„å…¥å£ã€‚</li><li><mark>ç¬¬äºŒé˜¶æ®µï¼Œæ›´æ–° RSet</mark>ã€‚å¤„ç† dirty card queueï¼ˆè§å¤‡æ³¨ï¼‰ä¸­çš„ cardï¼Œæ›´æ–° RSetã€‚æ­¤é˜¶æ®µå®Œæˆåï¼Œ<mark>RSet å¯ä»¥å‡†ç¡®çš„åæ˜ è€å¹´ä»£å¯¹æ‰€åœ¨çš„å†…å­˜åˆ†æ®µä¸­å¯¹è±¡çš„å¼•ç”¨</mark>ã€‚</li><li><mark>ç¬¬ä¸‰é˜¶æ®µï¼Œå¤„ç† RSet</mark>ã€‚è¯†åˆ«è¢«è€å¹´ä»£å¯¹è±¡æŒ‡å‘çš„ Eden ä¸­çš„å¯¹è±¡ï¼Œè¿™äº›è¢«æŒ‡å‘çš„ Eden ä¸­çš„å¯¹è±¡è¢«è®¤ä¸ºæ˜¯å­˜æ´»çš„å¯¹è±¡ã€‚</li><li><mark>ç¬¬å››é˜¶æ®µï¼Œå¤åˆ¶å¯¹è±¡</mark>ã€‚æ­¤é˜¶æ®µï¼Œå¯¹è±¡æ ‘è¢«éå†ï¼ŒEden åŒºå†…å­˜æ®µä¸­å­˜æ´»çš„å¯¹è±¡ä¼šè¢«å¤åˆ¶åˆ° Survivor åŒºä¸­ç©ºçš„å†…å­˜åˆ†æ®µï¼ŒSurvivor åŒºå†…å­˜æ®µä¸­å­˜æ´»çš„å¯¹è±¡å¦‚æœå¹´é¾„æœªè¾¾é˜ˆå€¼ï¼Œå¹´é¾„ä¼šåŠ  1ï¼Œè¾¾åˆ°é˜€å€¼ä¼šè¢«ä¼šè¢«å¤åˆ¶åˆ° Old åŒºä¸­ç©ºçš„å†…å­˜åˆ†æ®µã€‚å¦‚æœ Survivor ç©ºé—´ä¸å¤Ÿï¼ŒEden ç©ºé—´çš„éƒ¨åˆ†æ•°æ®ä¼šç›´æ¥æ™‹å‡åˆ°è€å¹´ä»£ç©ºé—´ã€‚</li><li><mark>ç¬¬äº”é˜¶æ®µï¼Œå¤„ç†å¼•ç”¨</mark>ã€‚å¤„ç† Softï¼ŒWeakï¼ŒPhantomï¼ŒFinalï¼ŒJNI Weak ç­‰å¼•ç”¨ã€‚æœ€ç»ˆ Eden ç©ºé—´çš„æ•°æ®ä¸ºç©ºï¼ŒGC åœæ­¢å·¥ä½œï¼Œè€Œç›®æ ‡å†…å­˜ä¸­çš„å¯¹è±¡éƒ½æ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œæ²¡æœ‰ç¢ç‰‡ï¼Œæ‰€ä»¥å¤åˆ¶è¿‡ç¨‹å¯ä»¥è¾¾åˆ°å†…å­˜æ•´ç†çš„æ•ˆæœï¼Œå‡å°‘ç¢ç‰‡ã€‚</li></ol><h3 id=13710-g1-å›æ”¶è¿‡ç¨‹äºŒå¹¶å‘æ ‡è®°è¿‡ç¨‹><a href=#13710-g1-%e5%9b%9e%e6%94%b6%e8%bf%87%e7%a8%8b%e4%ba%8c%e5%b9%b6%e5%8f%91%e6%a0%87%e8%ae%b0%e8%bf%87%e7%a8%8b class=header-anchor></a>13.7.10. G1 å›æ”¶è¿‡ç¨‹äºŒï¼šå¹¶å‘æ ‡è®°è¿‡ç¨‹</h3><ol><li><mark>åˆå§‹æ ‡è®°é˜¶æ®µ</mark>ï¼šæ ‡è®°ä»æ ¹èŠ‚ç‚¹ç›´æ¥å¯è¾¾çš„å¯¹è±¡ã€‚è¿™ä¸ªé˜¶æ®µæ˜¯ STW çš„ï¼Œå¹¶ä¸”ä¼šè§¦å‘ä¸€æ¬¡å¹´è½»ä»£ GCã€‚</li><li><mark>æ ¹åŒºåŸŸæ‰«æï¼ˆRoot Region Scanningï¼‰</mark>ï¼šG1 GC æ‰«æ Survivor åŒºç›´æ¥å¯è¾¾çš„è€å¹´ä»£åŒºåŸŸå¯¹è±¡ï¼Œå¹¶æ ‡è®°è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚è¿™ä¸€è¿‡ç¨‹å¿…é¡»åœ¨ YoungGC ä¹‹å‰å®Œæˆã€‚</li><li><mark>å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markingï¼‰</mark>ï¼šåœ¨æ•´ä¸ªå †ä¸­è¿›è¡Œå¹¶å‘æ ‡è®°ï¼ˆå’Œåº”ç”¨ç¨‹åºå¹¶å‘æ‰§è¡Œï¼‰ï¼Œæ­¤è¿‡ç¨‹å¯èƒ½è¢« YoungGC ä¸­æ–­ã€‚åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µï¼Œ<mark>è‹¥å‘ç°åŒºåŸŸå¯¹è±¡ä¸­çš„æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯åƒåœ¾ï¼Œé‚£è¿™ä¸ªåŒºåŸŸä¼šè¢«ç«‹å³å›æ”¶</mark>ã€‚åŒæ—¶ï¼Œå¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œä¼šè®¡ç®—æ¯ä¸ªåŒºåŸŸçš„å¯¹è±¡æ´»æ€§ï¼ˆåŒºåŸŸä¸­å­˜æ´»å¯¹è±¡çš„æ¯”ä¾‹ï¼‰ã€‚</li><li><mark>å†æ¬¡æ ‡è®°ï¼ˆRemarkï¼‰</mark>ï¼šç”±äºåº”ç”¨ç¨‹åºæŒç»­è¿›è¡Œï¼Œéœ€è¦ä¿®æ­£ä¸Šä¸€æ¬¡çš„æ ‡è®°ç»“æœã€‚æ˜¯ STW çš„ã€‚G1 ä¸­é‡‡ç”¨äº†æ¯” CMS æ›´å¿«çš„åˆå§‹å¿«ç…§ç®—æ³•ï¼šsnapshot-at-the-beginningï¼ˆSATBï¼‰ã€‚</li><li><mark>ç‹¬å æ¸…ç†ï¼ˆcleanupï¼ŒSTWï¼‰</mark>ï¼šè®¡ç®—å„ä¸ªåŒºåŸŸçš„å­˜æ´»å¯¹è±¡å’Œ GC å›æ”¶æ¯”ä¾‹ï¼Œå¹¶è¿›è¡Œæ’åºï¼Œè¯†åˆ«å¯ä»¥æ··åˆå›æ”¶çš„åŒºåŸŸã€‚ä¸ºä¸‹é˜¶æ®µåšé“ºå«ã€‚æ˜¯ STW çš„ã€‚è¿™ä¸ªé˜¶æ®µå¹¶ä¸ä¼šå®é™…ä¸Šå»åšåƒåœ¾çš„æ”¶é›†</li><li><mark>å¹¶å‘æ¸…ç†é˜¶æ®µ</mark>ï¼šè¯†åˆ«å¹¶æ¸…ç†å®Œå…¨ç©ºé—²çš„åŒºåŸŸã€‚</li></ol><h3 id=13711-g1-å›æ”¶è¿‡ç¨‹ä¸‰æ··åˆå›æ”¶><a href=#13711-g1-%e5%9b%9e%e6%94%b6%e8%bf%87%e7%a8%8b%e4%b8%89%e6%b7%b7%e5%90%88%e5%9b%9e%e6%94%b6 class=header-anchor></a>13.7.11. G1 å›æ”¶è¿‡ç¨‹ä¸‰ï¼šæ··åˆå›æ”¶</h3><p>å½“è¶Šæ¥è¶Šå¤šçš„å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£ o1d region æ—¶ï¼Œä¸ºäº†é¿å…å †å†…å­˜è¢«è€—å°½ï¼Œè™šæ‹Ÿæœºä¼šè§¦å‘ä¸€ä¸ªæ··åˆçš„åƒåœ¾æ”¶é›†å™¨ï¼Œå³ Mixed GCï¼Œè¯¥ç®—æ³•å¹¶ä¸æ˜¯ä¸€ä¸ª Old GCï¼Œé™¤äº†å›æ”¶æ•´ä¸ª Young Regionï¼Œè¿˜ä¼šå›æ”¶ä¸€éƒ¨åˆ†çš„ Old Regionã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼š<mark>æ˜¯ä¸€éƒ¨åˆ†è€å¹´ä»£ï¼Œè€Œä¸æ˜¯å…¨éƒ¨è€å¹´ä»£</mark>ã€‚å¯ä»¥é€‰æ‹©å“ªäº› Old Region è¿›è¡Œæ”¶é›†ï¼Œä»è€Œå¯ä»¥å¯¹åƒåœ¾å›æ”¶çš„è€—æ—¶æ—¶é—´è¿›è¡Œæ§åˆ¶ã€‚ä¹Ÿè¦æ³¨æ„çš„æ˜¯ Mixed GC å¹¶ä¸æ˜¯ Full GCã€‚</p><p><img src=https://logan.1357810.xyz/img/20220422/153020741-1a30560c40.png width=900 height=600 loading=lazy decoding=async alt=image-20200713225810871 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p>å¹¶å‘æ ‡è®°ç»“æŸä»¥åï¼Œè€å¹´ä»£ä¸­ç™¾åˆ†ç™¾ä¸ºåƒåœ¾çš„å†…å­˜åˆ†æ®µè¢«å›æ”¶äº†ï¼Œéƒ¨åˆ†ä¸ºåƒåœ¾çš„å†…å­˜åˆ†æ®µè¢«è®¡ç®—äº†å‡ºæ¥ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›è€å¹´ä»£çš„å†…å­˜åˆ†æ®µä¼šåˆ† 8 æ¬¡ï¼ˆå¯ä»¥é€šè¿‡<code>-XX:G1MixedGCCountTarget</code>è®¾ç½®ï¼‰è¢«å›æ”¶</p><p>æ··åˆå›æ”¶çš„å›æ”¶é›†ï¼ˆCollection Setï¼‰åŒ…æ‹¬å…«åˆ†ä¹‹ä¸€çš„è€å¹´ä»£å†…å­˜åˆ†æ®µï¼ŒEden åŒºå†…å­˜åˆ†æ®µï¼ŒSurvivor åŒºå†…å­˜åˆ†æ®µã€‚æ··åˆå›æ”¶çš„ç®—æ³•å’Œå¹´è½»ä»£å›æ”¶çš„ç®—æ³•å®Œå…¨ä¸€æ ·ï¼Œåªæ˜¯å›æ”¶é›†å¤šäº†è€å¹´ä»£çš„å†…å­˜åˆ†æ®µã€‚å…·ä½“è¿‡ç¨‹è¯·å‚è€ƒä¸Šé¢çš„å¹´è½»ä»£å›æ”¶è¿‡ç¨‹ã€‚</p><p>ç”±äºè€å¹´ä»£ä¸­çš„å†…å­˜åˆ†æ®µé»˜è®¤åˆ† 8 æ¬¡å›æ”¶ï¼ŒG1 ä¼šä¼˜å…ˆå›æ”¶åƒåœ¾å¤šçš„å†…å­˜åˆ†æ®µã€‚åƒåœ¾å å†…å­˜åˆ†æ®µæ¯”ä¾‹è¶Šé«˜çš„ï¼Œè¶Šä¼šè¢«å…ˆå›æ”¶ã€‚å¹¶ä¸”æœ‰ä¸€ä¸ªé˜ˆå€¼ä¼šå†³å®šå†…å­˜åˆ†æ®µæ˜¯å¦è¢«å›æ”¶ï¼Œ<code>-XX:G1MixedGCLiveThresholdPercent</code>ï¼Œé»˜è®¤ä¸º 65%ï¼Œæ„æ€æ˜¯åƒåœ¾å å†…å­˜åˆ†æ®µæ¯”ä¾‹è¦è¾¾åˆ° 65%æ‰ä¼šè¢«å›æ”¶ã€‚å¦‚æœåƒåœ¾å æ¯”å¤ªä½ï¼Œæ„å‘³ç€å­˜æ´»çš„å¯¹è±¡å æ¯”é«˜ï¼Œåœ¨å¤åˆ¶çš„æ—¶å€™ä¼šèŠ±è´¹æ›´å¤šçš„æ—¶é—´ã€‚</p><p>æ··åˆå›æ”¶å¹¶ä¸ä¸€å®šè¦è¿›è¡Œ 8 æ¬¡ã€‚æœ‰ä¸€ä¸ªé˜ˆå€¼<code>-XX:G1HeapWastePercent</code>ï¼Œé»˜è®¤å€¼ä¸º 10%ï¼Œæ„æ€æ˜¯å…è®¸æ•´ä¸ªå †å†…å­˜ä¸­æœ‰ 10%çš„ç©ºé—´è¢«æµªè´¹ï¼Œæ„å‘³ç€å¦‚æœå‘ç°å¯ä»¥å›æ”¶çš„åƒåœ¾å å †å†…å­˜çš„æ¯”ä¾‹ä½äº 10%ï¼Œåˆ™ä¸å†è¿›è¡Œæ··åˆå›æ”¶ã€‚å› ä¸º GC ä¼šèŠ±è´¹å¾ˆå¤šçš„æ—¶é—´ä½†æ˜¯å›æ”¶åˆ°çš„å†…å­˜å´å¾ˆå°‘ã€‚</p><h3 id=13712-g1-å›æ”¶å¯é€‰çš„è¿‡ç¨‹å››full-gc><a href=#13712-g1-%e5%9b%9e%e6%94%b6%e5%8f%af%e9%80%89%e7%9a%84%e8%bf%87%e7%a8%8b%e5%9b%9bfull-gc class=header-anchor></a>13.7.12. G1 å›æ”¶å¯é€‰çš„è¿‡ç¨‹å››ï¼šFull GC</h3><p>G1 çš„åˆè¡·å°±æ˜¯è¦é¿å… Full GC çš„å‡ºç°ã€‚ä½†æ˜¯å¦‚æœä¸Šè¿°æ–¹å¼ä¸èƒ½æ­£å¸¸å·¥ä½œï¼ŒG1 ä¼šåœæ­¢åº”ç”¨ç¨‹åºçš„æ‰§è¡Œï¼ˆStop-The-Worldï¼‰ï¼Œä½¿ç”¨å•çº¿ç¨‹çš„å†…å­˜å›æ”¶ç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œæ€§èƒ½ä¼šéå¸¸å·®ï¼Œåº”ç”¨ç¨‹åºåœé¡¿æ—¶é—´ä¼šå¾ˆé•¿ã€‚</p><p>è¦é¿å… Full GC çš„å‘ç”Ÿï¼Œä¸€æ—¦å‘ç”Ÿéœ€è¦è¿›è¡Œè°ƒæ•´ã€‚ä»€ä¹ˆæ—¶å€™ä¼šå‘ç”Ÿ Full GC å‘¢ï¼Ÿæ¯”å¦‚<mark>å †å†…å­˜å¤ªå°</mark>ï¼Œå½“ G1 åœ¨å¤åˆ¶å­˜æ´»å¯¹è±¡çš„æ—¶å€™æ²¡æœ‰ç©ºçš„å†…å­˜åˆ†æ®µå¯ç”¨ï¼Œåˆ™ä¼šå›é€€åˆ° Full GCï¼Œè¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡å¢å¤§å†…å­˜è§£å†³ã€‚</p><p>å¯¼è‡´ G1 Full GC çš„åŸå› å¯èƒ½æœ‰ä¸¤ä¸ªï¼š</p><ul><li>Evacuation çš„æ—¶å€™æ²¡æœ‰è¶³å¤Ÿçš„ to-space æ¥å­˜æ”¾æ™‹å‡çš„å¯¹è±¡ï¼›</li><li>å¹¶å‘å¤„ç†è¿‡ç¨‹å®Œæˆä¹‹å‰ç©ºé—´è€—å°½ã€‚</li></ul><h3 id=13713-è¡¥å……><a href=#13713-%e8%a1%a5%e5%85%85 class=header-anchor></a>13.7.13. è¡¥å……</h3><p>ä» Oracle å®˜æ–¹é€éœ²å‡ºæ¥çš„ä¿¡æ¯å¯è·çŸ¥ï¼Œå›æ”¶é˜¶æ®µï¼ˆEvacuationï¼‰å…¶å®æœ¬ä¹Ÿæœ‰æƒ³è¿‡è®¾è®¡æˆä¸ç”¨æˆ·ç¨‹åºä¸€èµ·å¹¶å‘æ‰§è¡Œï¼Œä½†è¿™ä»¶äº‹æƒ…åšèµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œè€ƒè™‘åˆ° G1 åªæ˜¯å›ä¸€éƒ¨åˆ† Regionï¼Œåœé¡¿æ—¶é—´æ˜¯ç”¨æˆ·å¯æ§åˆ¶çš„ï¼Œæ‰€ä»¥å¹¶ä¸è¿«åˆ‡å»å®ç°ï¼Œè€Œ<mark>é€‰æ‹©æŠŠè¿™ä¸ªç‰¹æ€§æ”¾åˆ°äº† G1 ä¹‹åå‡ºç°çš„ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ï¼ˆå³ ZGCï¼‰ä¸­</mark>ã€‚å¦å¤–ï¼Œè¿˜è€ƒè™‘åˆ° G1 ä¸æ˜¯ä»…ä»…é¢å‘ä½å»¶è¿Ÿï¼Œåœé¡¿ç”¨æˆ·çº¿ç¨‹èƒ½å¤Ÿæœ€å¤§å¹…åº¦æé«˜åƒåœ¾æ”¶é›†æ•ˆç‡ï¼Œä¸ºäº†ä¿è¯ååé‡æ‰€ä»¥æ‰é€‰æ‹©äº†å®Œå…¨æš‚åœç”¨æˆ·çº¿ç¨‹çš„å®ç°æ–¹æ¡ˆã€‚</p><h3 id=13714-g1-å›æ”¶å™¨ä¼˜åŒ–å»ºè®®><a href=#13714-g1-%e5%9b%9e%e6%94%b6%e5%99%a8%e4%bc%98%e5%8c%96%e5%bb%ba%e8%ae%ae class=header-anchor></a>13.7.14. G1 å›æ”¶å™¨ä¼˜åŒ–å»ºè®®</h3><p>å¹´è½»ä»£å¤§å°</p><ul><li>é¿å…ä½¿ç”¨<code>-Xmn</code>æˆ–<code>-XX:NewRatio</code>ç­‰ç›¸å…³é€‰é¡¹æ˜¾å¼è®¾ç½®å¹´è½»ä»£å¤§å°</li><li>å›ºå®šå¹´è½»ä»£çš„å¤§å°ä¼šè¦†ç›–æš‚åœæ—¶é—´ç›®æ ‡</li></ul><p>æš‚åœæ—¶é—´ç›®æ ‡ä¸è¦å¤ªè¿‡ä¸¥è‹›</p><ul><li>G1 GC çš„ååé‡ç›®æ ‡æ˜¯ 90%çš„åº”ç”¨ç¨‹åºæ—¶é—´å’Œ 10%çš„åƒåœ¾å›æ”¶æ—¶é—´</li><li>è¯„ä¼° G1 GC çš„ååé‡æ—¶ï¼Œæš‚åœæ—¶é—´ç›®æ ‡ä¸è¦å¤ªä¸¥è‹›ã€‚ç›®æ ‡å¤ªè¿‡ä¸¥è‹›è¡¨ç¤ºä½ æ„¿æ„æ‰¿å—æ›´å¤šçš„åƒåœ¾å›æ”¶å¼€é”€ï¼Œè€Œè¿™äº›ä¼šç›´æ¥å½±å“åˆ°ååé‡ã€‚</li></ul><h2 id=138-åƒåœ¾å›æ”¶å™¨æ€»ç»“><a href=#138-%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6%e5%99%a8%e6%80%bb%e7%bb%93 class=header-anchor></a>13.8. åƒåœ¾å›æ”¶å™¨æ€»ç»“</h2><h3 id=1381-7-ç§ç»å…¸åƒåœ¾å›æ”¶å™¨æ€»ç»“><a href=#1381-7-%e7%a7%8d%e7%bb%8f%e5%85%b8%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6%e5%99%a8%e6%80%bb%e7%bb%93 class=header-anchor></a>13.8.1. 7 ç§ç»å…¸åƒåœ¾å›æ”¶å™¨æ€»ç»“</h3><p>æˆªæ­¢ JDK1.8ï¼Œä¸€å…±æœ‰ 7 æ¬¾ä¸åŒçš„åƒåœ¾æ”¶é›†å™¨ã€‚æ¯ä¸€æ¬¾çš„åƒåœ¾æ”¶é›†å™¨éƒ½æœ‰ä¸åŒçš„ç‰¹ç‚¹ï¼Œåœ¨å…·ä½“ä½¿ç”¨çš„æ—¶å€™ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„æƒ…å†µé€‰ç”¨ä¸åŒçš„åƒåœ¾æ”¶é›†å™¨ã€‚</p><div class=table-wrapper><table><thead><tr><th style=text-align:left>åƒåœ¾æ”¶é›†å™¨</th><th style=text-align:left>åˆ†ç±»</th><th style=text-align:left>ä½œç”¨ä½ç½®</th><th style=text-align:left>ä½¿ç”¨ç®—æ³•</th><th style=text-align:left>ç‰¹ç‚¹</th><th style=text-align:left>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td style=text-align:left>Serial</td><td style=text-align:left>ä¸²è¡Œè¿è¡Œ</td><td style=text-align:left>ä½œç”¨äºæ–°ç”Ÿä»£</td><td style=text-align:left>å¤åˆ¶ç®—æ³•</td><td style=text-align:left>å“åº”é€Ÿåº¦ä¼˜å…ˆ</td><td style=text-align:left>é€‚ç”¨äºå• CPU ç¯å¢ƒä¸‹çš„ client æ¨¡å¼</td></tr><tr><td style=text-align:left>ParNew</td><td style=text-align:left>å¹¶è¡Œè¿è¡Œ</td><td style=text-align:left>ä½œç”¨äºæ–°ç”Ÿä»£</td><td style=text-align:left>å¤åˆ¶ç®—æ³•</td><td style=text-align:left>å“åº”é€Ÿåº¦ä¼˜å…ˆ</td><td style=text-align:left>å¤š CPU ç¯å¢ƒ Server æ¨¡å¼ä¸‹ä¸ CMS é…åˆä½¿ç”¨</td></tr><tr><td style=text-align:left>Parallel</td><td style=text-align:left>å¹¶è¡Œè¿è¡Œ</td><td style=text-align:left>ä½œç”¨äºæ–°ç”Ÿä»£</td><td style=text-align:left>å¤åˆ¶ç®—æ³•</td><td style=text-align:left>ååé‡ä¼˜å…ˆ</td><td style=text-align:left>é€‚ç”¨äºåå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„åœºæ™¯</td></tr><tr><td style=text-align:left>Serial Old</td><td style=text-align:left>ä¸²è¡Œè¿è¡Œ</td><td style=text-align:left>ä½œç”¨äºè€å¹´ä»£</td><td style=text-align:left>æ ‡è®°-å‹ç¼©ç®—æ³•</td><td style=text-align:left>å“åº”é€Ÿåº¦ä¼˜å…ˆ</td><td style=text-align:left>é€‚ç”¨äºå• CPU ç¯å¢ƒä¸‹çš„ Client æ¨¡å¼</td></tr><tr><td style=text-align:left>Parallel Old</td><td style=text-align:left>å¹¶è¡Œè¿è¡Œ</td><td style=text-align:left>ä½œç”¨äºè€å¹´ä»£</td><td style=text-align:left>æ ‡è®°-å‹ç¼©ç®—æ³•</td><td style=text-align:left>ååé‡ä¼˜å…ˆ</td><td style=text-align:left>é€‚ç”¨äºåå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„åœºæ™¯</td></tr><tr><td style=text-align:left>CMS</td><td style=text-align:left>å¹¶å‘è¿è¡Œ</td><td style=text-align:left>ä½œç”¨äºè€å¹´ä»£</td><td style=text-align:left>æ ‡è®°-æ¸…é™¤ç®—æ³•</td><td style=text-align:left>å“åº”é€Ÿåº¦ä¼˜å…ˆ</td><td style=text-align:left>é€‚ç”¨äºäº’è”ç½‘æˆ– Bï¼S ä¸šåŠ¡</td></tr><tr><td style=text-align:left>G1</td><td style=text-align:left>å¹¶å‘ã€å¹¶è¡Œè¿è¡Œ</td><td style=text-align:left>ä½œç”¨äºæ–°ç”Ÿä»£ã€è€å¹´ä»£</td><td style=text-align:left>æ ‡è®°-å‹ç¼©ç®—æ³•ã€å¤åˆ¶ç®—æ³•</td><td style=text-align:left>å“åº”é€Ÿåº¦ä¼˜å…ˆ</td><td style=text-align:left>é¢å‘æœåŠ¡ç«¯åº”ç”¨</td></tr></tbody></table></div><p>GC å‘å±•é˜¶æ®µï¼šSerial => Parallelï¼ˆå¹¶è¡Œï¼‰=> CMSï¼ˆå¹¶å‘ï¼‰=> G1 => ZGC</p><h3 id=1382-åƒåœ¾å›æ”¶å™¨ç»„åˆ><a href=#1382-%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6%e5%99%a8%e7%bb%84%e5%90%88 class=header-anchor></a>13.8.2. åƒåœ¾å›æ”¶å™¨ç»„åˆ</h3><p>ä¸åŒå‚å•†ã€ä¸åŒç‰ˆæœ¬çš„è™šæ‹Ÿæœºå®ç°å·®è·æ¯”è¾ƒå¤§ã€‚HotSpot è™šæ‹Ÿæœºåœ¨ JDK7/8 åæ‰€æœ‰æ”¶é›†å™¨åŠç»„åˆå¦‚ä¸‹å›¾</p><p><img src=https://logan.1357810.xyz/img/20220422/153020741-ae115b87cb.png width=900 height=600 loading=lazy decoding=async alt=image-20200714080151020 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><ol><li><p>ä¸¤ä¸ªæ”¶é›†å™¨é—´æœ‰è¿çº¿ï¼Œè¡¨æ˜å®ƒä»¬å¯ä»¥æ­é…ä½¿ç”¨ï¼šSerial/Serial Oldã€Serial/CMSã€ParNew/Serial Oldã€ParNew/CMSã€Parallel Scavenge/Serial Oldã€Parallel Scavenge/Parallel Oldã€G1;</p></li><li><p>å…¶ä¸­ Serial Old ä½œä¸º CMS å‡ºç°ï¼‚<code>Concurrent Mode Failure</code>ï¼‚å¤±è´¥çš„åå¤‡é¢„æ¡ˆã€‚</p></li><li><p>ï¼ˆçº¢è‰²è™šçº¿ï¼‰ç”±äºç»´æŠ¤å’Œå…¼å®¹æ€§æµ‹è¯•çš„æˆæœ¬ï¼Œåœ¨ JDK 8 æ—¶å°† Serial ï¼‹ CMSã€ParNew ï¼‹ Serial old è¿™ä¸¤ä¸ªç»„åˆå£°æ˜ä¸º Deprecatedï¼ˆJEP 173ï¼‰ï¼Œå¹¶åœ¨ JDK 9 ä¸­</p></li></ol><p>å®Œå…¨å–æ¶ˆäº†è¿™äº›ç»„åˆçš„æ”¯æŒï¼ˆJEP214ï¼‰ï¼Œå³ï¼šç§»é™¤ã€‚</p><ol start=4><li><p>ï¼ˆç»¿è‰²è™šçº¿ï¼‰JDK 14 ä¸­ï¼šå¼ƒç”¨ ParallelScavenge å’Œ SeriaOold GC ç»„åˆ(JEP 366)</p></li><li><p>ï¼ˆç»¿è‰²è™šæ¡†ï¼‰JDK 14 ä¸­ï¼šåˆ é™¤ CMS åƒåœ¾å›æ”¶å™¨ï¼ˆJEP 363ï¼‰</p></li></ol><h3 id=1383-æ€ä¹ˆé€‰æ‹©åƒåœ¾å›æ”¶å™¨><a href=#1383-%e6%80%8e%e4%b9%88%e9%80%89%e6%8b%a9%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6%e5%99%a8 class=header-anchor></a>13.8.3. æ€ä¹ˆé€‰æ‹©åƒåœ¾å›æ”¶å™¨</h3><p>å†…å­˜è§’åº¦ï¼š4Gä»¥ä¸‹å¯ä»¥ç”¨parallelï¼Œ4-8Gå¯ä»¥ç”¨parNew+CMSï¼Œ8Gä»¥ä¸Šå¯ä»¥ç”¨G1ï¼Œå‡ ç™¾Gä»¥ä¸Šå¯ä»¥ç”¨ZGC</p><ul><li>ä¸šåŠ¡åº”ç”¨å¯¹ååé‡è¦æ±‚è¾ƒé«˜ï¼Œå¯¹å“åº”æ—¶é—´æ²¡æœ‰ç‰¹åˆ«è¦æ±‚çš„ï¼Œæ¨èä½¿ç”¨å¹¶è¡Œæ”¶é›†å™¨ã€‚å¦‚ï¼šç§‘å­¦è®¡ç®—å’Œåå°å¤„ç†ç¨‹åºç­‰ç­‰ã€‚</li><li>å¯¹å“åº”æ—¶é—´è¦æ±‚è¾ƒé«˜çš„ä¸­å¤§å‹åº”ç”¨ç¨‹åºï¼Œæ¨èä½¿ç”¨å¹¶å‘æ”¶é›†å™¨ã€‚å¦‚ï¼šwebæœåŠ¡å™¨ç­‰ã€‚</li><li>å¯¹åº”JDKç‰ˆæœ¬1.8ä»¥ä¸Šï¼Œå¤šCPUå¤„ç†å™¨ä¸”å†…å­˜èµ„æºä¸æ˜¯ç“¶é¢ˆï¼Œå»ºè®®ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨G1å›æ”¶å™¨ã€‚</li><li>å•çº¿ç¨‹åº”ç”¨ä½¿ç”¨ä¸²è¡Œæ”¶é›†å™¨ã€‚</li></ul><p>å †å†…å­˜ï¼š</p><ol><li>åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ï¼Œè®¡ç®—è€å¹´ä»£å­˜æ´»å¯¹è±¡çš„å ç”¨ç©ºé—´å¤§å°Xã€‚ç¨‹åºæ•´ä¸ªå †å¤§å°ï¼ˆXmxå’ŒXmsï¼‰è®¾ç½®ä¸ºXçš„3~4å€ï¼›æ°¸ä¹…ä»£PermSizeå’ŒMaxPermSizeè®¾ç½®ä¸ºXçš„1.2~1.5å€ã€‚å¹´è½»ä»£Xmnçš„è®¾ç½®ä¸ºXçš„1~1.5å€ã€‚è€å¹´ä»£å†…å­˜å¤§å°è®¾ç½®ä¸ºXçš„2~3å€ã€‚</li><li>JDKå®˜æ–¹å»ºè®®å¹´è½»ä»£å æ•´ä¸ªå †å¤§å°ç©ºé—´çš„3/8å·¦å³ã€‚</li><li>å®Œæˆä¸€æ¬¡Full GCåï¼Œåº”è¯¥é‡Šæ”¾å‡º70%çš„å †ç©ºé—´ï¼ˆ30%çš„ç©ºé—´ä»ç„¶å ç”¨ï¼‰ã€‚</li><li>å¹¶å‘é‡æ¯”è¾ƒå¤§çš„æƒ…å†µåº”å½“é€‚é‡å¢å¤§å¹´è½»ä»£çš„ç©ºé—´</li></ol><p>Java åƒåœ¾æ”¶é›†å™¨çš„é…ç½®å¯¹äº JVM ä¼˜åŒ–æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„é€‰æ‹©ï¼Œé€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†å™¨å¯ä»¥è®© JVM çš„æ€§èƒ½æœ‰ä¸€ä¸ªå¾ˆå¤§çš„æå‡ã€‚</p><p>æ€ä¹ˆé€‰æ‹©åƒåœ¾æ”¶é›†å™¨ï¼Ÿ</p><ol><li><p>ä¼˜å…ˆè°ƒæ•´å †çš„å¤§å°è®© JVM è‡ªé€‚åº”å®Œæˆã€‚</p></li><li><p>å¦‚æœå†…å­˜å°äº 100Mï¼Œä½¿ç”¨ä¸²è¡Œæ”¶é›†å™¨</p></li><li><p>å¦‚æœæ˜¯å•æ ¸ã€å•æœºç¨‹åºï¼Œå¹¶ä¸”æ²¡æœ‰åœé¡¿æ—¶é—´çš„è¦æ±‚ï¼Œä¸²è¡Œæ”¶é›†å™¨</p></li><li><p>å¦‚æœæ˜¯å¤š CPUã€éœ€è¦é«˜ååé‡ã€å…è®¸åœé¡¿æ—¶é—´è¶…è¿‡ 1 ç§’ï¼Œé€‰æ‹©å¹¶è¡Œæˆ–è€… JVM è‡ªå·±é€‰æ‹©</p></li><li><p>å¦‚æœæ˜¯å¤š CPUã€è¿½æ±‚ä½åœé¡¿æ—¶é—´ï¼Œéœ€å¿«é€Ÿå“åº”ï¼ˆæ¯”å¦‚å»¶è¿Ÿä¸èƒ½è¶…è¿‡ 1 ç§’ï¼Œå¦‚äº’è”ç½‘åº”ç”¨ï¼‰ï¼Œä½¿ç”¨å¹¶å‘æ”¶é›†å™¨</p><p>å®˜æ–¹æ¨è G1ï¼Œæ€§èƒ½é«˜ã€‚<mark>ç°åœ¨äº’è”ç½‘çš„é¡¹ç›®ï¼ŒåŸºæœ¬éƒ½æ˜¯ä½¿ç”¨ G1</mark>ã€‚</p></li></ol><p>æœ€åéœ€è¦æ˜ç¡®ä¸€ä¸ªè§‚ç‚¹ï¼š</p><ol><li>æ²¡æœ‰æœ€å¥½çš„æ”¶é›†å™¨ï¼Œæ›´æ²¡æœ‰ä¸‡èƒ½çš„æ”¶é›†</li><li>è°ƒä¼˜æ°¸è¿œæ˜¯é’ˆå¯¹ç‰¹å®šåœºæ™¯ã€ç‰¹å®šéœ€æ±‚ï¼Œä¸å­˜åœ¨ä¸€åŠ³æ°¸é€¸çš„æ”¶é›†å™¨</li></ol><p><strong>é¢è¯•</strong></p><p>å¯¹äºåƒåœ¾æ”¶é›†ï¼Œé¢è¯•å®˜å¯ä»¥å¾ªåºæ¸è¿›ä»ç†è®ºã€å®è·µå„ç§è§’åº¦æ·±å…¥ï¼Œä¹Ÿæœªå¿…æ˜¯è¦æ±‚é¢è¯•è€…ä»€ä¹ˆéƒ½æ‡‚ã€‚ä½†å¦‚æœä½ æ‡‚å¾—åŸç†ï¼Œä¸€å®šä¼šæˆä¸ºé¢è¯•ä¸­çš„åŠ åˆ†é¡¹ã€‚ è¿™é‡Œè¾ƒé€šç”¨ã€åŸºç¡€æ€§çš„éƒ¨åˆ†å¦‚ä¸‹ï¼š</p><ul><li><p>åƒåœ¾æ”¶é›†çš„ç®—æ³•æœ‰å“ªäº›ï¼Ÿå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯ä»¥å›æ”¶ï¼Ÿ</p></li><li><p>åƒåœ¾æ”¶é›†å™¨å·¥ä½œçš„åŸºæœ¬æµç¨‹ã€‚</p></li></ul><p>å¦å¤–ï¼Œå¤§å®¶éœ€è¦å¤šå…³æ³¨åƒåœ¾å›æ”¶å™¨è¿™ä¸€ç« çš„å„ç§å¸¸ç”¨çš„å‚æ•°</p><h2 id=139-gc-æ—¥å¿—åˆ†æ><a href=#139-gc-%e6%97%a5%e5%bf%97%e5%88%86%e6%9e%90 class=header-anchor></a>13.9. GC æ—¥å¿—åˆ†æ</h2><p>é€šè¿‡é˜…è¯» Gc æ—¥å¿—ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£ Java è™šæ‹Ÿæœºå†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥ã€‚ å†…å­˜åˆ†é…ä¸åƒåœ¾å›æ”¶çš„å‚æ•°åˆ—è¡¨</p><ul><li><code>-XX:+PrintGC</code> è¾“å‡º GC æ—¥å¿—ã€‚ç±»ä¼¼ï¼š<code>-verbose:gc</code></li><li><code>-XX:+PrintGCDetails</code> è¾“å‡º GC çš„è¯¦ç»†æ—¥å¿—</li><li><code>-XX:+PrintGCTimestamps</code> è¾“å‡º GC çš„æ—¶é—´æˆ³ï¼ˆä»¥åŸºå‡†æ—¶é—´çš„å½¢å¼ï¼‰</li><li><code>-XX:+PrintGCDatestamps</code> è¾“å‡º GcC çš„æ—¶é—´æˆ³ï¼ˆä»¥æ—¥æœŸçš„å½¢å¼ï¼Œå¦‚ 2013-05-04T21ï¼š53ï¼š59.234+0800ï¼‰</li><li><code>-XX:+PrintHeapAtGC</code> åœ¨è¿›è¡Œ GC çš„å‰åæ‰“å°å‡ºå †çš„ä¿¡æ¯</li><li><code>-Xloggc:../logs/gc.log</code> æ—¥å¿—æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„</li></ul><p>æ‰“å¼€ GC æ—¥å¿—</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>-verbose:gc
</span></span></code></pre></td></tr></table></div></div><p>è¿™ä¸ªåªä¼šæ˜¾ç¤ºæ€»çš„ GC å †çš„å˜åŒ–ï¼Œå¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1>1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2>2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>[</span><span class=n>GC</span><span class=w> </span><span class=p>(</span><span class=n>Allocation</span><span class=w> </span><span class=n>Failure</span><span class=p>)</span><span class=w> </span><span class=n>80832K</span><span class=o>-&gt;</span><span class=n>19298K</span><span class=p>(</span><span class=n>227840K</span><span class=p>),</span><span class=n>0</span><span class=p>.</span><span class=na>0084018</span><span class=w> </span><span class=n>secs</span><span class=o>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>[</span><span class=n>GC</span><span class=w> </span><span class=p>(</span><span class=n>Metadata</span><span class=w> </span><span class=n>GC</span><span class=w> </span><span class=n>Threshold</span><span class=p>)</span><span class=w> </span><span class=n>109499K</span><span class=o>-&gt;</span><span class=n>21465K</span><span class=p>(</span><span class=n>228352K</span><span class=p>),</span><span class=n>0</span><span class=p>.</span><span class=na>0184066</span><span class=w> </span><span class=n>secs</span><span class=o>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>[</span><span class=n>Full</span><span class=w> </span><span class=nf>GC</span><span class=w> </span><span class=p>(</span><span class=n>Metadata</span><span class=w> </span><span class=n>GC</span><span class=w> </span><span class=n>Threshold</span><span class=p>)</span><span class=w> </span><span class=n>21465K</span><span class=o>-&gt;</span><span class=n>16716K</span><span class=p>(</span><span class=n>201728K</span><span class=p>),</span><span class=n>0</span><span class=p>.</span><span class=na>0619261</span><span class=w> </span><span class=n>secs</span><span class=o>]</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å‚æ•°è§£æ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2>2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3>3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4>4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>GC</span><span class=err>ã€</span><span class=n>Full</span><span class=w> </span><span class=n>GC</span><span class=err>ï¼š</span><span class=n>GCçš„ç±»å‹</span><span class=err>ï¼Œ</span><span class=n>GCåªåœ¨æ–°ç”Ÿä»£ä¸Šè¿›è¡Œ</span><span class=err>ï¼Œ</span><span class=n>Full</span><span class=w> </span><span class=n>GCåŒ…æ‹¬æ°¸ç”Ÿä»£</span><span class=err>ï¼Œ</span><span class=n>æ–°ç”Ÿä»£</span><span class=err>ï¼Œ</span><span class=n>è€å¹´ä»£</span><span class=err>ã€‚</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Allocation</span><span class=w> </span><span class=n>Failure</span><span class=err>ï¼š</span><span class=n>GCå‘ç”Ÿçš„åŸå› </span><span class=err>ã€‚</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>80832K</span><span class=o>-&gt;</span><span class=n>19298K</span><span class=err>ï¼š</span><span class=n>å †åœ¨GCå‰çš„å¤§å°å’ŒGCåçš„å¤§å°</span><span class=err>ã€‚</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>228840k</span><span class=err>ï¼š</span><span class=n>ç°åœ¨çš„å †å¤§å°</span><span class=err>ã€‚</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>0</span><span class=p>.</span><span class=na>0084018</span><span class=w> </span><span class=n>secs</span><span class=err>ï¼š</span><span class=n>GCæŒç»­çš„æ—¶é—´</span><span class=err>ã€‚</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>æ‰“å¼€ GC æ—¥å¿—</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>-verbose:gc -XX:+PrintGCDetails
</span></span></code></pre></td></tr></table></div></div><p>è¾“å…¥ä¿¡æ¯å¦‚ä¸‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1>1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2>2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3>3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4>4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>[</span><span class=n>GC</span><span class=w> </span><span class=p>(</span><span class=n>Allocation</span><span class=w> </span><span class=n>Failure</span><span class=p>)</span><span class=w> </span><span class=o>[</span><span class=n>PSYoungGen</span><span class=p>:</span><span class=n>70640K</span><span class=o>-&gt;</span><span class=n>10116K</span><span class=p>(</span><span class=n>141312K</span><span class=p>)</span><span class=o>]</span><span class=w> </span><span class=n>80541K</span><span class=o>-&gt;</span><span class=n>20017K</span><span class=p>(</span><span class=n>227328K</span><span class=p>),</span><span class=n>0</span><span class=p>.</span><span class=na>0172573</span><span class=w> </span><span class=n>secs</span><span class=o>]</span><span class=w> </span><span class=o>[</span><span class=n>Times</span><span class=p>:</span><span class=n>user</span><span class=o>=</span><span class=n>0</span><span class=p>.</span><span class=na>03</span><span class=w> </span><span class=n>sys</span><span class=o>=</span><span class=n>0</span><span class=p>.</span><span class=na>00</span><span class=p>,</span><span class=n>real</span><span class=o>=</span><span class=n>0</span><span class=p>.</span><span class=na>02</span><span class=w> </span><span class=n>secs</span><span class=o>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>[</span><span class=n>GC</span><span class=w> </span><span class=p>(</span><span class=n>Metadata</span><span class=w> </span><span class=n>GC</span><span class=w> </span><span class=n>Threshold</span><span class=p>)</span><span class=w> </span><span class=o>[</span><span class=n>PSYoungGen</span><span class=p>:</span><span class=n>98859K</span><span class=o>-&gt;</span><span class=n>8154K</span><span class=p>(</span><span class=n>142336K</span><span class=p>)</span><span class=o>]</span><span class=w> </span><span class=n>108760K</span><span class=o>-&gt;</span><span class=n>21261K</span><span class=p>(</span><span class=n>228352K</span><span class=p>),</span><span class=n>0</span><span class=p>.</span><span class=na>0151573</span><span class=w> </span><span class=n>secs</span><span class=o>]</span><span class=w> </span><span class=o>[</span><span class=n>Times</span><span class=p>:</span><span class=n>user</span><span class=o>=</span><span class=n>0</span><span class=p>.</span><span class=na>00</span><span class=w> </span><span class=n>sys</span><span class=o>=</span><span class=n>0</span><span class=p>.</span><span class=na>01</span><span class=p>,</span><span class=n>real</span><span class=o>=</span><span class=n>0</span><span class=p>.</span><span class=na>02</span><span class=w> </span><span class=n>secs</span><span class=o>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>[</span><span class=n>Full</span><span class=w> </span><span class=nf>GC</span><span class=w> </span><span class=p>(</span><span class=n>Metadata</span><span class=w> </span><span class=n>GC</span><span class=w> </span><span class=n>Threshold</span><span class=p>)</span><span class=o>[</span><span class=n>PSYoungGen</span><span class=p>:</span><span class=n>8154K</span><span class=o>-&gt;</span><span class=n>0K</span><span class=p>(</span><span class=n>142336K</span><span class=p>)</span><span class=o>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>[</span><span class=n>ParOldGen</span><span class=p>:</span><span class=n>13107K</span><span class=o>-&gt;</span><span class=n>16809K</span><span class=p>(</span><span class=n>62464K</span><span class=p>)</span><span class=o>]</span><span class=w> </span><span class=n>21261K</span><span class=o>-&gt;</span><span class=n>16809K</span><span class=p>(</span><span class=n>204800K</span><span class=p>),</span><span class=o>[</span><span class=n>Metaspace</span><span class=p>:</span><span class=n>20599K</span><span class=o>-&gt;</span><span class=n>20599K</span><span class=p>(</span><span class=n>1067008K</span><span class=p>)</span><span class=o>]</span><span class=p>,</span><span class=n>0</span><span class=p>.</span><span class=na>0639732</span><span class=w> </span><span class=n>secs</span><span class=o>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>[</span><span class=n>Times</span><span class=p>:</span><span class=n>user</span><span class=o>=</span><span class=n>0</span><span class=p>.</span><span class=na>14</span><span class=w> </span><span class=n>sys</span><span class=o>=</span><span class=n>0</span><span class=p>.</span><span class=na>00</span><span class=p>,</span><span class=n>real</span><span class=o>=</span><span class=n>0</span><span class=p>.</span><span class=na>06</span><span class=w> </span><span class=n>secs</span><span class=o>]</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å‚æ•°è§£æ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1>1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2>2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3>3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4>4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5>5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6>6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>GC</span><span class=err>ï¼Œ</span><span class=n>Full</span><span class=w> </span><span class=n>FC</span><span class=err>ï¼š</span><span class=n>åŒæ ·æ˜¯GCçš„ç±»å‹</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Allocation</span><span class=w> </span><span class=n>Failure</span><span class=err>ï¼š</span><span class=n>GCåŸå› </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>PSYoungGen</span><span class=err>ï¼š</span><span class=n>ä½¿ç”¨äº†Parallel</span><span class=w> </span><span class=n>Scavengeå¹¶è¡Œåƒåœ¾æ”¶é›†å™¨çš„æ–°ç”Ÿä»£GCå‰åå¤§å°çš„å˜åŒ–</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ParOldGen</span><span class=err>ï¼š</span><span class=n>ä½¿ç”¨äº†Parallel</span><span class=w> </span><span class=n>Oldå¹¶è¡Œåƒåœ¾æ”¶é›†å™¨çš„è€å¹´ä»£GCå‰åå¤§å°çš„å˜åŒ–</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Metaspace</span><span class=err>ï¼š</span><span class=w> </span><span class=n>å…ƒæ•°æ®åŒºGCå‰åå¤§å°çš„å˜åŒ–</span><span class=err>ï¼Œ</span><span class=n>JDK1</span><span class=p>.</span><span class=na>8ä¸­å¼•å…¥äº†å…ƒæ•°æ®åŒºä»¥æ›¿ä»£æ°¸ä¹…ä»£</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>xxx</span><span class=w> </span><span class=n>secs</span><span class=err>ï¼š</span><span class=n>æŒ‡GCèŠ±è´¹çš„æ—¶é—´</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Times</span><span class=err>ï¼š</span><span class=n>user</span><span class=err>ï¼š</span><span class=n>æŒ‡çš„æ˜¯åƒåœ¾æ”¶é›†å™¨èŠ±è´¹çš„æ‰€æœ‰CPUæ—¶é—´</span><span class=err>ï¼Œ</span><span class=n>sys</span><span class=err>ï¼š</span><span class=n>èŠ±è´¹åœ¨ç­‰å¾…ç³»ç»Ÿè°ƒç”¨æˆ–ç³»ç»Ÿäº‹ä»¶çš„æ—¶é—´</span><span class=err>ï¼Œ</span><span class=n>real</span><span class=err>ï¼š</span><span class=n>GCä»å¼€å§‹åˆ°ç»“æŸçš„æ—¶é—´</span><span class=err>ï¼Œ</span><span class=n>åŒ…æ‹¬å…¶ä»–è¿›ç¨‹å ç”¨æ—¶é—´ç‰‡çš„å®é™…æ—¶é—´</span><span class=err>ã€‚</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>æ‰“å¼€ GC æ—¥å¿—</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimestamps -XX:+PrintGCDatestamps
</span></span></code></pre></td></tr></table></div></div><p>è¾“å…¥ä¿¡æ¯å¦‚ä¸‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1>1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2>2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3>3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4>4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>2019</span><span class=o>-</span><span class=n>09</span><span class=o>-</span><span class=n>24T22</span><span class=p>:</span><span class=n>15</span><span class=p>:</span><span class=n>24</span><span class=p>.</span><span class=na>518</span><span class=o>+</span><span class=n>0800</span><span class=p>:</span><span class=w> </span><span class=n>3</span><span class=p>.</span><span class=na>287</span><span class=p>:</span><span class=w> </span><span class=o>[</span><span class=n>GC</span><span class=w> </span><span class=p>(</span><span class=n>Allocation</span><span class=w> </span><span class=n>Failure</span><span class=p>)</span><span class=w> </span><span class=o>[</span><span class=n>PSYoungGen</span><span class=p>:</span><span class=n>136162K</span><span class=o>-&gt;</span><span class=n>5113K</span><span class=p>(</span><span class=n>136192K</span><span class=p>)</span><span class=o>]</span><span class=w> </span><span class=n>141425K</span><span class=o>-&gt;</span><span class=n>17632K</span><span class=p>(</span><span class=n>222208K</span><span class=p>),</span><span class=n>0</span><span class=p>.</span><span class=na>0248249</span><span class=w> </span><span class=n>secs</span><span class=o>]</span><span class=w> </span><span class=o>[</span><span class=n>Times</span><span class=p>:</span><span class=n>user</span><span class=o>=</span><span class=n>0</span><span class=p>.</span><span class=na>05</span><span class=w> </span><span class=n>sys</span><span class=o>=</span><span class=n>0</span><span class=p>.</span><span class=na>00</span><span class=p>,</span><span class=n>real</span><span class=o>=</span><span class=n>0</span><span class=p>.</span><span class=na>03</span><span class=w> </span><span class=n>secs</span><span class=o>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>2019</span><span class=o>-</span><span class=n>09</span><span class=o>-</span><span class=n>24T22</span><span class=p>:</span><span class=n>15</span><span class=p>:</span><span class=n>25</span><span class=p>.</span><span class=na>559</span><span class=o>+</span><span class=n>0800</span><span class=p>:</span><span class=w> </span><span class=n>4</span><span class=p>.</span><span class=na>329</span><span class=p>:</span><span class=w> </span><span class=o>[</span><span class=n>GC</span><span class=w> </span><span class=p>(</span><span class=n>Metadata</span><span class=w> </span><span class=n>GC</span><span class=w> </span><span class=n>Threshold</span><span class=p>)</span><span class=w> </span><span class=o>[</span><span class=n>PSYoungGen</span><span class=p>:</span><span class=n>97578K</span><span class=o>-&gt;</span><span class=n>10068K</span><span class=p>(</span><span class=n>274944K</span><span class=p>)</span><span class=o>]</span><span class=w> </span><span class=n>110096K</span><span class=o>-&gt;</span><span class=n>22658K</span><span class=p>(</span><span class=n>360960K</span><span class=p>),</span><span class=n>0</span><span class=p>.</span><span class=na>0094071</span><span class=w> </span><span class=n>secs</span><span class=o>]</span><span class=w> </span><span class=o>[</span><span class=n>Times</span><span class=p>:</span><span class=w> </span><span class=n>user</span><span class=o>=</span><span class=n>0</span><span class=p>.</span><span class=na>00</span><span class=w> </span><span class=n>sys</span><span class=o>=</span><span class=n>0</span><span class=p>.</span><span class=na>00</span><span class=p>,</span><span class=n>real</span><span class=o>=</span><span class=n>0</span><span class=p>.</span><span class=na>01</span><span class=w> </span><span class=n>secs</span><span class=o>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>2019</span><span class=o>-</span><span class=n>09</span><span class=o>-</span><span class=n>24T22</span><span class=p>:</span><span class=n>15</span><span class=p>:</span><span class=n>25</span><span class=p>.</span><span class=na>569</span><span class=o>+</span><span class=n>0800</span><span class=p>:</span><span class=w> </span><span class=n>4</span><span class=p>.</span><span class=na>338</span><span class=p>:</span><span class=w> </span><span class=o>[</span><span class=n>Full</span><span class=w> </span><span class=nf>GC</span><span class=w> </span><span class=p>(</span><span class=n>Metadata</span><span class=w> </span><span class=n>GC</span><span class=w> </span><span class=n>Threshold</span><span class=p>)</span><span class=w> </span><span class=o>[</span><span class=n>PSYoungGen</span><span class=p>:</span><span class=n>10068K</span><span class=o>-&gt;</span><span class=n>0K</span><span class=p>(</span><span class=n>274944K</span><span class=p>)</span><span class=o>][</span><span class=n>ParoldGen</span><span class=p>:</span><span class=n>12590K</span><span class=o>-&gt;</span><span class=n>13564K</span><span class=p>(</span><span class=n>56320K</span><span class=p>)</span><span class=o>]</span><span class=w> </span><span class=n>22658K</span><span class=o>-&gt;</span><span class=n>13564K</span><span class=p>(</span><span class=n>331264K</span><span class=p>),</span><span class=o>[</span><span class=n>Metaspace</span><span class=p>:</span><span class=n>20590K</span><span class=o>-&gt;</span><span class=n>20590K</span><span class=p>(</span><span class=n>1067008K</span><span class=p>)</span><span class=o>]</span><span class=p>,</span><span class=n>0</span><span class=p>.</span><span class=na>0494875</span><span class=w> </span><span class=n>secs</span><span class=o>]</span><span class=w> </span><span class=o>[</span><span class=n>Times</span><span class=p>:</span><span class=w> </span><span class=n>user</span><span class=o>=</span><span class=n>0</span><span class=p>.</span><span class=na>17</span><span class=w> </span><span class=n>sys</span><span class=o>=</span><span class=n>0</span><span class=p>.</span><span class=na>02</span><span class=p>,</span><span class=n>real</span><span class=o>=</span><span class=n>0</span><span class=p>.</span><span class=na>05</span><span class=w> </span><span class=n>secs</span><span class=o>]</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>è¯´æ˜ï¼šå¸¦ä¸Šäº†æ—¥æœŸå’Œå®è·µ</p><p>å¦‚æœæƒ³æŠŠ GC æ—¥å¿—å­˜åˆ°æ–‡ä»¶çš„è¯ï¼Œæ˜¯ä¸‹é¢çš„å‚æ•°ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>-Xloggc:/path/to/gc.log
</span></span></code></pre></td></tr></table></div></div><p><strong>æ—¥å¿—è¡¥å……è¯´æ˜</strong></p><ul><li><p>&ldquo;<code>[GC</code>&ldquo;å’Œ&rdquo;<code>[Full GC</code>&ldquo;è¯´æ˜äº†è¿™æ¬¡åƒåœ¾æ”¶é›†çš„åœé¡¿ç±»å‹ï¼Œå¦‚æœæœ‰"Full"åˆ™è¯´æ˜ GC å‘ç”Ÿäº†"Stop The World&rdquo;</p></li><li><p>ä½¿ç”¨ Serial æ”¶é›†å™¨åœ¨æ–°ç”Ÿä»£çš„åå­—æ˜¯ Default New Generationï¼Œå› æ­¤æ˜¾ç¤ºçš„æ˜¯&rdquo;<code>[DefNew</code>&rdquo;</p></li><li><p>ä½¿ç”¨ ParNew æ”¶é›†å™¨åœ¨æ–°ç”Ÿä»£çš„åå­—ä¼šå˜æˆ&rdquo;<code>[ParNew</code>"ï¼Œæ„æ€æ˜¯"Parallel New Generation"</p></li><li><p>ä½¿ç”¨ Parallel scavenge æ”¶é›†å™¨åœ¨æ–°ç”Ÿä»£çš„åå­—æ˜¯â€<code>[PSYoungGen</code>"</p></li><li><p>è€å¹´ä»£çš„æ”¶é›†å’Œæ–°ç”Ÿä»£é“ç†ä¸€æ ·ï¼Œåå­—ä¹Ÿæ˜¯æ”¶é›†å™¨å†³å®šçš„</p></li><li><p>ä½¿ç”¨ G1 æ”¶é›†å™¨çš„è¯ï¼Œä¼šæ˜¾ç¤ºä¸º"garbage-first heap"</p></li><li><p><mark>Allocation Failure</mark></p><p>è¡¨æ˜æœ¬æ¬¡å¼•èµ· GC çš„åŸå› æ˜¯å› ä¸ºåœ¨å¹´è½»ä»£ä¸­æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´èƒ½å¤Ÿå­˜å‚¨æ–°çš„æ•°æ®äº†ã€‚</p></li><li><p><mark>[PSYoungGenï¼š5986K->696K(8704K) ] 5986K->704K(9216K)</mark></p><p>ä¸­æ‹¬å·å†…ï¼šGC å›æ”¶å‰å¹´è½»ä»£å¤§å°ï¼Œå›æ”¶åå¤§å°ï¼Œï¼ˆå¹´è½»ä»£æ€»å¤§å°ï¼‰</p><p>æ‹¬å·å¤–ï¼šGC å›æ”¶å‰å¹´è½»ä»£å’Œè€å¹´ä»£å¤§å°ï¼Œå›æ”¶åå¤§å°ï¼Œï¼ˆå¹´è½»ä»£å’Œè€å¹´ä»£æ€»å¤§å°ï¼‰</p></li><li><p><mark>user ä»£è¡¨ç”¨æˆ·æ€å›æ”¶è€—æ—¶ï¼Œsys å†…æ ¸æ€å›æ”¶è€—æ—¶ï¼Œrea å®é™…è€—æ—¶</mark>ã€‚ç”±äºå¤šæ ¸çš„åŸå› ï¼Œæ—¶é—´æ€»å’Œå¯èƒ½ä¼šè¶…è¿‡ real æ—¶é—´</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1> 1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2> 2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3> 3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4> 4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5> 5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6> 6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7> 7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8> 8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9> 9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10>10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Heap</span><span class=err>ï¼ˆ</span><span class=n>å †</span><span class=err>ï¼‰</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>PSYoungGen</span><span class=err>ï¼ˆ</span><span class=n>Parallel</span><span class=w> </span><span class=n>Scavengeæ”¶é›†å™¨æ–°ç”Ÿä»£</span><span class=err>ï¼‰</span><span class=n>total</span><span class=w> </span><span class=n>9216K</span><span class=err>ï¼Œ</span><span class=n>used</span><span class=w> </span><span class=n>6234K</span><span class=w> </span><span class=o>[</span><span class=n>0x00000000ff600000</span><span class=p>,</span><span class=n>0x0000000100000000</span><span class=p>,</span><span class=n>0x0000000100000000</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>eden</span><span class=w> </span><span class=n>space</span><span class=err>ï¼ˆ</span><span class=n>å †ä¸­çš„EdenåŒºé»˜è®¤å æ¯”æ˜¯8</span><span class=err>ï¼‰</span><span class=n>8192K</span><span class=err>ï¼Œ</span><span class=n>768</span><span class=w> </span><span class=n>used</span><span class=w> </span><span class=o>[</span><span class=n>0x00000000ff600000</span><span class=p>,</span><span class=n>0x00000000ffc16b08</span><span class=p>,</span><span class=n>0x00000000ffe00000</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>from</span><span class=w> </span><span class=n>space</span><span class=err>ï¼ˆ</span><span class=n>å †ä¸­çš„Survivor</span><span class=err>ï¼Œ</span><span class=n>è¿™é‡Œæ˜¯From</span><span class=w> </span><span class=n>SurvivoråŒºé»˜è®¤å æ¯”æ˜¯1</span><span class=err>ï¼‰</span><span class=n>1024K</span><span class=err>ï¼Œ</span><span class=w> </span><span class=n>0</span><span class=o>%</span><span class=w> </span><span class=n>used</span><span class=w> </span><span class=o>[</span><span class=n>0x00000000fff00000</span><span class=p>,</span><span class=n>0x00000000fff00000</span><span class=p>,</span><span class=n>0x0000000100000000</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>to</span><span class=w> </span><span class=n>space</span><span class=err>ï¼ˆ</span><span class=n>å †ä¸­çš„Survivor</span><span class=err>ï¼Œ</span><span class=n>è¿™é‡Œæ˜¯to</span><span class=w> </span><span class=n>SurvivoråŒºé»˜è®¤å æ¯”æ˜¯1</span><span class=err>ï¼Œ</span><span class=n>éœ€è¦å…ˆäº†è§£ä¸€ä¸‹å †çš„åˆ†é…ç­–ç•¥</span><span class=err>ï¼‰</span><span class=n>1024K</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=o>%</span><span class=w> </span><span class=n>used</span><span class=w> </span><span class=o>[</span><span class=n>0x00000000ffe00000</span><span class=p>,</span><span class=n>0x00000000ffe00000</span><span class=p>,</span><span class=n>0x00000000fff00000</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ParOldGen</span><span class=err>ï¼ˆ</span><span class=n>è€å¹´ä»£æ€»å¤§å°å’Œä½¿ç”¨å¤§å°</span><span class=err>ï¼‰</span><span class=n>total</span><span class=w> </span><span class=n>10240K</span><span class=err>ï¼Œ</span><span class=w> </span><span class=n>used</span><span class=w> </span><span class=n>7001K</span><span class=w> </span><span class=err>ï¼»</span><span class=n>0x00000000fec00000</span><span class=p>,</span><span class=n>0x00000000ff600000</span><span class=p>,</span><span class=n>0x00000000ff600000</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>object</span><span class=w> </span><span class=n>space</span><span class=err>ï¼ˆ</span><span class=n>æ˜¾ç¤ºä¸ªä½¿ç”¨ç™¾åˆ†æ¯”</span><span class=err>ï¼‰</span><span class=n>10240K</span><span class=err>ï¼Œ</span><span class=n>688</span><span class=w> </span><span class=n>used</span><span class=w> </span><span class=o>[</span><span class=n>0x00000000fec00000</span><span class=p>,</span><span class=n>0x00000000ff2d6630</span><span class=p>,</span><span class=n>0x00000000ff600000</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>PSPermGen</span><span class=err>ï¼ˆ</span><span class=n>æ°¸ä¹…ä»£æ€»å¤§å°å’Œä½¿ç”¨å¤§å°</span><span class=err>ï¼‰</span><span class=n>total</span><span class=w> </span><span class=n>21504K</span><span class=err>ï¼Œ</span><span class=w> </span><span class=n>used</span><span class=w> </span><span class=n>4949K</span><span class=w> </span><span class=o>[</span><span class=n>0x00000000f9a00000</span><span class=p>,</span><span class=n>0x00000000faf00000</span><span class=p>,</span><span class=n>0x00000000fec00000</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>object</span><span class=w> </span><span class=n>space</span><span class=err>ï¼ˆ</span><span class=n>æ˜¾ç¤ºä¸ªä½¿ç”¨ç™¾åˆ†æ¯”</span><span class=err>ï¼Œ</span><span class=n>è‡ªå·±èƒ½ç®—å‡ºæ¥</span><span class=err>ï¼‰</span><span class=n>21504K</span><span class=err>ï¼Œ</span><span class=w> </span><span class=n>238</span><span class=w> </span><span class=n>used</span><span class=w> </span><span class=o>[</span><span class=n>0x00000000f9a00000</span><span class=p>,</span><span class=n>0x00000000f9ed55e0</span><span class=p>,</span><span class=n>0x00000000faf00000</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=minor-gc-æ—¥å¿—><a href=#minor-gc-%e6%97%a5%e5%bf%97 class=header-anchor></a>Minor GC æ—¥å¿—</h3><p><img src=https://logan.1357810.xyz/img/20220422/153020741-2cdef56df9.png width=900 height=600 loading=lazy decoding=async alt=image-20200714082555688 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><h3 id=full-gc-æ—¥å¿—><a href=#full-gc-%e6%97%a5%e5%bf%97 class=header-anchor></a>Full GC æ—¥å¿—</h3><p><img src=https://logan.1357810.xyz/img/20220422/153020742-f1c4895d7c.png width=900 height=600 loading=lazy decoding=async alt=image-20210512194815354 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p><strong>ä¸¾ä¾‹</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1> 1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2> 2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3> 3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4> 4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5> 5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6> 6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7> 7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8> 8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9> 9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10>10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11>11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12>12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>_1MB</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>1024</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>1024</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testAllocation</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>allocation1</span><span class=p>,</span><span class=w> </span><span class=n>allocation2</span><span class=p>,</span><span class=w> </span><span class=n>allocation3</span><span class=p>,</span><span class=w> </span><span class=n>allocation4</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>allocation1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=kt>byte</span><span class=o>[</span><span class=n>2</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>_1MB</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>allocation2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=kt>byte</span><span class=o>[</span><span class=n>2</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>_1MB</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>allocation3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=kt>byte</span><span class=o>[</span><span class=n>2</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>_1MB</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>allocation4</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=kt>byte</span><span class=o>[</span><span class=n>4</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>_1MB</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>testAllocation</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>è®¾ç½® JVM å‚æ•°</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>-Xms20m -Xmx20m -Xmn10m -XX:SurvivorRatio<span class=o>=</span><span class=m>8</span> -XX:+PrintGCDetails -XX:+UseParallelGC
</span></span></code></pre></td></tr></table></div></div><p><strong>å›¾ç¤º</strong></p><p><img src=https://logan.1357810.xyz/img/20220422/153020742-d1c5f2aa8d.png width=900 height=600 loading=lazy decoding=async alt=image-20200714083332238 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p><img src=https://logan.1357810.xyz/img/20220422/153020742-5e93a8c008.png width=900 height=600 loading=lazy decoding=async alt=image-20200714083526790 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><ul><li><p>ä¸Šå›¾æ˜¯JDK1.7æƒ…å†µï¼šEdenåŒºå·²ç»æœ‰ä¸‰ä¸ª2Må¯¹è±¡ï¼Œè¿™æ—¶æ–°åˆ›å»ºçš„4Må¯¹è±¡æ— æ³•æ”¾å…¥Edenï¼Œè§¦å‘minorGCã€‚å› ä¸ºfromå’ŒtoåŒºéƒ½æ˜¯1Mçš„ç©ºé—´ï¼ŒEdenä¸­çš„æ¯ä¸ª2Må¯¹è±¡éƒ½æ”¾ä¸è¿›SurvivoråŒºï¼Œæ‰€ä»¥ä¼šæ”¾å…¥è€å¹´ä»£</p></li><li><p>JDK1.8æƒ…å†µï¼šEdenåŒºå·²ç»æœ‰ä¸‰ä¸ª2Må¯¹è±¡ï¼Œè¿™æ—¶æ–°åˆ›å»ºçš„4Må¯¹è±¡æ— æ³•æ”¾å…¥Edenï¼Œè¿™æ—¶ä¼šåˆ¤æ–­æ–°å¢çš„å¯¹è±¡æ˜¯å¦å¤§äºEdenåŒºæ€»ç©ºé—´çš„äºŒåˆ†ä¹‹ä¸€ï¼Œç„¶åç›´æ¥æŠŠ4Må¯¹è±¡æ”¾å…¥è€å¹´ä»£</p></li></ul><p>å¯ä»¥ç”¨ä¸€äº›å·¥å…·å»åˆ†æè¿™äº› GC æ—¥å¿—</p><ul><li><p>å°†GCæ—¥å¿—ä¿å­˜åˆ°æ–‡ä»¶ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>-Xloggc:/path/to/gc.log
</span></span></code></pre></td></tr></table></div></div></li><li><p>å¸¸ç”¨çš„æ—¥å¿—åˆ†æå·¥å…·æœ‰ï¼šGCViewerã€GCEasyã€GCHistoã€GCLogViewerã€Hpjmeterã€garbagecat ç­‰</p></li></ul><h2 id=13x-åƒåœ¾å›æ”¶å™¨çš„æ–°å‘å±•><a href=#13x-%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6%e5%99%a8%e7%9a%84%e6%96%b0%e5%8f%91%e5%b1%95 class=header-anchor></a>13.X. åƒåœ¾å›æ”¶å™¨çš„æ–°å‘å±•</h2><p>GC ä»ç„¶å¤„äºé£é€Ÿå‘å±•ä¹‹ä¸­ï¼Œç›®å‰çš„é»˜è®¤é€‰é¡¹<mark>G1 GC åœ¨ä¸æ–­çš„è¿›è¡Œæ”¹è¿›</mark>ï¼Œå¾ˆå¤šæˆ‘ä»¬åŸæ¥è®¤ä¸ºçš„ç¼ºç‚¹ï¼Œä¾‹å¦‚ä¸²è¡Œçš„ Fu11GCã€Card Table æ‰«æçš„ä½æ•ˆç­‰ï¼Œéƒ½å·²ç»è¢«å¤§å¹…æ”¹è¿›ï¼Œä¾‹å¦‚ï¼ŒJDK10 ä»¥åï¼ŒFu11GC å·²ç»æ˜¯å¹¶è¡Œè¿è¡Œï¼Œåœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œå…¶è¡¨ç°è¿˜ç•¥ä¼˜äº ParallelGC çš„å¹¶è¡Œ Ful1GC å®ç°ã€‚</p><p>å³ä½¿æ˜¯ Serial GCï¼Œè™½ç„¶æ¯”è¾ƒå¤è€ï¼Œä½†æ˜¯ç®€å•çš„è®¾è®¡å’Œå®ç°æœªå¿…å°±æ˜¯è¿‡æ—¶çš„ï¼Œå®ƒæœ¬èº«çš„å¼€é”€ï¼Œä¸ç®¡æ˜¯ GC ç›¸å…³æ•°æ®ç»“æ„çš„å¼€é”€ï¼Œè¿˜æ˜¯çº¿ç¨‹çš„å¼€é”€ï¼Œéƒ½æ˜¯éå¸¸å°çš„ï¼Œæ‰€ä»¥éšç€äº‘è®¡ç®—çš„å…´èµ·ï¼Œ<mark>åœ¨ Serverless ç­‰æ–°çš„åº”ç”¨åœºæ™¯ä¸‹ï¼ŒSerial GC æ‰¾åˆ°äº†æ–°çš„èˆå°</mark>ã€‚</p><p>æ¯”è¾ƒä¸å¹¸çš„æ˜¯ CMSGCï¼Œå› ä¸ºå…¶ç®—æ³•çš„ç†è®ºç¼ºé™·ç­‰åŸå› ï¼Œè™½ç„¶ç°åœ¨è¿˜æœ‰éå¸¸å¤§çš„ç”¨æˆ·ç¾¤ä½“ï¼Œä½†åœ¨ JDK9 ä¸­å·²ç»è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œå¹¶åœ¨ JDK14 ç‰ˆæœ¬ä¸­ç§»é™¤</p><h3 id=13x1-jdk11-æ–°ç‰¹æ€§><a href=#13x1-jdk11-%e6%96%b0%e7%89%b9%e6%80%a7 class=header-anchor></a>13.X.1. JDK11 æ–°ç‰¹æ€§</h3><p>Epsilon:A No-Op GarbageCollectorï¼ˆEpsilon åƒåœ¾å›æ”¶å™¨ï¼Œ&ldquo;No-Opï¼ˆæ— æ“ä½œï¼‰&ldquo;å›æ”¶å™¨ï¼‰<a class=link href=http://openidk.iava.net/jeps/318 target=_blank rel=noopener>http://openidk.iava.net/jeps/318
<span style=white-space:nowrap class="iconfont icon-arrow-up-right-from-square-solid"></span></a></p><p>ZGC:A Scalable Low-Latency Garbage Collectorï¼ˆExperimentalï¼‰ï¼ˆZGCï¼šå¯ä¼¸ç¼©çš„ä½å»¶è¿Ÿåƒåœ¾å›æ”¶å™¨ï¼Œå¤„äºå®éªŒæ€§é˜¶æ®µï¼‰<a class=link href=http://openidk.iava.net/jeps/318 target=_blank rel=noopener>http://openidk.iava.net/jeps/333
<span style=white-space:nowrap class="iconfont icon-arrow-up-right-from-square-solid"></span></a></p><p><img src=https://logan.1357810.xyz/img/20220422/153020742-79d7199de5.png width=900 height=600 loading=lazy decoding=async alt=image-20210512195426194 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p>ç°åœ¨ G1 å›æ”¶å™¨å·²æˆä¸ºé»˜è®¤å›æ”¶å™¨å¥½å‡ å¹´äº†ã€‚</p><p>æˆ‘ä»¬è¿˜çœ‹åˆ°äº†å¼•å…¥äº†ä¸¤ä¸ªæ–°çš„æ”¶é›†å™¨ï¼šZGCï¼ˆJDK11 å‡ºç°ï¼‰å’Œ Shenandoahï¼ˆOpen JDK12ï¼‰ã€‚ä¸»æ‰“ç‰¹ç‚¹ï¼šä½åœé¡¿æ—¶é—´</p><p><img src=https://logan.1357810.xyz/img/20220422/153020742-112ef0e6e6.png width=900 height=600 loading=lazy decoding=async alt=image-20210512195528695 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><h3 id=13x2-open-jdk12-çš„-shenandoash-gc><a href=#13x2-open-jdk12-%e7%9a%84-shenandoash-gc class=header-anchor></a>13.X.2. Open JDK12 çš„ Shenandoash GC</h3><p><mark>Open JDK12 çš„ Shenandoash GCï¼šä½åœé¡¿æ—¶é—´çš„ GCï¼ˆå®éªŒæ€§ï¼‰</mark></p><p><mark>Shenandoahï¼Œæ— ç–‘æ˜¯ä¼—å¤š GC ä¸­æœ€å­¤ç‹¬çš„ä¸€ä¸ªã€‚</mark>æ˜¯ç¬¬ä¸€æ¬¾ä¸ç”± oracle å…¬å¸å›¢é˜Ÿé¢†å¯¼å¼€å‘çš„ Hotspot åƒåœ¾æ”¶é›†å™¨ã€‚ä¸å¯é¿å…çš„<mark>å—åˆ°å®˜æ–¹çš„æ’æŒ¤</mark>ã€‚æ¯”å¦‚å·ç§° OpenJDK å’Œ OracleJDK æ²¡æœ‰åŒºåˆ«çš„ Oracle å…¬å¸ä»æ‹’ç»åœ¨ OracleJDK12 ä¸­æ”¯æŒ Shenandoahã€‚</p><p>Shenandoah åƒåœ¾å›æ”¶å™¨æœ€åˆç”± RedHat è¿›è¡Œçš„ä¸€é¡¹åƒåœ¾æ”¶é›†å™¨ç ”ç©¶é¡¹ç›® Pauseless GC çš„å®ç°ï¼Œ<mark>æ—¨åœ¨é’ˆå¯¹ JVM ä¸Šçš„å†…å­˜å›æ”¶å®ç°ä½åœé¡¿çš„éœ€æ±‚</mark>.ã€‚åœ¨ 2014 å¹´è´¡çŒ®ç»™ OpenJDKã€‚</p><p>Red Hat ç ”å‘ Shenandoah å›¢é˜Ÿå¯¹å¤–å®£ç§°ï¼Œ<mark>Shenandoah åƒåœ¾å›æ”¶å™¨çš„æš‚åœæ—¶é—´ä¸å †å¤§å°æ— å…³ï¼Œè¿™æ„å‘³ç€æ— è®ºå°†å †è®¾ç½®ä¸º 200MB è¿˜æ˜¯ 200GBï¼Œ99.9%çš„ç›®æ ‡éƒ½å¯ä»¥æŠŠåƒåœ¾æ”¶é›†çš„åœé¡¿æ—¶é—´é™åˆ¶åœ¨åæ¯«ç§’ä»¥å†…ã€‚</mark>ä¸è¿‡å®é™…ä½¿ç”¨æ€§èƒ½å°†å–å†³äºå®é™…å·¥ä½œå †çš„å¤§å°å’Œå·¥ä½œè´Ÿè½½ã€‚</p><p><img src=https://logan.1357810.xyz/img/20220422/153020742-e100f81c37.png width=900 height=600 loading=lazy decoding=async alt=image-20200714090608807 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p>è¿™æ˜¯ RedHat åœ¨ 2016 å¹´å‘è¡¨çš„è®ºæ–‡æ•°æ®ï¼Œæµ‹è¯•å†…å®¹æ˜¯ä½¿ç”¨ Es å¯¹ 200GB çš„ç»´åŸºç™¾ç§‘æ•°æ®è¿›è¡Œç´¢å¼•ã€‚ä»ç»“æœçœ‹ï¼š</p><ul><li>åœé¡¿æ—¶é—´æ¯”å…¶ä»–å‡ æ¬¾æ”¶é›†å™¨ç¡®å®æœ‰äº†è´¨çš„é£è·ƒï¼Œä½†ä¹Ÿæœªå®ç°æœ€å¤§åœé¡¿æ—¶é—´æ§åˆ¶åœ¨åæ¯«ç§’ä»¥å†…çš„ç›®æ ‡ã€‚</li><li>è€Œååé‡æ–¹é¢å‡ºç°äº†æ˜æ˜¾çš„ä¸‹é™ï¼Œæ€»è¿è¡Œæ—¶é—´æ˜¯æ‰€æœ‰æµ‹è¯•æ”¶é›†å™¨é‡Œæœ€é•¿çš„ã€‚</li></ul><p>æ€»ç»“</p><ul><li>Shenandoah GC çš„å¼±é¡¹ï¼šé«˜è¿è¡Œè´Ÿæ‹…ä¸‹çš„ååé‡ä¸‹é™ã€‚</li><li>Shenandoah GC çš„å¼ºé¡¹ï¼šä½å»¶è¿Ÿæ—¶é—´ã€‚</li><li>Shenandoah GC çš„å·¥ä½œè¿‡ç¨‹å¤§è‡´åˆ†ä¸ºä¹ä¸ªé˜¶æ®µï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚åœ¨ä¹‹å‰ Java12 æ–°ç‰¹æ€§è§†é¢‘é‡Œæœ‰è¿‡ä»‹ç»ã€‚</li></ul><p>ã€Java12 æ–°ç‰¹æ€§åœ°å€ã€‘</p><p><a class=link href="http://www.atguigu.com/download_detail.shtml?v=222" target=_blank rel=noopener>http://www.atguigu.com/download_detail.shtml?v=222
<span style=white-space:nowrap class="iconfont icon-arrow-up-right-from-square-solid"></span></a></p><p>æˆ–</p><p><a class=link href="https://www.bilibili.com/video/BV1jJ411M7kQ?from=search&amp;seid=12339069673726242866" target=_blank rel=noopener>https://www.bilibili.com/video/BV1jJ411M7kQ?from=search&amp;seid=12339069673726242866
<span style=white-space:nowrap class="iconfont icon-arrow-up-right-from-square-solid"></span></a></p><h3 id=13x3-ä»¤äººéœ‡æƒŠé©å‘½æ€§çš„-zgc><a href=#13x3-%e4%bb%a4%e4%ba%ba%e9%9c%87%e6%83%8a%e9%9d%a9%e5%91%bd%e6%80%a7%e7%9a%84-zgc class=header-anchor></a>13.X.3. ä»¤äººéœ‡æƒŠã€é©å‘½æ€§çš„ ZGC</h3><p>å®˜æ–¹åœ°å€ï¼š<a class=link href=https://docs.oracle.com/en/java/javase/12/gctuning/ target=_blank rel=noopener>https://docs.oracle.com/en/java/javase/12/gctuning/
<span style=white-space:nowrap class="iconfont icon-arrow-up-right-from-square-solid"></span></a></p><p><img src=https://logan.1357810.xyz/img/20220422/153020742-cf93e0a2ff.png width=900 height=600 loading=lazy decoding=async alt=image-20210512200236647 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p>ZGC ä¸ Shenandoah ç›®æ ‡é«˜åº¦ç›¸ä¼¼ï¼Œ<mark>åœ¨å°½å¯èƒ½å¯¹ååé‡å½±å“ä¸å¤§çš„å‰æä¸‹ï¼Œå®ç°åœ¨ä»»æ„å †å†…å­˜å¤§å°ä¸‹éƒ½å¯ä»¥æŠŠåƒåœ¾æ”¶é›†çš„åœé¢‡æ—¶é—´é™åˆ¶åœ¨åæ¯«ç§’ä»¥å†…çš„ä½å»¶è¿Ÿã€‚</mark></p><p>ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹ä¸€ä¹¦ä¸­è¿™æ ·å®šä¹‰ ZGCï¼šZGC æ”¶é›†å™¨æ˜¯ä¸€æ¬¾åŸºäº Region å†…å­˜å¸ƒå±€çš„ï¼Œï¼ˆæš‚æ—¶ï¼‰ä¸è®¾åˆ†ä»£çš„ï¼Œä½¿ç”¨äº†è¯»å±éšœã€æŸ“è‰²æŒ‡é’ˆå’Œå†…å­˜å¤šé‡æ˜ å°„ç­‰æŠ€æœ¯æ¥å®ç°<mark>å¯å¹¶å‘çš„æ ‡è®°-å‹ç¼©ç®—æ³•</mark>çš„ï¼Œä»¥<mark>ä½å»¶è¿Ÿä¸ºé¦–è¦ç›®æ ‡</mark>çš„ä¸€æ¬¾åƒåœ¾æ”¶é›†å™¨ã€‚</p><p>ZGC çš„å·¥ä½œè¿‡ç¨‹å¯ä»¥åˆ†ä¸º 4 ä¸ªé˜¶æ®µï¼š<mark>å¹¶å‘æ ‡è®° - å¹¶å‘é¢„å¤‡é‡åˆ†é… - å¹¶å‘é‡åˆ†é… - å¹¶å‘é‡æ˜ å°„</mark> ç­‰ã€‚</p><p>ZGC å‡ ä¹åœ¨æ‰€æœ‰åœ°æ–¹å¹¶å‘æ‰§è¡Œçš„ï¼Œé™¤äº†åˆå§‹æ ‡è®°çš„æ˜¯ STw çš„ã€‚æ‰€ä»¥åœé¡¿æ—¶é—´å‡ ä¹å°±è€—è´¹åœ¨åˆå§‹æ ‡è®°ä¸Šï¼Œè¿™éƒ¨åˆ†çš„å®é™…æ—¶é—´æ˜¯éå¸¸å°‘çš„ã€‚</p><p>æµ‹è¯•æ•°æ®ï¼š</p><p><img src=https://logan.1357810.xyz/img/20220422/153020742-e12dc992ac.png width=900 height=600 loading=lazy decoding=async alt=image-20200714091201073 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p><img src=https://logan.1357810.xyz/img/20220422/153020742-e53c20feca.png width=900 height=600 loading=lazy decoding=async alt=image-20200714091401511 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p>åœ¨ ZGC çš„å¼ºé¡¹åœé¡¿æ—¶é—´æµ‹è¯•ä¸Šï¼Œå®ƒæ¯«ä¸ç•™æƒ…çš„å°† Parallelã€G1 æ‹‰å¼€äº†ä¸¤ä¸ªæ•°é‡çº§çš„å·®è·ã€‚æ— è®ºå¹³å‡åœé¡¿ã€95ï¼…åœé¡¿ã€99ï¼…åœé¡¿ã€99.9ï¼…åœé¡¿ï¼Œè¿˜æ˜¯æœ€å¤§åœé¡¿æ—¶é—´ï¼ŒZGC éƒ½èƒ½æ¯«ä¸è´¹åŠ²æ§åˆ¶åœ¨ 10 æ¯«ç§’ä»¥å†…ã€‚</p><p>è™½ç„¶ ZGC è¿˜åœ¨è¯•éªŒçŠ¶æ€ï¼Œæ²¡æœ‰å®Œæˆæ‰€æœ‰ç‰¹æ€§ï¼Œä½†æ­¤æ—¶æ€§èƒ½å·²ç»ç›¸å½“äº®çœ¼ï¼Œç”¨â€œä»¤äººéœ‡æƒŠã€é©å‘½æ€§â€æ¥å½¢å®¹ï¼Œä¸ä¸ºè¿‡ã€‚ <mark>æœªæ¥å°†åœ¨æœåŠ¡ç«¯ã€å¤§å†…å­˜ã€ä½å»¶è¿Ÿåº”ç”¨çš„é¦–é€‰åƒåœ¾æ”¶é›†å™¨ã€‚</mark></p><p><img src=https://logan.1357810.xyz/img/20220422/153020742-00dd18d6cf.png width=900 height=600 loading=lazy decoding=async alt=image-20200714093243028 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p><mark>JEP 364ï¼šZGC åº”ç”¨åœ¨ macos ä¸Š</mark></p><p><mark>JEP 365ï¼šZGC åº”ç”¨åœ¨ Windows ä¸Š</mark></p><p>JDK14 ä¹‹å‰ï¼ŒZGC ä»… Linux æ‰æ”¯æŒã€‚</p><p>å°½ç®¡è®¸å¤šä½¿ç”¨ zGc çš„ç”¨æˆ·éƒ½ä½¿ç”¨ç±» Linux çš„ç¯å¢ƒï¼Œä½†åœ¨ Windows å’Œ macos ä¸Šï¼Œäººä»¬ä¹Ÿéœ€è¦ ZGC è¿›è¡Œå¼€å‘éƒ¨ç½²å’Œæµ‹è¯•ã€‚è®¸å¤šæ¡Œé¢åº”ç”¨ä¹Ÿå¯ä»¥ä» ZGC ä¸­å—ç›Šã€‚å› æ­¤ï¼ŒZGC ç‰¹æ€§è¢«ç§»æ¤åˆ°äº† Windows å’Œ macos ä¸Šã€‚</p><p>ç°åœ¨ mac æˆ– Windows ä¸Šä¹Ÿèƒ½ä½¿ç”¨ zGC äº†ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>-XX:+UnlockExperimentalVMOptions -XX:+UseZGC
</span></span></code></pre></td></tr></table></div></div><ul><li>é¢œè‰²æŒ‡é’ˆ</li><li>æœ‰æµ®åŠ¨åƒåœ¾</li><li>ä¸èƒ½æŒ‡é’ˆå‹ç¼©</li><li>ä½¿ç”¨è¯»å±éšœ</li></ul><p><img src=https://logan.1357810.xyz/img/20220426/1650958056-27a9c5dfbdb846.png width=900 height=600 loading=lazy decoding=async alt=image-20220426152736171 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p><img src=https://logan.1357810.xyz/img/20220426/1650958115-efc12b79d1e299.png width=900 height=600 loading=lazy decoding=async alt=image-20220426152835012 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p>Marked1å’ŒMarked0æ ‡ç¤ºé¢œè‰²</p><p><img src=https://logan.1357810.xyz/img/20220426/1650958184-51295957d0a3f4.png width=900 height=600 loading=lazy decoding=async alt=image-20220426152944578 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><h3 id=13x4-å…¶ä»–åƒåœ¾å›æ”¶å™¨aligc><a href=#13x4-%e5%85%b6%e4%bb%96%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6%e5%99%a8aligc class=header-anchor></a>13.X.4. å…¶ä»–åƒåœ¾å›æ”¶å™¨ï¼šAliGC</h3><p>AliGC æ˜¯é˜¿é‡Œå·´å·´ JVM å›¢é˜ŸåŸºäº G1 ç®—æ³•ï¼Œé¢å‘å¤§å †ï¼ˆLargeHeapï¼‰åº”ç”¨åœºæ™¯ã€‚æŒ‡å®šåœºæ™¯ä¸‹çš„å¯¹æ¯”ï¼š</p><p><img src=https://logan.1357810.xyz/img/20220422/153020742-388379915d.png width=900 height=600 loading=lazy decoding=async alt=image-20200714093604012 class="gallery-image link-image" data-flex-grow=20 data-flex-basis=20px></p><p>å½“ç„¶ï¼Œå…¶å®ƒå‚å•†ä¹Ÿæä¾›äº†å„ç§åˆ«å…·ä¸€æ ¼çš„ GC å®ç°ï¼Œä¾‹å¦‚æ¯”è¾ƒæœ‰åçš„ä½å»¶è¿Ÿ GCï¼šZingï¼Œæœ‰å…´è¶£å¯ä»¥å‚è€ƒæä¾›çš„é“¾æ¥ <a class=link href=https://www.infoq.com/articles/azul_gc_in_detail target=_blank rel=noopener>https://www.infoq.com/articles/azul_gc_in_detail
<span style=white-space:nowrap class="iconfont icon-arrow-up-right-from-square-solid"></span></a></p></section><footer class=article-footer><section class=article-tags><a href=/tags/jvm/>JVM</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>æœ€åæ›´æ–°äº 2024å¹´5æœˆ8æ—¥ 21:39</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/2023/05/11895611/><div class=article-details><h2 class=article-title>01-æ¦‚è¿°ç¯‡</h2></div></a></article><article><a href=/p/2023/05/14915117/><div class=article-details><h2 class=article-title>02-JVMç›‘æ§åŠè¯Šæ–­å·¥å…·-å‘½ä»¤è¡Œç¯‡</h2></div></a></article><article><a href=/p/2023/05/49167k49/><div class=article-details><h2 class=article-title>03-JVMç›‘æ§åŠè¯Šæ–­å·¥å…·-GUIç¯‡</h2></div></a></article><article><a href=/p/2023/05/84511h84/><div class=article-details><h2 class=article-title>03-è¿è¡Œæ—¶æ•°æ®åŒºåŠç¨‹åºè®¡æ•°å™¨</h2></div></a></article><article><a href=/p/2023/05/45117945/><div class=article-details><h2 class=article-title>04-JVMè¿è¡Œæ—¶å‚æ•°</h2></div></a></article></div></div></aside><link rel=preload as=style onload='this.rel="stylesheet"' href=https://cdn.bootcdn.net/ajax/libs/waline/2.15.8/waline.min.css crossorigin=anonymous><script src=https://cdn.bootcdn.net/ajax/libs/waline/2.15.8/waline.min.js crossorigin=anonymous></script><div id=waline class=waline-container></div><style>.waline-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding);--waline-font-size:var(--article-font-size)}.waline-container .wl-count{color:var(--card-text-color-main)}</style><script>Waline.init({copyright:!1,dark:'html[data-scheme="dark"]',el:"#waline",emoji:["https://unpkg.com/@waline/emojis@1.2.0/weibo"],lang:"zh-cn",locale:{admin:"Admin",placeholder:null},requiredMeta:["nick"],serverURL:"https://waline.wssw.fun/",turnstileKey:"0x4AAAAAAAZ2cXI-LS3tIUAh",wordLimit:100})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2024 &nbsp;&nbsp;by &nbsp; logan</section><section class=powerby>å‘è¡¨äº†89ç¯‡æ–‡ç«  Â·
æ€»è®¡567.14kå­—</section><section class=powerby><div class=powerby><span id=busuanzi_container_site_pv>æœ¬ç«™æ€»è®¿é—®é‡<span id=busuanzi_value_site_pv></span>æ¬¡
</span><span id=busuanzi_container_site_uv>æœ¬ç«™è®¿å®¢æ•°<span id=busuanzi_value_site_uv></span>äººæ¬¡</span></div></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div></main></div><script type=text/javascript src=/ts/main.js defer></script><a href=javascript:void(0) class=right_things id=back-to-top title=è¿”å›é¡¶éƒ¨></a><style>html{scroll-behavior:smooth}#back-to-top{z-index:998!important;transition:1.5s ease,opacity 2s ease,visibility 2s ease,right .8s ease;opacity:0;display:inline-block;visibility:hidden;position:fixed;bottom:10px;right:10px;width:55px;height:55px;font-size:30px;text-align:center;line-height:50px;border-radius:20px;box-shadow:var(--shadow-l1);cursor:pointer;color:var(--body-text-color);background-image:linear-gradient(-20deg,#e9defa 0%,#fbfcdb 100%); [data-scheme="dark"] & { background-image: linear-gradient(60deg, #241348 0%, #4d0404 100%); }}#back-to-top:before{content:' ';display:inline-block;position:relative;top:0;transform:rotate(135deg);height:10px;width:10px;border-width:0 0 2px 2px;border-style:solid}#back-to-top:hover{transform:scale(1.1,1.1);background-image:linear-gradient(-225deg,#E3FDF5 0%,#FFE6FA 100%); [data-scheme="dark"] & { background-image: linear-gradient(60deg, #432581 0%, #861818 100%); }}#back-to-top:hover:before{border-color:#2674e0}@media screen and (max-width:768px){#back-to-top{width:35px;height:35px;font-size:10px;right:15px}}</style><script>function resizeRight(){var t=document.querySelectorAll(".right_things"),e=window.innerWidth;t.length>0&&t.forEach(function(t){e>2100?t.style.right="280px":e>1800?t.style.right="120px":e<1800&&(t.style.right="10px")})}window.addEventListener("resize",function(){requestAnimationFrame(resizeRight)});function backToTop(){window.scrollTo({top:0,behavior:"smooth"})}window.onload=function(){requestAnimationFrame(resizeRight);var t=this.document.documentElement.scrollTop||this.document.body.scrollTop,e=this.document.getElementById("back-to-top");t>0?(e.style.visibility="visible",e.style.opacity="1"):(e.style.opacity="0",e.style.visibility="hidden")},window.onscroll=function(){var t=this.document.documentElement.scrollTop||this.document.body.scrollTop,e=this.document.getElementById("back-to-top");t<400?(e.style.opacity="0",e.style.visibility="hidden"):(e.style.visibility="visible",e.style.opacity="1",e.addEventListener("click",backToTop,!1))}</script><style>.toggle-toc-inner,.toggle-toc-inner svg{z-index:1!important;pointer-events:none}.toggle-toc-inner{width:100%;height:100%;display:flex;align-items:center;justify-content:center}.toggle-toc-inner svg{display:none}#toc-container{display:none;position:fixed;bottom:120px;right:80px;padding:5px;border:1px solid #96979a50;border-radius:var(--card-border-radius);box-shadow:rgba(14,30,37,.12)0 2px 4px,rgba(14,30,37,.32)0 2px 16px;z-index:997!important;max-height:80vh;overflow-y:auto;width:auto;max-width:500px;background-image:linear-gradient(-20deg,#e9defa 0%,#fbfcdb 100%); [data-scheme="dark"] & { background-image: linear-gradient(60deg, #241348 0%, #4d0404 100%); color: #FFFFFFB2; }}#TableOfContents{background-image:linear-gradient(-20deg,#e9defa 0%,#fbfcdb 100%); [data-scheme="dark"] & { background-image: linear-gradient(60deg, #241348 0%, #4d0404 100%); }}#TableOfContents a:hover{font-weight:bolder}[data-scheme=dark] #TableOfContents a{color:#ffffffb2}[data-scheme=dark] #TableOfContents a:hover{color:#052ed3}#toggle-toc{transition:1.5s ease,opacity 2s ease,visibility 2s ease,right .8s ease;opacity:0;display:block;visibility:hidden;position:fixed;bottom:75px;right:10px;width:55px;height:55px;font-size:1.7rem;padding:5px;z-index:1000!important;border:0 solid #96979a50;border-radius:20px;box-shadow:var(--shadow-l1);color:#707070;cursor:pointer;background-image:linear-gradient(-20deg,#e9defa 0%,#fbfcdb 100%); [data-scheme="dark"] & { background-image: linear-gradient(60deg, #241348 0%, #4d0404 100%); color: #FFFFFFB2; } animation: jump 0.3s 4;animation-delay:.6s}#toggle-toc:hover{transform:scale(1.1,1.1);background-image:linear-gradient(-225deg,#E3FDF5 0%,#FFE6FA 100%); [data-scheme="dark"] & { background-image: linear-gradient(60deg, #432581 0%, #861818 100%); }}.widget--toc #TableOfContents{overflow-x:auto;max-height:66vh;width:auto}.toggle-toc-inner::before{content:'ç›®å½•'}@media screen and (max-width:1280px){#toc-container{bottom:100px;right:70px;max-width:400px}}@media screen and (max-width:768px){#toggle-toc{width:35px;height:35px;font-size:10px;bottom:60px;right:15px}.toggle-toc-inner::before{content:''}.toggle-toc-inner svg{display:block}#toc-container{bottom:100px;right:60px;max-width:290px}}</style><a id=toggle-toc class=right_things title=ç›®å½• href=javascript:void(0)><div class=toggle-toc-inner><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu-2" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 6h16"/><path d="M4 12h16"/><path d="M4 18h16"/></svg></div></a><section class="widget archives" id=toc-container><h2 class=section-title style=padding-left:10px>ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#13-åƒåœ¾å›æ”¶å™¨>13. åƒåœ¾å›æ”¶å™¨</a><ol><li><a href=#131-gc-åˆ†ç±»ä¸æ€§èƒ½æŒ‡æ ‡>13.1. GC åˆ†ç±»ä¸æ€§èƒ½æŒ‡æ ‡</a><ol><li><a href=#1311-åƒåœ¾å›æ”¶å™¨æ¦‚è¿°>13.1.1. åƒåœ¾å›æ”¶å™¨æ¦‚è¿°</a></li><li><a href=#1312-åƒåœ¾æ”¶é›†å™¨åˆ†ç±»>13.1.2. åƒåœ¾æ”¶é›†å™¨åˆ†ç±»</a></li><li><a href=#1313-è¯„ä¼°-gc-çš„æ€§èƒ½æŒ‡æ ‡>13.1.3. è¯„ä¼° GC çš„æ€§èƒ½æŒ‡æ ‡</a><ol><li><a href=#ååé‡>ååé‡</a></li><li><a href=#æš‚åœæ—¶é—´>æš‚åœæ—¶é—´</a></li><li><a href=#ååé‡-vs-æš‚åœæ—¶é—´>ååé‡ vs æš‚åœæ—¶é—´</a></li></ol></li></ol></li><li><a href=#132-ä¸åŒçš„åƒåœ¾å›æ”¶å™¨æ¦‚è¿°>13.2. ä¸åŒçš„åƒåœ¾å›æ”¶å™¨æ¦‚è¿°</a><ol><li><a href=#1321-åƒåœ¾å›æ”¶å™¨å‘å±•å²>13.2.1. åƒåœ¾å›æ”¶å™¨å‘å±•å²</a></li><li><a href=#1322-7-ç§ç»å…¸çš„åƒåœ¾æ”¶é›†å™¨>13.2.2. 7 ç§ç»å…¸çš„åƒåœ¾æ”¶é›†å™¨</a></li><li><a href=#1323-7-æ¬¾ç»å…¸æ”¶é›†å™¨ä¸åƒåœ¾åˆ†ä»£ä¹‹é—´çš„å…³ç³»>13.2.3. 7 æ¬¾ç»å…¸æ”¶é›†å™¨ä¸åƒåœ¾åˆ†ä»£ä¹‹é—´çš„å…³ç³»</a></li><li><a href=#1324-åƒåœ¾æ”¶é›†å™¨çš„ç»„åˆå…³ç³»>13.2.4. åƒåœ¾æ”¶é›†å™¨çš„ç»„åˆå…³ç³»</a></li><li><a href=#1325-ä¸åŒçš„åƒåœ¾æ”¶é›†å™¨æ¦‚è¿°>13.2.5. ä¸åŒçš„åƒåœ¾æ”¶é›†å™¨æ¦‚è¿°</a></li><li><a href=#1326-å¦‚ä½•æŸ¥çœ‹é»˜è®¤åƒåœ¾æ”¶é›†å™¨>13.2.6. å¦‚ä½•æŸ¥çœ‹é»˜è®¤åƒåœ¾æ”¶é›†å™¨</a></li></ol></li><li><a href=#133-serial-å›æ”¶å™¨ä¸²è¡Œå›æ”¶>13.3. Serial å›æ”¶å™¨ï¼šä¸²è¡Œå›æ”¶</a></li><li><a href=#134-parnew-å›æ”¶å™¨å¹¶è¡Œå›æ”¶>13.4. ParNew å›æ”¶å™¨ï¼šå¹¶è¡Œå›æ”¶</a></li><li><a href=#135-parallel-å›æ”¶å™¨ååé‡ä¼˜å…ˆ>13.5. Parallel å›æ”¶å™¨ï¼šååé‡ä¼˜å…ˆ</a></li><li><a href=#136-cms-å›æ”¶å™¨ä½å»¶è¿Ÿ>13.6. CMS å›æ”¶å™¨ï¼šä½å»¶è¿Ÿ</a><ol><li><a href=#1361-cms-çš„ä¼˜ç‚¹>13.6.1. CMS çš„ä¼˜ç‚¹</a></li><li><a href=#1362-cms-çš„å¼Šç«¯>13.6.2. CMS çš„å¼Šç«¯</a></li><li><a href=#136--ä¸‰è‰²æ ‡è®°>13.6 ä¸‰è‰²æ ‡è®°</a></li></ol></li><li><a href=#61-å†™å±éšœ>6.1 å†™å±éšœ</a></li><li><a href=#62-è¯»å±éšœ>6.2 è¯»å±éšœ</a></li><li><a href=#63-å„ç§åƒåœ¾æ”¶é›†å™¨å¯¹æ¼æ ‡çš„å¤„ç†æ–¹æ¡ˆ>6.3 å„ç§åƒåœ¾æ”¶é›†å™¨å¯¹æ¼æ ‡çš„å¤„ç†æ–¹æ¡ˆ</a></li><li><a href=#64-è®°å¿†é›†å’Œå¡è¡¨>6.4 è®°å¿†é›†å’Œå¡è¡¨</a><ol><li><a href=#1è®°å¿†é›†remember-set>1.è®°å¿†é›†ï¼ˆRemember Setï¼‰</a></li><li><a href=#2å¡è¡¨card-table>2.å¡è¡¨ï¼ˆCard Tableï¼‰</a></li><li><a href=#1363-è®¾ç½®çš„å‚æ•°>13.6.3. è®¾ç½®çš„å‚æ•°</a></li><li><a href=#å°ç»“>å°ç»“</a></li><li><a href=#1364-jdk-åç»­ç‰ˆæœ¬ä¸­-cms-çš„å˜åŒ–>13.6.4. JDK åç»­ç‰ˆæœ¬ä¸­ CMS çš„å˜åŒ–</a></li></ol></li><li><a href=#137-g1-å›æ”¶å™¨åŒºåŸŸåŒ–åˆ†ä»£å¼>13.7. G1 å›æ”¶å™¨ï¼šåŒºåŸŸåŒ–åˆ†ä»£å¼</a><ol><li><a href=#1371-g1-å›æ”¶å™¨çš„ç‰¹ç‚¹ä¼˜åŠ¿>13.7.1. G1 å›æ”¶å™¨çš„ç‰¹ç‚¹ï¼ˆä¼˜åŠ¿ï¼‰</a><ol><li><a href=#å¹¶è¡Œä¸å¹¶å‘>å¹¶è¡Œä¸å¹¶å‘</a></li><li><a href=#åˆ†ä»£æ”¶é›†>åˆ†ä»£æ”¶é›†</a></li><li><a href=#ç©ºé—´æ•´åˆ>ç©ºé—´æ•´åˆ</a></li><li><a href=#å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹å³è½¯å®æ—¶-soft-real-time>å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼ˆå³ï¼šè½¯å®æ—¶ soft real-timeï¼‰</a></li></ol></li><li><a href=#1372-g1-åƒåœ¾æ”¶é›†å™¨çš„ç¼ºç‚¹>13.7.2. G1 åƒåœ¾æ”¶é›†å™¨çš„ç¼ºç‚¹</a></li><li><a href=#1373-g1-å›æ”¶å™¨çš„å‚æ•°è®¾ç½®>13.7.3. G1 å›æ”¶å™¨çš„å‚æ•°è®¾ç½®</a></li><li><a href=#1374-g1-æ”¶é›†å™¨çš„å¸¸è§æ“ä½œæ­¥éª¤>13.7.4. G1 æ”¶é›†å™¨çš„å¸¸è§æ“ä½œæ­¥éª¤</a></li><li><a href=#1375-g1-æ”¶é›†å™¨çš„é€‚ç”¨åœºæ™¯>13.7.5. G1 æ”¶é›†å™¨çš„é€‚ç”¨åœºæ™¯</a></li><li><a href=#1376-åˆ†åŒº-regionåŒ–æ•´ä¸ºé›¶>13.7.6. åˆ†åŒº Regionï¼šåŒ–æ•´ä¸ºé›¶</a></li><li><a href=#1377-g1-åƒåœ¾å›æ”¶å™¨çš„å›æ”¶è¿‡ç¨‹>13.7.7. G1 åƒåœ¾å›æ”¶å™¨çš„å›æ”¶è¿‡ç¨‹</a></li><li><a href=#1378-remembered-set>13.7.8. Remembered Set</a></li><li><a href=#1379-g1-å›æ”¶è¿‡ç¨‹ä¸€å¹´è½»ä»£-gc>13.7.9. G1 å›æ”¶è¿‡ç¨‹ä¸€ï¼šå¹´è½»ä»£ GC</a></li><li><a href=#13710-g1-å›æ”¶è¿‡ç¨‹äºŒå¹¶å‘æ ‡è®°è¿‡ç¨‹>13.7.10. G1 å›æ”¶è¿‡ç¨‹äºŒï¼šå¹¶å‘æ ‡è®°è¿‡ç¨‹</a></li><li><a href=#13711-g1-å›æ”¶è¿‡ç¨‹ä¸‰æ··åˆå›æ”¶>13.7.11. G1 å›æ”¶è¿‡ç¨‹ä¸‰ï¼šæ··åˆå›æ”¶</a></li><li><a href=#13712-g1-å›æ”¶å¯é€‰çš„è¿‡ç¨‹å››full-gc>13.7.12. G1 å›æ”¶å¯é€‰çš„è¿‡ç¨‹å››ï¼šFull GC</a></li><li><a href=#13713-è¡¥å……>13.7.13. è¡¥å……</a></li><li><a href=#13714-g1-å›æ”¶å™¨ä¼˜åŒ–å»ºè®®>13.7.14. G1 å›æ”¶å™¨ä¼˜åŒ–å»ºè®®</a></li></ol></li><li><a href=#138-åƒåœ¾å›æ”¶å™¨æ€»ç»“>13.8. åƒåœ¾å›æ”¶å™¨æ€»ç»“</a><ol><li><a href=#1381-7-ç§ç»å…¸åƒåœ¾å›æ”¶å™¨æ€»ç»“>13.8.1. 7 ç§ç»å…¸åƒåœ¾å›æ”¶å™¨æ€»ç»“</a></li><li><a href=#1382-åƒåœ¾å›æ”¶å™¨ç»„åˆ>13.8.2. åƒåœ¾å›æ”¶å™¨ç»„åˆ</a></li><li><a href=#1383-æ€ä¹ˆé€‰æ‹©åƒåœ¾å›æ”¶å™¨>13.8.3. æ€ä¹ˆé€‰æ‹©åƒåœ¾å›æ”¶å™¨</a></li></ol></li><li><a href=#139-gc-æ—¥å¿—åˆ†æ>13.9. GC æ—¥å¿—åˆ†æ</a><ol><li><a href=#minor-gc-æ—¥å¿—>Minor GC æ—¥å¿—</a></li><li><a href=#full-gc-æ—¥å¿—>Full GC æ—¥å¿—</a></li></ol></li><li><a href=#13x-åƒåœ¾å›æ”¶å™¨çš„æ–°å‘å±•>13.X. åƒåœ¾å›æ”¶å™¨çš„æ–°å‘å±•</a><ol><li><a href=#13x1-jdk11-æ–°ç‰¹æ€§>13.X.1. JDK11 æ–°ç‰¹æ€§</a></li><li><a href=#13x2-open-jdk12-çš„-shenandoash-gc>13.X.2. Open JDK12 çš„ Shenandoash GC</a></li><li><a href=#13x3-ä»¤äººéœ‡æƒŠé©å‘½æ€§çš„-zgc>13.X.3. ä»¤äººéœ‡æƒŠã€é©å‘½æ€§çš„ ZGC</a></li><li><a href=#13x4-å…¶ä»–åƒåœ¾å›æ”¶å™¨aligc>13.X.4. å…¶ä»–åƒåœ¾å›æ”¶å™¨ï¼šAliGC</a></li></ol></li></ol></li></ol></nav></div></section><script>var toggleButton=document.getElementById("toggle-toc"),tocContainer=document.getElementById("toc-container"),scrollThreshold=400;function extracted(){var e=window.scrollY||window.pageYOffset;e>=scrollThreshold?(toggleButton.style.visibility="visible",toggleButton.style.opacity="1"):(toggleButton.style.opacity="0",toggleButton.style.visibility="hidden")}window.addEventListener("scroll",function(){extracted()}),window.onload=function(){extracted()},toggleButton.addEventListener("click",function(e){tocContainer.style.display==="none"||tocContainer.style.display===""?tocContainer.style.display="block":tocContainer.style.display="none",e.stopPropagation()}),"ontouchstart"in window||toggleButton.addEventListener("mouseover",function(){tocContainer.style.display="block"}),document.addEventListener("click",function(e){!tocContainer.contains(e.target)&&!toggleButton.contains(e.target)&&e.target!==toggleButton&&e.target!==tocContainer&&(tocContainer.style.display="none")})</script><script>var bszCaller,bszTag;!function(){var e,s,o,t=!1,n=[];ready=function(e){return t||"interactive"===document.readyState||"complete"===document.readyState?e.call(document):n.push(function(){return e.call(this)}),this},o=function(){for(var e=0,t=n.length;t>e;e++)n[e].apply(document);n=[]},e=function(){t||(t=!0,o.call(window),document.removeEventListener?document.removeEventListener("DOMContentLoaded",e,!1):document.attachEvent&&(document.detachEvent("onreadystatechange",e),window==window.top&&(clearInterval(s),s=null)))},document.addEventListener?document.addEventListener("DOMContentLoaded",e,!1):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){/loaded|complete/.test(document.readyState)&&e()}),window==window.top&&(s=setInterval(function(){try{t||document.documentElement.doScroll("left")}catch{return}e()},5)))}(),bszCaller={fetch:function(e,t){var n="BusuanziCallback_"+Math.floor(1099511627776*Math.random());window[n]=this.evalCall(t),e=e.replace("=BusuanziCallback","="+n),scriptTag=document.createElement("SCRIPT"),scriptTag.type="text/javascript",scriptTag.defer=!0,scriptTag.src=e,scriptTag.referrerPolicy="no-referrer-when-downgrade",document.getElementsByTagName("HEAD")[0].appendChild(scriptTag)},evalCall:function(e){return function(t){ready(function(){try{e(t),scriptTag.parentElement.removeChild(scriptTag)}catch{bszTag.hides()}})}}},bszCaller.fetch("//busuanzi.ibruce.info/busuanzi?jsonpCallback=BusuanziCallback",function(e){bszTag.texts(e),bszTag.shows()}),bszTag={bszs:["site_pv","page_pv","site_uv"],texts:function(e){this.bszs.map(function(t){var n=document.getElementById("busuanzi_value_"+t);n&&(n.innerHTML=e[t])})},hides:function(){this.bszs.map(function(e){var t=document.getElementById("busuanzi_container_"+e);t&&(t.style.display="none")})},shows:function(){this.bszs.map(function(e){var t=document.getElementById("busuanzi_container_"+e);t&&(t.style.display="inline")})}}</script><script>function loadScript(e,t){var n=document.querySelector('script[src="'+e+'"]'),s=!1;n.onload=function(){s||(s=!0,t&&window[t]())},n.onreadystatechange=function(){!s&&(n.readyState==="loaded"||n.readyState==="complete")&&(s=!0,t&&window[t]())}}</script></body></html>