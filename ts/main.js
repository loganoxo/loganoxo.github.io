(()=>{var y=class e{galleryUID;items=[];constructor(t,o=1){if(window.PhotoSwipe==null||window.PhotoSwipeUI_Default==null){console.error("PhotoSwipe lib not loaded.");return}this.galleryUID=o,this.loadItems(t),this.bindClick()}loadItems(t){this.items=[];let o=t.querySelectorAll("figure.gallery-image");for(let n of o){let i=n.querySelector("figcaption"),l=n.querySelector("img"),r={w:parseInt(l.getAttribute("width")),h:parseInt(l.getAttribute("height")),src:l.src,msrc:l.getAttribute("data-thumb")||l.src,el:n,ifLink:l.classList.contains("link-image"),imgEl:l};i&&(r.title=i.innerHTML),this.items.push(r)}}bindClick(){for(let[t,o]of this.items.entries())o.ifLink?this.linkImg(o.imgEl,t):(o.w=o.w*3,o.h=o.h*3,o.el.querySelector("a").addEventListener("click",i=>{i.preventDefault(),this.open(t)}))}open(t){let o=document.querySelector(".pswp");new window.PhotoSwipe(o,window.PhotoSwipeUI_Default,this.items,{index:t,galleryUID:this.galleryUID,closeOnScroll:!1,getThumbBoundsFn:i=>{let l=this.items[i].el.getElementsByTagName("img")[0],r=window.pageYOffset||document.documentElement.scrollTop,a=l.getBoundingClientRect();return{x:a.left,y:a.top+r,w:a.width}}}).init()}linkImg(t,o){t.classList.contains("link-image")&&(t.addEventListener("error",n=>{this.linkImgHandle(n.target,o)}),t.complete?this.linkImgHandle(t,o):t.addEventListener("load",n=>{this.linkImgHandle(n.target,o)}))}linkImgHandle(t,o){let n=20,i=20,l=t.naturalWidth,r=t.naturalHeight;t.width=l,t.height=r,l!==0&&r!==0&&(n=Math.round(l*100/r),i=Math.round(l*240/r)),t.setAttribute("data-flex-grow",`${n}`),t.setAttribute("data-flex-basis",`${i}px`);let a=this.findNearestAnchor(t);a.style.setProperty("flex-grow",`${n}`),a.style.setProperty("flex-basis",`${i}px`),this.items[o].w=l*3,this.items[o].h=r*3,this.items[o].el.querySelector("a").addEventListener("click",d=>{d.preventDefault(),this.open(o)})}findNearestAnchor(t){for(let o=0;o<3&&t.parentElement;o++)if(t=t.parentElement,t.tagName.toLowerCase()==="figure"&&t.classList.contains("gallery-image"))return t;return null}static createGallery(t){let o=t.querySelectorAll("img.gallery-image");for(let l of Array.from(o)){let r=l.closest("p");if(!r||!t.contains(r))continue;r.textContent.trim()==""&&r.classList.add("no-text");let a=r.classList.contains("no-text"),u=l.parentElement.tagName=="A",d=l,c=document.createElement("figure");if(c.style.setProperty("flex-grow",l.getAttribute("data-flex-grow")||"1"),c.style.setProperty("flex-basis",l.getAttribute("data-flex-basis")||"0"),u&&(d=l.parentElement),d.parentElement.insertBefore(c,d),c.appendChild(d),l.hasAttribute("alt")){let s=document.createElement("figcaption");s.innerText=l.getAttribute("alt"),c.appendChild(s)}if(!u){c.className="gallery-image";let s=document.createElement("a");s.href=l.src,s.setAttribute("target","_blank"),l.parentNode.insertBefore(s,l),s.appendChild(l)}}let n=t.querySelectorAll("figure.gallery-image"),i=[];for(let l of n)i.length?l.previousElementSibling===i[i.length-1]?i.push(l):i.length&&(e.wrap(i),i=[l]):i=[l];i.length>0&&e.wrap(i)}static wrap(t){let o=document.createElement("div");o.className="gallery";let n=t[0].parentNode,i=t[0];n.insertBefore(o,i);for(let l of t)o.appendChild(l)}},g=y;var m,k=()=>{document.querySelectorAll(".article-content div.logan-code-block").forEach(t=>{W(t),O(t),N(t)})},N=e=>{let t=250;e.querySelector("button.my-code-fold").addEventListener("click",n=>{let i=n.target,r=f(i).querySelector(".chroma"),a=r.clientHeight;i.classList.contains("expand1")?r.clientHeight>t?(r.style.height=`${t}px`,r.style.overflowY="auto",i.classList.remove("expand1"),i.classList.add("expand2")):(r.style.height="0px",r.style.overflowY="hidden",i.classList.remove("expand1"),i.classList.add("expand3")):i.classList.contains("expand2")?(r.style.height="0px",r.style.overflowY="hidden",i.classList.remove("expand2"),i.classList.add("expand3")):i.classList.contains("expand3")&&(r.style.height="100%",r.style.overflowY="auto",i.classList.remove("expand3"),i.classList.add("expand1"))})},O=e=>{let t=e.querySelector("button.copy-code-button"),o=e.querySelector("div.copy-text");t.addEventListener("click",n=>{let i=n.target,r=f(i).querySelector("code[data-lang]");r&&(navigator.clipboard?navigator.clipboard.writeText(r.textContent).then(()=>{o.style.opacity="1",setTimeout(()=>{o.style.opacity="0"},1e3)}).catch(a=>{alert(a),console.log("Something went wrong",a)}):R(r.textContent,function(){o.style.opacity="1",setTimeout(()=>{o.style.opacity="0"},1e3)},function(a){alert(a.message),console.log("Something went wrong",a.message)}))})},W=e=>{let t=e.querySelector("button.code-scroll-left"),o=e.querySelector("button.code-scroll-right");t.addEventListener("mousedown",L),o.addEventListener("mousedown",T),t.addEventListener("mouseup",h),o.addEventListener("mouseup",h),document.addEventListener("mouseup",x),t.addEventListener("touchstart",L),o.addEventListener("touchstart",T),t.addEventListener("touchend",h),o.addEventListener("touchend",h),document.addEventListener("touchend",x)};function L(e){if(h(e),e.type==="mousedown"){if(e.button!=0)return}else e.type;let t=e.target,o=f(t),n=o.querySelector(".chroma .lntable>tbody>tr>td:last-child>pre");n||(n=o.querySelector("pre.chroma")),n&&(m=setInterval(function(){n.scrollBy({left:-5})},20))}function T(e){if(h(e),e.type==="mousedown"){if(e.button!=0)return}else e.type;let t=e.target,o=f(t),n=o.querySelector(".chroma .lntable>tbody>tr>td:last-child>pre");n||(n=o.querySelector("pre.chroma")),n&&(m=setInterval(function(){n.scrollBy({left:5})},20))}function h(e){m&&(e.preventDefault(),clearInterval(m),m=null)}function x(e){m&&(clearInterval(m),m=null)}function f(e){for(let t=0;t<4&&e.parentElement;t++)if(e=e.parentElement,e.tagName.toLowerCase()==="div"&&e.classList.contains("logan-code-block"))return e;return null}function R(e,t,o){let n=document.createElement("textarea");n.style.cssText="position: absolute; left: -9999px; opacity: 0;",n.value=e,document.body.appendChild(n),n.select();try{document.execCommand("copy")?typeof t=="function"&&t():typeof o=="function"&&o(new Error("\u590D\u5236\u5931\u8D25"))}catch(i){typeof o=="function"&&o(i)}document.body.removeChild(n)}var Y=(e,t=500)=>{e.classList.add("transiting"),e.style.transitionProperty="height, margin, padding",e.style.transitionDuration=t+"ms",e.style.height=e.offsetHeight+"px",e.offsetHeight,e.style.overflow="hidden",e.style.height="0",e.style.paddingTop="0",e.style.paddingBottom="0",e.style.marginTop="0",e.style.marginBottom="0",window.setTimeout(()=>{e.classList.remove("show"),e.style.removeProperty("height"),e.style.removeProperty("padding-top"),e.style.removeProperty("padding-bottom"),e.style.removeProperty("margin-top"),e.style.removeProperty("margin-bottom"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property"),e.classList.remove("transiting")},t)},U=(e,t=500)=>{e.classList.add("transiting"),e.style.removeProperty("display"),e.classList.add("show");let o=e.offsetHeight;e.style.overflow="hidden",e.style.height="0",e.style.paddingTop="0",e.style.paddingBottom="0",e.style.marginTop="0",e.style.marginBottom="0",e.offsetHeight,e.style.transitionProperty="height, margin, padding",e.style.transitionDuration=t+"ms",e.style.height=o+"px",e.style.removeProperty("padding-top"),e.style.removeProperty("padding-bottom"),e.style.removeProperty("margin-top"),e.style.removeProperty("margin-bottom"),window.setTimeout(()=>{e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property"),e.classList.remove("transiting")},t)},_=(e,t=500)=>window.getComputedStyle(e).display==="none"?U(e,t):Y(e,t);function M(){let e=document.getElementById("toggle-menu");e&&e.addEventListener("click",()=>{document.getElementById("main-menu").classList.contains("transiting")||(document.body.classList.toggle("show-menu"),_(document.getElementById("main-menu"),300),e.classList.toggle("is-active"))})}function G(e,t,o){var n=document.createElement(e);for(let i in t)if(i&&t.hasOwnProperty(i)){let l=t[i];i=="dangerouslySetInnerHTML"?n.innerHTML=l.__html:l===!0?n.setAttribute(i,i):l!==!1&&l!=null&&n.setAttribute(i,l.toString())}for(let i=2;i<arguments.length;i++){let l=arguments[i];l&&n.appendChild(l.nodeType==null?document.createTextNode(l.toString()):l)}return n}var H=G;function Q(){let e=document.querySelector("body"),t=e.firstChild,o=document.createElement("canvas");return e.insertBefore(o,t.nextSibling),o.style.cssText="position: fixed;top: 0;left: 0; width: 100%;height: 100%;pointer-events: none;z-index:2000;",o}function E(...e){let t=e.reduce((o,n)=>o+n*n,0);return Math.sqrt(t)}function v(e,t){let o=Q(),n=o.getContext("2d");o.width=window.innerWidth,o.height=window.innerHeight;let i=e.clientX,l=e.clientY,a=E(Math.max(i,o.width-i),Math.max(l,o.height-l)),u=25,d=function(){n.clearRect(0,0,o.width,o.height);let s=n.createRadialGradient(i,l,0,i,l,a);t?(s.addColorStop(0,"rgba(0,0,0,0.8)"),s.addColorStop(.2,"#464646"),s.addColorStop(.6,"#a2a2a2"),s.addColorStop(1,"#FFFFFF")):(s.addColorStop(1,"rgb(16,16,16)"),s.addColorStop(.6,"#5e5e5e"),s.addColorStop(.3,"#a2a2a2"),s.addColorStop(0,"rgba(255,255,255,0)")),n.beginPath(),n.arc(i,l,a,0,Math.PI*2),n.fillStyle=s,n.fill(),n.closePath(),a-=u,a<=0?(cancelAnimationFrame(c),o.remove()):c=requestAnimationFrame(d)},c=requestAnimationFrame(d)}var w=class e{localStorageKey="StackColorScheme";currentScheme;systemPreferScheme;ifMine;isClick=!1;changeCount=0;static ScrollPosition=0;static ScrollType=0;constructor(t,o){this.ifMine=o,this.currentScheme=this.getSavedScheme(),this.systemPreferScheme=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",o||(this.bindMatchMedia(),this.dispatchEvent(document.documentElement.dataset.scheme),document.body.style.transition==""&&document.body.style.setProperty("transition","background-color .3s ease")),t&&this.bindClick(t)}static disableScroll(){document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden"}static enableScroll(){document.body.style.overflow="",document.documentElement.style.overflow=""}saveScheme(){localStorage.setItem(this.localStorageKey,this.currentScheme)}bindClick(t){t.addEventListener("click",o=>{if(!this.isClick){if(this.isClick=!0,!this.ifMine){let n=document.getElementById("toggle-menu");n&&n.classList.contains("is-active")&&n.click()}this.currentScheme=this.getSavedScheme(),this.isDark()?this.currentScheme="light":this.currentScheme="dark",this.clip(this.setBodyClass,o),this.currentScheme==this.systemPreferScheme&&(this.currentScheme="auto"),this.saveScheme(),setTimeout(()=>{this.isClick=!1},2e3)}})}isDark(){return this.currentScheme=="dark"||this.currentScheme=="auto"&&this.systemPreferScheme=="dark"}dispatchEvent(t){let o=new CustomEvent("onColorSchemeChange",{detail:t});window.dispatchEvent(o)}setBodyClass(){this.isDark()?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light",this.dispatchEvent(document.documentElement.dataset.scheme)}getSavedScheme(){let t=localStorage.getItem(this.localStorageKey);return t=="light"||t=="dark"||t=="auto"?t:"auto"}bindMatchMedia(){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{t.matches?this.systemPreferScheme="dark":this.systemPreferScheme="light",this.currentScheme=this.getSavedScheme(),this.setBodyClass()})}clip(t,o){let n=o.clientX,i=o.clientY,l=E(Math.max(n,innerWidth-n),Math.max(i,innerHeight-i));document.startViewTransition?(this.changeCount%4===0||this.changeCount%4===1?this.preloadingForTheme(t):(document.documentElement.style.setProperty("--x",n+"px"),document.documentElement.style.setProperty("--y",i+"px"),document.documentElement.style.setProperty("--r",l+"px"),document.startViewTransition(()=>{t.call(this)})),this.changeCount==3?this.changeCount=0:this.changeCount++):window.Preloading?this.preloadingForTheme(t):this.currentScheme==="light"?(t.call(this),v(o,!1)):(t.call(this),v(o,!0))}preloadingForTheme(t){window.Preloading.hide(),window.Preloading.setLoading("\u5207\u6362\u4E2D...",""),requestAnimationFrame(()=>{window.Preloading.showWithoutClock(),e.disableScroll(),setTimeout(()=>{t.call(this),setTimeout(()=>{e.enableScroll(),window.Preloading.loaded(),window.Preloading.resetLoading("")},1e3)},500)})}},S=w;function p(e){let t;return()=>{t&&window.cancelAnimationFrame(t),t=window.requestAnimationFrame(()=>e())}}var X=".article-content h1[id], .article-content h2[id], .article-content h3[id], .article-content h4[id], .article-content h5[id], .article-content h6[id]",C="#TableOfContents",P="#TableOfContents li",I="active-class";function z(e,t){let o=e.querySelector("a").offsetHeight,n=e.offsetTop-t.offsetHeight/2+o/2-t.offsetTop;n<0&&(n=0),t.scrollTo({top:n,behavior:"smooth"})}function K(e){let t={};return e.forEach(o=>{let i=o.querySelector("a").getAttribute("href");i.startsWith("#")&&(t[i.slice(1)]=o)}),t}function A(e){let t=[];return e.forEach(o=>{t.push({id:o.id,offset:o.offsetTop})}),t.sort((o,n)=>o.offset-n.offset),t}function q(){let e=document.querySelectorAll(X);if(!e){console.warn("No header matched query",e);return}let t=document.querySelector(C);if(!t){console.warn("No toc matched query",C);return}let o=document.querySelectorAll(P);if(!o){console.warn("No navigation matched query",P);return}let n=A(e),i=!1;t.addEventListener("mouseenter",p(()=>i=!0)),t.addEventListener("mouseleave",p(()=>i=!1));let l,r=K(o);function a(){let d=document.documentElement.scrollTop||document.body.scrollTop,c;n.forEach(b=>{d>=b.offset-20&&(c=document.getElementById(b.id))});let s;c&&(s=r[c.id]),c&&!s?console.debug("No link found for section",c):s!==l&&(l&&l.classList.remove(I),s&&(s.classList.add(I),i||z(s,t)),l=s)}window.addEventListener("scroll",p(a));function u(){n=A(e),a()}window.addEventListener("resize",p(u))}var V="a[href]";function B(){document.querySelectorAll(V).forEach(e=>{e.getAttribute("href").startsWith("#")&&e.addEventListener("click",o=>{o.preventDefault();let n=decodeURI(e.getAttribute("href").substring(1)),i=document.getElementById(n),l=i.getBoundingClientRect().top-document.documentElement.getBoundingClientRect().top;window.history.pushState({},"",e.getAttribute("href")),scrollTo({top:l,behavior:"smooth"})})})}var $=function(){window.addEventListener("load",()=>{})},F=$;var D={init:()=>{M();let e=document.querySelector(".article-content");if(e){g.createGallery(e);let t=e.querySelectorAll("div.gallery");for(let o=0;o<t.length;o++){let n=t[o];new g(n,o)}B(),q()}k(),new S(document.getElementById("dark-mode-toggle"),!1),new S(document.getElementById("dark-mode-toggle-mine"),!0)}};F();window.addEventListener("load",()=>{setTimeout(function(){D.init()},0)});window.Stack=D;window.createElement=H;})();
/*!
*  页面加载后执行的js操作
*/
/*!
*   Hugo Theme Stack
*
*   @author: Jimmy Cai
*   @website: https://jimmycai.com
*   @link: https://github.com/CaiJimmy/hugo-theme-stack
*/
