(()=>{var y=class t{galleryUID;items=[];constructor(e,n=1){if(window.PhotoSwipe==null||window.PhotoSwipeUI_Default==null){console.error("PhotoSwipe lib not loaded.");return}this.galleryUID=n,this.loadItems(e),this.bindClick(),this.renderHyperlinkImg(e)}loadItems(e){this.items=[];let n=e.querySelectorAll("figure.gallery-image");for(let i of n){let o=i.querySelector("figcaption"),l=i.querySelector("img"),r={w:parseInt(l.getAttribute("width")),h:parseInt(l.getAttribute("height")),src:l.src,msrc:l.getAttribute("data-thumb")||l.src,el:i,ifLink:l.classList.contains("link-image"),imgEl:l};o&&(r.title=o.innerHTML),this.items.push(r)}}bindClick(){for(let[e,n]of this.items.entries())n.ifLink?this.linkImg(n.imgEl,e,!1):(n.w=n.w*3,n.h=n.h*3,n.el.querySelector("a").addEventListener("click",o=>{o.preventDefault(),this.open(e)}))}open(e){let n=document.querySelector(".pswp");new window.PhotoSwipe(n,window.PhotoSwipeUI_Default,this.items,{index:e,galleryUID:this.galleryUID,closeOnScroll:!1,getThumbBoundsFn:o=>{let l=this.items[o].el.getElementsByTagName("img")[0],r=window.pageYOffset||document.documentElement.scrollTop,a=l.getBoundingClientRect();return{x:a.left,y:a.top+r,w:a.width}}}).init()}renderHyperlinkImg(e){let n=e.querySelectorAll("figure.image-hyperlink-figure");for(let i of n){let o=i.querySelector("img");o.classList.contains("link-image")&&this.linkImg(o,null,!0)}}linkImg(e,n,i){e.classList.contains("link-image")&&(e.addEventListener("error",o=>{this.linkImgHandle(o.target,n,i)}),e.complete?this.linkImgHandle(e,n,i):e.addEventListener("load",o=>{this.linkImgHandle(o.target,n,i)}))}linkImgHandle(e,n,i){let o=20,l=20,r=e.naturalWidth,a=e.naturalHeight;e.width=r,e.height=a,r!==0&&a!==0&&(o=Math.round(r*100/a),l=Math.round(r*240/a)),e.setAttribute("data-flex-grow",`${o}`),e.setAttribute("data-flex-basis",`${l}px`);let d=this.findNearestAnchor(e);d.style.setProperty("flex-grow",`${o}`),d.style.setProperty("flex-basis",`${l}px`),i||(this.items[n].w=r*3,this.items[n].h=a*3,this.items[n].el.querySelector("a").addEventListener("click",c=>{c.preventDefault(),this.open(n)}))}findNearestAnchor(e){for(let n=0;n<3&&e.parentElement;n++)if(e=e.parentElement,e.tagName.toLowerCase()==="figure"&&e.classList.contains("all-logan-image"))return e;return null}static createGallery(e){let n=e.querySelectorAll("img.gallery-image");for(let l of Array.from(n)){let r=l.closest("p");if(!r||!e.contains(r))continue;r.textContent.trim()==""&&r.classList.add("no-text");let a=r.classList.contains("no-text"),d=l.parentElement.tagName=="A",m=l,c=document.createElement("figure");if(c.style.setProperty("flex-grow",l.getAttribute("data-flex-grow")||"1"),c.style.setProperty("flex-basis",l.getAttribute("data-flex-basis")||"0"),d&&(m=l.parentElement),m.parentElement.insertBefore(c,m),c.appendChild(m),l.hasAttribute("alt")){let s=document.createElement("figcaption");if(!d)s.innerText=l.getAttribute("alt"),c.appendChild(s);else if(m.classList.contains("link")){let h=document.createElement("a");h.className="link",h.innerText=l.getAttribute("alt")+" ";let N=m.querySelector("span.link-text");h.appendChild(N),s.appendChild(h),c.appendChild(s)}}if(c.classList.add("all-logan-image"),d)c.classList.add("image-hyperlink-figure");else{c.classList.add("gallery-image");let s=document.createElement("a");s.href=l.src,s.setAttribute("target","_blank"),l.parentNode.insertBefore(s,l),s.appendChild(l)}}let i=e.querySelectorAll("figure.all-logan-image"),o=[];for(let l of i)o.length?l.previousElementSibling===o[o.length-1]?o.push(l):o.length&&(t.wrap(o),o=[l]):o=[l];o.length>0&&t.wrap(o)}static wrap(e){let n=document.createDocumentFragment(),i=document.createElement("div");i.className="gallery";let o=e[0].parentNode,l=e[0];o.insertBefore(i,l);for(let r of e)n.appendChild(r);i.appendChild(n)}},E=y;var u,x=()=>{document.querySelectorAll(".article-content div.logan-code-block").forEach(e=>{R(e),W(e),O(e)})},O=t=>{let e=250;t.querySelector("button.my-code-fold").addEventListener("click",i=>{let o=i.target,r=p(o).querySelector(".chroma"),a=r.clientHeight;if(o.classList.contains("expand1"))if(r.clientHeight>e){let d=Math.ceil(r.clientHeight/2);d>e&&(d=e),r.style.height=`${d}px`,r.style.overflowY="auto",o.classList.remove("expand1"),o.classList.add("expand2")}else r.style.height="0px",r.style.overflowY="hidden",o.classList.remove("expand1"),o.classList.add("expand3");else o.classList.contains("expand2")?(r.style.height="0px",r.style.overflowY="hidden",o.classList.remove("expand2"),o.classList.add("expand3")):o.classList.contains("expand3")&&(r.style.height="100%",r.style.overflowY="auto",o.classList.remove("expand3"),o.classList.add("expand1"))})},W=t=>{let e=t.querySelector("button.copy-code-button"),n=t.querySelector("div.copy-text");e.addEventListener("click",i=>{let o=i.target,r=p(o).querySelector("code[data-lang]");r&&(navigator.clipboard?navigator.clipboard.writeText(r.textContent).then(()=>{n.style.opacity="1",setTimeout(()=>{n.style.opacity="0"},1e3)}).catch(a=>{alert(a),console.log("Something went wrong",a)}):Y(r.textContent,function(){n.style.opacity="1",setTimeout(()=>{n.style.opacity="0"},1e3)},function(a){alert(a.message),console.log("Something went wrong",a.message)}))})},R=t=>{let e=t.querySelector("button.code-scroll-left"),n=t.querySelector("button.code-scroll-right");e.addEventListener("mousedown",b),n.addEventListener("mousedown",T),e.addEventListener("mouseup",f),n.addEventListener("mouseup",f),document.addEventListener("mouseup",k),e.addEventListener("touchstart",b),n.addEventListener("touchstart",T),e.addEventListener("touchend",f),n.addEventListener("touchend",f),document.addEventListener("touchend",k)};function b(t){if(f(t),t.type==="mousedown"){if(t.button!=0)return}else t.type;let e=t.target,n=p(e),i=n.querySelector(".chroma .lntable>tbody>tr>td:last-child>pre");i||(i=n.querySelector("pre.chroma")),i&&(u=setInterval(function(){i.scrollBy({left:-5})},20))}function T(t){if(f(t),t.type==="mousedown"){if(t.button!=0)return}else t.type;let e=t.target,n=p(e),i=n.querySelector(".chroma .lntable>tbody>tr>td:last-child>pre");i||(i=n.querySelector("pre.chroma")),i&&(u=setInterval(function(){i.scrollBy({left:5})},20))}function f(t){u&&(t.preventDefault(),clearInterval(u),u=null)}function k(t){u&&(clearInterval(u),u=null)}function p(t){for(let e=0;e<4&&t.parentElement;e++)if(t=t.parentElement,t.tagName.toLowerCase()==="div"&&t.classList.contains("logan-code-block"))return t;return null}function Y(t,e,n){let i=document.createElement("textarea");i.style.cssText="position: absolute; left: -9999px; opacity: 0;",i.value=t,document.body.appendChild(i),i.select();try{document.execCommand("copy")?typeof e=="function"&&e():typeof n=="function"&&n(new Error("\u590D\u5236\u5931\u8D25"))}catch(o){typeof n=="function"&&n(o)}document.body.removeChild(i)}var U=(t,e=500)=>{t.classList.add("transiting"),t.style.transitionProperty="height, margin, padding",t.style.transitionDuration=e+"ms",t.style.height=t.offsetHeight+"px",t.offsetHeight,t.style.overflow="hidden",t.style.height="0",t.style.paddingTop="0",t.style.paddingBottom="0",t.style.marginTop="0",t.style.marginBottom="0",window.setTimeout(()=>{t.classList.remove("show"),t.style.removeProperty("height"),t.style.removeProperty("padding-top"),t.style.removeProperty("padding-bottom"),t.style.removeProperty("margin-top"),t.style.removeProperty("margin-bottom"),t.style.removeProperty("overflow"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property"),t.classList.remove("transiting")},e)},_=(t,e=500)=>{t.classList.add("transiting"),t.style.removeProperty("display"),t.classList.add("show");let n=t.offsetHeight;t.style.overflow="hidden",t.style.height="0",t.style.paddingTop="0",t.style.paddingBottom="0",t.style.marginTop="0",t.style.marginBottom="0",t.offsetHeight,t.style.transitionProperty="height, margin, padding",t.style.transitionDuration=e+"ms",t.style.height=n+"px",t.style.removeProperty("padding-top"),t.style.removeProperty("padding-bottom"),t.style.removeProperty("margin-top"),t.style.removeProperty("margin-bottom"),window.setTimeout(()=>{t.style.removeProperty("height"),t.style.removeProperty("overflow"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property"),t.classList.remove("transiting")},e)},G=(t,e=500)=>window.getComputedStyle(t).display==="none"?_(t,e):U(t,e);function M(){let t=document.getElementById("toggle-menu");t&&t.addEventListener("click",()=>{document.getElementById("main-menu").classList.contains("transiting")||(document.body.classList.toggle("show-menu"),G(document.getElementById("main-menu"),300),t.classList.toggle("is-active"))})}function Q(t,e,n){var i=document.createElement(t);for(let o in e)if(o&&e.hasOwnProperty(o)){let l=e[o];o=="dangerouslySetInnerHTML"?i.innerHTML=l.__html:l===!0?i.setAttribute(o,o):l!==!1&&l!=null&&i.setAttribute(o,l.toString())}for(let o=2;o<arguments.length;o++){let l=arguments[o];l&&i.appendChild(l.nodeType==null?document.createTextNode(l.toString()):l)}return i}var C=Q;function X(){let t=document.querySelector("body"),e=t.firstChild,n=document.createElement("canvas");return t.insertBefore(n,e.nextSibling),n.style.cssText="position: fixed;top: 0;left: 0; width: 100%;height: 100%;pointer-events: none;z-index:2000;",n}function v(...t){let e=t.reduce((n,i)=>n+i*i,0);return Math.sqrt(e)}function w(t,e){let n=X(),i=n.getContext("2d");n.width=window.innerWidth,n.height=window.innerHeight;let o=t.clientX,l=t.clientY,a=v(Math.max(o,n.width-o),Math.max(l,n.height-l)),d=25,m=function(){i.clearRect(0,0,n.width,n.height);let s=i.createRadialGradient(o,l,0,o,l,a);e?(s.addColorStop(0,"rgba(0,0,0,0.8)"),s.addColorStop(.2,"#464646"),s.addColorStop(.6,"#a2a2a2"),s.addColorStop(1,"#FFFFFF")):(s.addColorStop(1,"rgb(16,16,16)"),s.addColorStop(.6,"#5e5e5e"),s.addColorStop(.3,"#a2a2a2"),s.addColorStop(0,"rgba(255,255,255,0)")),i.beginPath(),i.arc(o,l,a,0,Math.PI*2),i.fillStyle=s,i.fill(),i.closePath(),a-=d,a<=0?(cancelAnimationFrame(c),n.remove()):c=requestAnimationFrame(m)},c=requestAnimationFrame(m)}var S=class t{localStorageKey="StackColorScheme";currentScheme;systemPreferScheme;ifMine;isClick=!1;changeCount=0;static ScrollPosition=0;static ScrollType=0;constructor(e,n){this.ifMine=n,this.currentScheme=this.getSavedScheme(),this.systemPreferScheme=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",n||(this.bindMatchMedia(),this.dispatchEvent(document.documentElement.dataset.scheme),document.body.style.transition==""&&document.body.style.setProperty("transition","background-color .3s ease")),e&&this.bindClick(e)}static disableScroll(){document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden"}static enableScroll(){document.body.style.overflow="",document.documentElement.style.overflow=""}saveScheme(){localStorage.setItem(this.localStorageKey,this.currentScheme)}bindClick(e){e.addEventListener("click",n=>{if(!this.isClick){if(this.isClick=!0,!this.ifMine){let i=document.getElementById("toggle-menu");i&&i.classList.contains("is-active")&&i.click()}this.currentScheme=this.getSavedScheme(),this.isDark()?this.currentScheme="light":this.currentScheme="dark",this.clip(this.setBodyClass,n),this.currentScheme==this.systemPreferScheme&&(this.currentScheme="auto"),this.saveScheme(),setTimeout(()=>{this.isClick=!1},2e3)}})}isDark(){return this.currentScheme=="dark"||this.currentScheme=="auto"&&this.systemPreferScheme=="dark"}dispatchEvent(e){let n=new CustomEvent("onColorSchemeChange",{detail:e});window.dispatchEvent(n)}setBodyClass(){this.isDark()?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light",this.dispatchEvent(document.documentElement.dataset.scheme)}getSavedScheme(){let e=localStorage.getItem(this.localStorageKey);return e=="light"||e=="dark"||e=="auto"?e:"auto"}bindMatchMedia(){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{e.matches?this.systemPreferScheme="dark":this.systemPreferScheme="light",this.currentScheme=this.getSavedScheme(),this.setBodyClass()})}clip(e,n){let i=n.clientX,o=n.clientY,l=v(Math.max(i,innerWidth-i),Math.max(o,innerHeight-o));document.startViewTransition?(this.changeCount%4===0||this.changeCount%4===1?this.preloadingForTheme(e):(document.documentElement.style.setProperty("--x",i+"px"),document.documentElement.style.setProperty("--y",o+"px"),document.documentElement.style.setProperty("--r",l+"px"),document.startViewTransition(()=>{e.call(this)})),this.changeCount==3?this.changeCount=0:this.changeCount++):window.Preloading?this.preloadingForTheme(e):this.currentScheme==="light"?(e.call(this),w(n,!1)):(e.call(this),w(n,!0))}preloadingForTheme(e){window.Preloading.hide(),window.Preloading.removeAndCreateNew(),window.Preloading.setLoading("\u5207\u6362\u4E2D...",""),requestAnimationFrame(()=>{window.Preloading.showWithoutClock(),t.disableScroll(),setTimeout(()=>{e.call(this),setTimeout(()=>{t.enableScroll(),window.Preloading.loaded(),window.Preloading.resetLoading("")},1e3)},500)})}},L=S;function g(t){let e;return()=>{e&&window.cancelAnimationFrame(e),e=window.requestAnimationFrame(()=>t())}}var z=".article-content h1[id], .article-content h2[id], .article-content h3[id], .article-content h4[id], .article-content h5[id], .article-content h6[id]",H="#TableOfContents",P="#TableOfContents li",I="active-class";function K(t,e){let n=t.querySelector("a").offsetHeight,i=t.offsetTop-e.offsetHeight/2+n/2-e.offsetTop;i<0&&(i=0),e.scrollTo({top:i,behavior:"smooth"})}function V(t){let e={};return t.forEach(n=>{let o=n.querySelector("a").getAttribute("href");o.startsWith("#")&&(e[o.slice(1)]=n)}),e}function A(t){let e=[];return t.forEach(n=>{e.push({id:n.id,offset:n.offsetTop})}),e.sort((n,i)=>n.offset-i.offset),e}function q(){let t=document.querySelectorAll(z);if(!t){console.warn("No header matched query",t);return}let e=document.querySelector(H);if(!e){console.warn("No toc matched query",H);return}let n=document.querySelectorAll(P);if(!n){console.warn("No navigation matched query",P);return}let i=A(t),o=!1;e.addEventListener("mouseenter",g(()=>o=!0)),e.addEventListener("mouseleave",g(()=>o=!1));let l,r=V(n);function a(){let m=document.documentElement.scrollTop||document.body.scrollTop,c;i.forEach(h=>{m>=h.offset-20&&(c=document.getElementById(h.id))});let s;c&&(s=r[c.id]),c&&!s?console.debug("No link found for section",c):s!==l&&(l&&l.classList.remove(I),s&&(s.classList.add(I),o||K(s,e)),l=s)}window.addEventListener("scroll",g(a));function d(){i=A(t),a()}window.addEventListener("resize",g(d))}var $="a[href]";function B(){document.querySelectorAll($).forEach(t=>{t.getAttribute("href").startsWith("#")&&t.addEventListener("click",n=>{n.preventDefault();let i=decodeURI(t.getAttribute("href").substring(1)),o=document.getElementById(i),l=o.getBoundingClientRect().top-document.documentElement.getBoundingClientRect().top;window.history.pushState({},"",t.getAttribute("href")),scrollTo({top:l,behavior:"smooth"})})})}var j=function(){window.addEventListener("load",()=>{})},F=j;var D={init:()=>{M();let t=document.querySelector(".article-content");if(t){E.createGallery(t);let e=t.querySelectorAll("div.gallery");for(let n=0;n<e.length;n++){let i=e[n];new E(i,n)}B(),q()}x(),new L(document.getElementById("dark-mode-toggle"),!1),new L(document.getElementById("dark-mode-toggle-mine"),!0)}};F();window.addEventListener("load",()=>{setTimeout(function(){D.init()},0)});window.Stack=D;window.createElement=C;})();
/*!
*  页面加载后执行的js操作
*/
